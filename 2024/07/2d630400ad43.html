<!DOCTYPE html><html lang="zh" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Category: æ–‡æ¡£ | ç¼–ç¨‹å°å±‹</title><meta name="author" content="é˜¿åº“å¨…"><meta name="copyright" content="é˜¿åº“å¨…"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="å‰è¨€ èƒŒæ™¯ Â  1ï¼å‰ç«¯å¼€å‘éœ€è¦ç”¨åˆ°åå°æ¥å£ 2ï¼ä½¿ç”¨ç°æˆçš„ç³»ç»Ÿçš„åŠŸèƒ½(http:&#x2F;&#x2F;api.btstu.cn&#x2F;) Â  åšä¸€ä¸ªAPIæ¥å£å¹³å°: Â   é˜²æ­¢æ”»å‡»ï¼ˆå®‰å…¨æ€§)  ä¸èƒ½éšä¾¿è°ƒç”¨(é™åˆ¶ã€å¼€é€š)  ç»Ÿè®¡è°ƒç”¨æ¬¡æ•°  è®¡è´¹  æµé‡ä¿æŠ¤  APIæ¥å…¥   Â  é¡¹ç›®ä»‹ç» Â  åšä¸€ä¸ªæä¾›APIæ¥å£è°ƒç”¨çš„å¹³å°ï¼Œç”¨æˆ·å¯ä»¥æ³¨å†Œç™»å½•ï¼Œå¼€é€šæ¥å£è°ƒç”¨æƒé™ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨æ¥å£ï¼Œå¹¶ä¸”æ¯æ¬¡è°ƒç”¨ä¼šè¿›è¡Œç»Ÿè®¡ã€‚ç®¡ç†å‘˜å¯ä»¥å‘å¸ƒæ¥å£">
<meta property="og:type" content="article">
<meta property="og:title" content="apiå¼€å‘å¹³å°">
<meta property="og:url" content="http://example.com/2024/07/2d630400ad43.html">
<meta property="og:site_name" content="ç¼–ç¨‹å°å±‹">
<meta property="og:description" content="å‰è¨€ èƒŒæ™¯ Â  1ï¼å‰ç«¯å¼€å‘éœ€è¦ç”¨åˆ°åå°æ¥å£ 2ï¼ä½¿ç”¨ç°æˆçš„ç³»ç»Ÿçš„åŠŸèƒ½(http:&#x2F;&#x2F;api.btstu.cn&#x2F;) Â  åšä¸€ä¸ªAPIæ¥å£å¹³å°: Â   é˜²æ­¢æ”»å‡»ï¼ˆå®‰å…¨æ€§)  ä¸èƒ½éšä¾¿è°ƒç”¨(é™åˆ¶ã€å¼€é€š)  ç»Ÿè®¡è°ƒç”¨æ¬¡æ•°  è®¡è´¹  æµé‡ä¿æŠ¤  APIæ¥å…¥   Â  é¡¹ç›®ä»‹ç» Â  åšä¸€ä¸ªæä¾›APIæ¥å£è°ƒç”¨çš„å¹³å°ï¼Œç”¨æˆ·å¯ä»¥æ³¨å†Œç™»å½•ï¼Œå¼€é€šæ¥å£è°ƒç”¨æƒé™ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨æ¥å£ï¼Œå¹¶ä¸”æ¯æ¬¡è°ƒç”¨ä¼šè¿›è¡Œç»Ÿè®¡ã€‚ç®¡ç†å‘˜å¯ä»¥å‘å¸ƒæ¥å£">
<meta property="og:locale">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:published_time" content="2024-07-07T02:16:44.000Z">
<meta property="article:modified_time" content="2024-07-07T09:11:04.647Z">
<meta property="article:author" content="é˜¿åº“å¨…">
<meta property="article:tag" content="java">
<meta property="article:tag" content="apiå¼€å‘å¹³å°">
<meta property="article:tag" content="é¡¹ç›®å®æˆ˜">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2024/07/2d630400ad43.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Category: æ–‡æ¡£',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-07-07 17:11:04'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">31</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">41</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">10</div></a></div><hr class="custom-hr"/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="ç¼–ç¨‹å°å±‹"><img class="site-icon" src="https://halo-ctc.upyun.ctcnb.cn/halo/cropped-logo.png"/><span class="site-name">ç¼–ç¨‹å°å±‹</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">apiå¼€å‘å¹³å°</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-07-07T02:16:44.000Z" title="Created 2024-07-07 10:16:44">2024-07-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-07-07T09:11:04.647Z" title="Updated 2024-07-07 17:11:04">2024-07-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%96%87%E6%A1%A3/">æ–‡æ¡£</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="apiå¼€å‘å¹³å°"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><hr>
<p><strong>èƒŒæ™¯</strong> Â  1ï¼å‰ç«¯å¼€å‘éœ€è¦ç”¨åˆ°åå°æ¥å£ 2ï¼ä½¿ç”¨ç°æˆçš„ç³»ç»Ÿçš„åŠŸèƒ½(<a target="_blank" rel="noopener" href="http://api.btstu.cn/">http://api.btstu.cn/</a>) Â  <strong>åšä¸€ä¸ªAPIæ¥å£å¹³å°:</strong> Â </p>
<ol>
<li><p>é˜²æ­¢æ”»å‡»ï¼ˆå®‰å…¨æ€§)</p>
</li>
<li><p>ä¸èƒ½éšä¾¿è°ƒç”¨(é™åˆ¶ã€å¼€é€š)</p>
</li>
<li><p>ç»Ÿè®¡è°ƒç”¨æ¬¡æ•°</p>
</li>
<li><p>è®¡è´¹</p>
</li>
<li><p>æµé‡ä¿æŠ¤</p>
</li>
<li><p>APIæ¥å…¥</p>
</li>
</ol>
<p>Â  <strong>é¡¹ç›®ä»‹ç»</strong> Â  åšä¸€ä¸ªæä¾›APIæ¥å£è°ƒç”¨çš„å¹³å°ï¼Œç”¨æˆ·å¯ä»¥æ³¨å†Œç™»å½•ï¼Œå¼€é€šæ¥å£è°ƒç”¨æƒé™ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨æ¥å£ï¼Œå¹¶ä¸”æ¯æ¬¡è°ƒç”¨ä¼šè¿›è¡Œç»Ÿè®¡ã€‚ç®¡ç†å‘˜å¯ä»¥å‘å¸ƒæ¥å£ã€ä¸‹çº¿æ¥å£ã€æ¥å…¥æ¥å£ï¼Œä»¥åŠå¯è§†åŒ–æ¥å£çš„è°ƒç”¨æƒ…å†µã€æ•°æ®ã€‚ Â  <strong>ä¸šåŠ¡æµç¨‹</strong> Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230112101821991.png"> Â  <strong>æŠ€æœ¯é€‰å‹</strong> Â  <strong>å‰ç«¯ï¼š</strong> Â </p>
<ul>
<li><p>Ant Design Pro</p>
</li>
<li><p>React</p>
</li>
<li><p>Ant Design Procomponents</p>
</li>
<li><p>Umi</p>
</li>
<li><p>Umi Request (Axiosçš„å°è£…)</p>
</li>
</ul>
<p>Â  <strong>åç«¯ï¼š</strong> Â </p>
<ul>
<li><p>Java Spring Boot</p>
</li>
<li><p>Spring Boot Starter (SDKå¼€å‘)</p>
</li>
<li><p>Dubbo</p>
</li>
<li><p>Nacos</p>
</li>
<li><p>Spring Cloud Gateway (ç½‘å…³ã€é™æµã€æ—¥å¿—å®ç°)</p>
</li>
</ul>
<p>Â </p>
<h1 id="ä¸€ã€é¡¹ç›®åˆå§‹åŒ–"><a href="#ä¸€ã€é¡¹ç›®åˆå§‹åŒ–" class="headerlink" title="ä¸€ã€é¡¹ç›®åˆå§‹åŒ–"></a>ä¸€ã€é¡¹ç›®åˆå§‹åŒ–</h1><hr>
<h2 id="1ã€Ant-Design-Pro"><a href="#1ã€Ant-Design-Pro" class="headerlink" title="1ã€Ant Design Pro"></a>1ã€Ant Design Pro</h2><hr>
<p>å¿«é€Ÿå¼€å§‹ä½¿ç”¨ï¼Œå¯ä»¥æŸ¥çœ‹<a target="_blank" rel="noopener" href="https://pro.ant.design/zh-CN/docs/getting-started">å®˜æ–¹æ•™ç¨‹</a> Â  <strong>åˆå§‹åŒ–</strong> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨ npm</span><br><span class="line">npm i @ant-design/pro-cli -g</span><br></pre></td></tr></table></figure>

<p>Â  æ‰“å¼€å°†è¦å­˜æ”¾é¡¹ç›®çš„æ–‡ä»¶å¤¹ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pro create  é¡¹ç›®åç§°</span><br></pre></td></tr></table></figure>

<p>Â  <strong>é€‰æ‹©umiç‰ˆæœ¬</strong> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">? ğŸ‚ ä½¿ç”¨ umi@4 è¿˜æ˜¯ umi@3 ? (Use arrow keys)</span><br><span class="line">â¯ umi@4</span><br><span class="line">  umi@3</span><br></pre></td></tr></table></figure>

<p>Â  é€‰æ‹©4ç‰ˆçš„ Â  <strong>å®‰è£…ä¾èµ–</strong> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn æˆ–è€…  npm install</span><br></pre></td></tr></table></figure>

<p>Â  <strong>å¯åŠ¨</strong> Â  åœ¨<strong>package.json</strong>é‡Œé¢ Â  Â  Â ç‚¹å‡»<strong>start</strong> Â  è¿™é‡Œæˆ‘é‡åˆ°äº†ä¸€ä¸ªå‘ï¼Œç™»å½•é¡µé¢æ— æ³•ç™»å½• çŠ¶æ€ç 404 Â  åœ¨GitHub issueé‡Œæ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆï¼š<a target="_blank" rel="noopener" href="https://github.com/ant-design/ant-design-pro/issues/10446">https://github.com/ant-design/ant-design-pro/issues/10446</a> Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230112105451611.png"> Â  <strong>åˆ é™¤ä¸å¿…è¦çš„ä¸œè¥¿</strong> Â </p>
<ol>
<li>ç§»é™¤å›½é™…åŒ– å…ˆè·³è¿‡ æœ‰BUG è¿è¡Œpackage.jsonä¸­çš„i18n-remove ç„¶åå‘ç°åˆæŠ¥é”™äº†..</li>
</ol>
<p>è§£å†³æ–¹æ³•ï¼šæ‰§è¡Œ Â  yarn add eslint-config-prettier Â  yarn add eslint-plugin-unicorn Â  ç„¶åä¿®æ”¹node_modules&#x2F;@umijs&#x2F;lint&#x2F;dist&#x2F;config&#x2F;eslint&#x2F;index.js Â  &#x2F;&#x2F; es2022: trueæŠŠè¿™ä¸ªæ³¨é‡Šæ‰å°±å¯ä»¥è§£å†³é—®é¢˜ <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230112110408577.png"> ç„¶ååˆ é™¤src&#x2F;localesç›®å½•</p>
<ol start="2">
<li>åˆ é™¤testsæµ‹è¯•</li>
</ol>
<p>Â </p>
<h2 id="2ã€åç«¯"><a href="#2ã€åç«¯" class="headerlink" title="2ã€åç«¯"></a>2ã€åç«¯</h2><hr>
<h3 id="1ã€åˆå§‹åŒ–"><a href="#1ã€åˆå§‹åŒ–" class="headerlink" title="1ã€åˆå§‹åŒ–"></a>1ã€åˆå§‹åŒ–</h3><p>Â  <strong>ä½¿ç”¨SpringBoot é¡¹ç›®åˆå§‹æ¨¡æ¿</strong> Â  Java SpringBoot é¡¹ç›®åˆå§‹æ¨¡æ¿ï¼Œæ•´åˆäº†å¸¸ç”¨æ¡†æ¶å’Œç¤ºä¾‹ä»£ç ï¼Œå¤§å®¶å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šå¿«é€Ÿå¼€å‘è‡ªå·±çš„é¡¹ç›®ã€‚(springboot-init) Â  <strong>æ¨¡æ¿åŠŸèƒ½</strong> Â </p>
<ul>
<li><p>Spring Boot 2.7.0ï¼ˆè´¼æ–°ï¼‰</p>
</li>
<li><p>Spring MVC</p>
</li>
<li><p>MySQL é©±åŠ¨</p>
</li>
<li><p>MyBatis</p>
</li>
<li><p>MyBatis Plus</p>
</li>
<li><p>Spring Session Redis åˆ†å¸ƒå¼ç™»å½•</p>
</li>
<li><p>Spring AOP</p>
</li>
<li><p>Apache Commons Lang3 å·¥å…·ç±»</p>
</li>
<li><p>Lombok æ³¨è§£</p>
</li>
<li><p>Swagger + Knife4j æ¥å£æ–‡æ¡£</p>
</li>
<li><p>Spring Boot è°ƒè¯•å·¥å…·å’Œé¡¹ç›®å¤„ç†å™¨</p>
</li>
<li><p>å…¨å±€è¯·æ±‚å“åº”æ‹¦æˆªå™¨ï¼ˆè®°å½•æ—¥å¿—ï¼‰</p>
</li>
<li><p>å…¨å±€å¼‚å¸¸å¤„ç†å™¨</p>
</li>
<li><p>è‡ªå®šä¹‰é”™è¯¯ç </p>
</li>
<li><p>å°è£…é€šç”¨å“åº”ç±»</p>
</li>
<li><p>ç¤ºä¾‹ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€æœç´¢åŠŸèƒ½</p>
</li>
<li><p>ç¤ºä¾‹å•å…ƒæµ‹è¯•ç±»</p>
</li>
<li><p>ç¤ºä¾‹ SQLï¼ˆç”¨æˆ·è¡¨ï¼‰</p>
</li>
</ul>
<p>Â  éœ€è¦æ›´æ”¹yamlæ–‡ä»¶ä¸­çš„MySQLã€Redisçš„é…ç½® Â  è®¿é—® localhost:7529&#x2F;api&#x2F;doc.html å°±èƒ½åœ¨çº¿è°ƒè¯•æ¥å£äº†ï¼Œä¸éœ€è¦å‰ç«¯é…åˆå•¦~ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230112141458799.png"> Â </p>
<h3 id="2ã€æ•°æ®åº“è®¾è®¡"><a href="#2ã€æ•°æ®åº“è®¾è®¡" class="headerlink" title="2ã€æ•°æ®åº“è®¾è®¡"></a>2ã€æ•°æ®åº“è®¾è®¡</h3><hr>
<p><strong>åŸºæœ¬ç»“æ„</strong> Â </p>
<ul>
<li><p>id ç”¨æˆ·id</p>
</li>
<li><p>name åç§°</p>
</li>
<li><p>description æè¿°</p>
</li>
<li><p>url æ¥å£åœ°å€</p>
</li>
<li><p>request_header è¯·æ±‚å¤´</p>
</li>
<li><p>reponse_header å“åº”å¤´</p>
</li>
<li><p>status æ¥å£çŠ¶æ€ï¼ˆ0-å…³é—­ 1-å¼€å¯ï¼‰</p>
</li>
<li><p>method è¯·æ±‚ç±»å‹</p>
</li>
<li><p>user_id åˆ›å»ºäºº</p>
</li>
<li><p>create_time åˆ›å»ºæ—¶é—´</p>
</li>
<li><p>update_time æ›´æ–°æ—¶é—´</p>
</li>
<li><p>is_delete Â é€»è¾‘åˆ é™¤ ï¼ˆ0-æœªåˆ  ï¼Œ1-å·²åˆ ï¼‰</p>
</li>
</ul>
<p>Â  <strong>ä»£ç </strong> Â  å¯ä»¥ç”¨é±¼çš®å†™çš„sqlç”Ÿæˆå·¥å…·ç”Ÿæˆä¸€ä¸‹ä»£ç  Â Â <a target="_blank" rel="noopener" href="https://www.sqlfather.com/">SQLä¹‹çˆ¶</a> Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230112153403987.png"> Â  å¡«å¯¹åº”çš„æ•°æ®ï¼Œä¸€é”®ç”Ÿæˆå³å¯ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">create database if not exists api_platform;</span><br><span class="line"></span><br><span class="line">use api_platform;</span><br><span class="line"></span><br><span class="line">-- æ¥å£ä¿¡æ¯</span><br><span class="line">create table if not exists api_platform.`interface_info`</span><br><span class="line">(</span><br><span class="line">`id` bigint not null auto_increment comment &#x27;ä¸»é”®&#x27; primary key,</span><br><span class="line">`name` varchar(256) not null comment &#x27;åç§°&#x27;,</span><br><span class="line">`description` varchar(256) null comment &#x27;æè¿°&#x27;,</span><br><span class="line">`url` varchar(512) not null comment &#x27;æ¥å£åœ°å€&#x27;,</span><br><span class="line">`request_header` text null comment &#x27;è¯·æ±‚å¤´&#x27;,</span><br><span class="line">`response_header` text null comment &#x27;å“åº”å¤´&#x27;,</span><br><span class="line">`status` int default 0 not null comment &#x27;æ¥å£çŠ¶æ€ï¼ˆ0-å…³é—­ï¼Œ1-å¼€å¯ï¼‰&#x27;,</span><br><span class="line">`method` varchar(256) not null comment &#x27;è¯·æ±‚ç±»å‹&#x27;,</span><br><span class="line">`user_id` bigint not null comment &#x27;åˆ›å»ºäºº&#x27;,</span><br><span class="line">`create_time` datetime default CURRENT_TIMESTAMP not null comment &#x27;åˆ›å»ºæ—¶é—´&#x27;,</span><br><span class="line">`update_time` datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment &#x27;æ›´æ–°æ—¶é—´&#x27;,</span><br><span class="line">`is_deleted` tinyint default 0 not null comment &#x27;æ˜¯å¦åˆ é™¤(0-æœªåˆ , 1-å·²åˆ )&#x27;</span><br><span class="line">) comment &#x27;æ¥å£ä¿¡æ¯&#x27;;</span><br><span class="line"></span><br><span class="line">insert into api_platform.`interface_info` (`name`, `description`, `url`, `request_header`, `response_header`, `status`, `method`, `user_id`) values (&#x27;å»–ç«‹è½©&#x27;, &#x27;è„±é¢–è€Œå‡º&#x27;, &#x27;www.foster-larkin.co&#x27;, &#x27;é¾™å˜‰æ‡¿&#x27;, &#x27;ç§¦å¤©ç£Š&#x27;, 0, &#x27;GET&#x27;, 1718083101);</span><br><span class="line">insert into api_platform.`interface_info` (`name`, `description`, `url`, `request_header`, `response_header`, `status`, `method`, `user_id`) values (&#x27;æ›¹æ˜è¾‰&#x27;, &#x27;ä¸¾ä¸€åä¸‰&#x27;, &#x27;www.tony-kiehn.com&#x27;, &#x27;ä»»æ“è‹&#x27;, &#x27;é™ˆå‡¯ç‘&#x27;, 0, &#x27;GET&#x27;, 28978);</span><br><span class="line">insert into api_platform.`interface_info` (`name`, `description`, `url`, `request_header`, `response_header`, `status`, `method`, `user_id`) values (&#x27;é‡‘ä¹é©¹&#x27;, &#x27;é¦–å½“å…¶å†²&#x27;, &#x27;www.coleen-prosacco.net&#x27;, &#x27;æ¯›æµ©&#x27;, &#x27;é™†è‡´è¿œ&#x27;, 0, &#x27;GET&#x27;, 208);</span><br><span class="line">insert into api_platform.`interface_info` (`name`, `description`, `url`, `request_header`, `response_header`, `status`, `method`, `user_id`) values (&#x27;å»–æ€&#x27;, &#x27;æ¥ä¹‹ä¸æ˜“&#x27;, &#x27;www.don-sipes.net&#x27;, &#x27;æ¢å½¬&#x27;, &#x27;ç™½å›æµ©&#x27;, 0, &#x27;GET&#x27;, 470);</span><br><span class="line">insert into api_platform.`interface_info` (`name`, `description`, `url`, `request_header`, `response_header`, `status`, `method`, `user_id`) values (&#x27;è‘£ç…œç¥º&#x27;, &#x27;é•¿æ²»ä¹…å®‰&#x27;, &#x27;www.terry-turner.co&#x27;, &#x27;è¦ƒç»é½&#x27;, &#x27;èƒ¡é›ªæ¾&#x27;, 0, &#x27;GET&#x27;, 611007);</span><br><span class="line">insert into api_platform.`interface_info` (`name`, `description`, `url`, `request_header`, `response_header`, `status`, `method`, `user_id`) values (&#x27;ä¾¯èªå¥&#x27;, &#x27;ç²¾å¿ƒè®¾è®¡&#x27;, &#x27;www.augustus-yost.info&#x27;, &#x27;å‚…é¸¿ç…Š&#x27;, &#x27;æ½˜é¹é£&#x27;, 0, &#x27;GET&#x27;, 0);</span><br><span class="line">insert into api_platform.`interface_info` (`name`, `description`, `url`, `request_header`, `response_header`, `status`, `method`, `user_id`) values (&#x27;é­å¼˜æ–‡&#x27;, &#x27;ç©å¿½èŒå®ˆ&#x27;, &#x27;www.guadalupe-beatty.biz&#x27;, &#x27;æ±Ÿæ¢“æ™¨&#x27;, &#x27;é­æ€æ·¼&#x27;, 0, &#x27;GET&#x27;, 1162536022);</span><br><span class="line">insert into api_platform.`interface_info` (`name`, `description`, `url`, `request_header`, `response_header`, `status`, `method`, `user_id`) values (&#x27;äºè‹‘åš&#x27;, &#x27;å„å¼å„æ ·&#x27;, &#x27;www.nolan-metz.net&#x27;, &#x27;éŸ¦æœ&#x27;, &#x27;é‡‘èƒ¤ç¥¥&#x27;, 0, &#x27;GET&#x27;, 0);</span><br><span class="line">insert into api_platform.`interface_info` (`name`, `description`, `url`, `request_header`, `response_header`, `status`, `method`, `user_id`) values (&#x27;å§šç‚«æ˜&#x27;, &#x27;ç¿»å¤©è¦†åœ°&#x27;, &#x27;www.jodie-schultz.info&#x27;, &#x27;è®¸è¶Šå½¬&#x27;, &#x27;æ¯›æ™‹é¹&#x27;, 0, &#x27;GET&#x27;, 973);</span><br><span class="line">insert into api_platform.`interface_info` (`name`, `description`, `url`, `request_header`, `response_header`, `status`, `method`, `user_id`) values (&#x27;å­™é‘«é¹&#x27;, &#x27;ç»œç»ä¸ç»&#x27;, &#x27;www.liza-sporer.co&#x27;, &#x27;å­™å½¬&#x27;, &#x27;å‚…é¸¿ç…Š&#x27;, 0, &#x27;GET&#x27;, 30308);</span><br><span class="line">insert into api_platform.`interface_info` (`name`, `description`, `url`, `request_header`, `response_header`, `status`, `method`, `user_id`) values (&#x27;å”å±•é¹&#x27;, &#x27;é“¤è€Œèµ°é™©&#x27;, &#x27;www.hayden-purdy.co&#x27;, &#x27;æ¨å“²ç€š&#x27;, &#x27;é™†å‡¯ç‘&#x27;, 0, &#x27;GET&#x27;, 473462835);</span><br><span class="line">insert into api_platform.`interface_info` (`name`, `description`, `url`, `request_header`, `response_header`, `status`, `method`, `user_id`) values (&#x27;æ›¹æ“è‹&#x27;, &#x27;èµä¸ç»å£&#x27;, &#x27;www.phung-glover.org&#x27;, &#x27;é‚±å¿—æ³½&#x27;, &#x27;å¼ å¥é›„&#x27;, 0, &#x27;GET&#x27;, 32155653);</span><br><span class="line">insert into api_platform.`interface_info` (`name`, `description`, `url`, `request_header`, `response_header`, `status`, `method`, `user_id`) values (&#x27;å¤çƒ¨éœ–&#x27;, &#x27;å“­ç¬‘ä¸å¾—&#x27;, &#x27;www.augustine-funk.org&#x27;, &#x27;å®‹èªå¥&#x27;, &#x27;éƒé¹æ¶›&#x27;, 0, &#x27;GET&#x27;, 3964);</span><br><span class="line">insert into api_platform.`interface_info` (`name`, `description`, `url`, `request_header`, `response_header`, `status`, `method`, `user_id`) values (&#x27;è‘£æµ©&#x27;, &#x27;å¯¹ç—‡ä¸‹è¯&#x27;, &#x27;www.erik-hamill.biz&#x27;, &#x27;é»ç«‹æœ&#x27;, &#x27;å»–é¹¤è½©&#x27;, 0, &#x27;GET&#x27;, 2275);</span><br><span class="line">insert into api_platform.`interface_info` (`name`, `description`, `url`, `request_header`, `response_header`, `status`, `method`, `user_id`) values (&#x27;ç½—è£è½©&#x27;, &#x27;å–œé—»ä¹è§&#x27;, &#x27;www.gia-hermann.biz&#x27;, &#x27;éŸ©ç…œåŸ&#x27;, &#x27;é˜è€€æ°&#x27;, 0, &#x27;GET&#x27;, 847);</span><br><span class="line">insert into api_platform.`interface_info` (`name`, `description`, `url`, `request_header`, `response_header`, `status`, `method`, `user_id`) values (&#x27;æ²ˆæ­£è±ª&#x27;, &#x27;ç»Ÿç­¹å…¼é¡¾&#x27;, &#x27;www.isabella-reinger.io&#x27;, &#x27;é‚“å­è½©&#x27;, &#x27;å»–ä¼Ÿè¯š&#x27;, 0, &#x27;GET&#x27;, 997378602);</span><br><span class="line">insert into api_platform.`interface_info` (`name`, `description`, `url`, `request_header`, `response_header`, `status`, `method`, `user_id`) values (&#x27;ä»»ç«‹æœ&#x27;, &#x27;å‡ºäººæ„æ–™&#x27;, &#x27;www.geoffrey-koss.name&#x27;, &#x27;è¦ƒæµ©ç„¶&#x27;, &#x27;è§é›¨æ³½&#x27;, 0, &#x27;GET&#x27;, 403);</span><br><span class="line">insert into api_platform.`interface_info` (`name`, `description`, `url`, `request_header`, `response_header`, `status`, `method`, `user_id`) values (&#x27;å¼ ç‚«æ˜&#x27;, &#x27;åä¸è™šä¼ &#x27;, &#x27;www.ellan-gleason.com&#x27;, &#x27;é»æ­£è±ª&#x27;, &#x27;éŸ¦ç‚å½¬&#x27;, 0, &#x27;GET&#x27;, 35127293);</span><br><span class="line">insert into api_platform.`interface_info` (`name`, `description`, `url`, `request_header`, `response_header`, `status`, `method`, `user_id`) values (&#x27;æ–¹é›¨æ³½&#x27;, &#x27;è¡£é£Ÿä½è¡Œ&#x27;, &#x27;www.wilton-walsh.biz&#x27;, &#x27;é»è¶Šæ³½&#x27;, &#x27;ç™½è¿œèˆª&#x27;, 0, &#x27;GET&#x27;, 62264);</span><br><span class="line">insert into api_platform.`interface_info` (`name`, `description`, `url`, `request_header`, `response_header`, `status`, `method`, `user_id`) values (&#x27;è¢å¤©ç¿Š&#x27;, &#x27;å·åœŸé‡æ¥&#x27;, &#x27;www.lynetta-mclaughlin.info&#x27;, &#x27;é‚¹ç† å½¤&#x27;, &#x27;å¶æ½‡ç„¶&#x27;, 0, &#x27;GET&#x27;, 9884455);</span><br></pre></td></tr></table></figure>

<p>Â  è¿è¡Œå³å¯ Â </p>
<h3 id="3ã€ä½¿ç”¨MabatisXæ’ä»¶"><a href="#3ã€ä½¿ç”¨MabatisXæ’ä»¶" class="headerlink" title="3ã€ä½¿ç”¨MabatisXæ’ä»¶"></a>3ã€ä½¿ç”¨MabatisXæ’ä»¶</h3><p>Â  ç”Ÿæˆdomainã€mapperã€service Â  æ‰“å¼€æ–°å»ºçš„è¡¨ï¼Œå³å‡»é€‰æ‹©MybatisX-Generator Â  å‹¾ä¸Šé©¼å³° Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230112155202934.png"> Â  æ ¹æ®<strong>ç‰ˆæœ¬è·Ÿéœ€è¦æ‰“å‹¾</strong>ï¼Œç‚¹å‡»å®Œæˆ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230112161220300.png"> Â  æŸ¥çœ‹ç›®å½• Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230112161257033.png"> Â  ç„¶åå°†å®ƒä»¬æ”¾åˆ°æˆ‘è‡ªå·±çš„è·¯å¾„ä¸‹ Â </p>
<h3 id="4ã€Controller"><a href="#4ã€Controller" class="headerlink" title="4ã€Controller"></a>4ã€Controller</h3><p>Â  æ¥ä¸‹æ¥åˆ°controllerå±‚ Â  æˆ‘ä»¬åªéœ€è¦å°†<strong>PostController</strong>å¤åˆ¶ä¸€ä»½æ”¹åä¸º<strong>InterfaceInfoController</strong>å³å¯,å› ä¸ºé€»è¾‘æ˜¯å·®ä¸å¤šï¼Œéƒ½æ˜¯è¿›è¡Œå¢åˆ æ”¹æŸ¥ Â  ç„¶åå°†postæ”¹æˆinterfaceInfoã€Postæ”¹æˆInterfaceInfo Â  æ ¹æ®æŠ¥é”™ä¿¡æ¯æˆ‘ä»¬æ¥è¡¥å……ä¿¡æ¯ Â </p>
<h3 id="5ã€DTO"><a href="#5ã€DTO" class="headerlink" title="5ã€DTO"></a>5ã€DTO</h3><p>Â  é¦–å…ˆå…ˆå¢åŠ DTOï¼Œåœ¨InterfaceInfoç±»ä»æ‹¿æˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯åšæˆä¸‰ä¸ªDTOç±»ï¼ˆåˆ†åˆ«æ˜¯æ–°å¢ã€æŸ¥è¯¢ã€æ›´æ–°ï¼‰åˆ é™¤çš„è¯·æ±‚æˆ‘ä»¬å°è£…åœ¨commonåŒ…ä¸‹ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230112184904561.png"> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">package com.xuan.project.model.dto.interfaceinfo;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * åˆ›å»ºè¯·æ±‚</span><br><span class="line"> *</span><br><span class="line"> * @author xuan</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">public class InterfaceInfoAddRequest implements Serializable &#123;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * åç§°</span><br><span class="line"> */</span><br><span class="line">private String name;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æè¿°</span><br><span class="line"> */</span><br><span class="line">private String description;</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">  // ...</span><br><span class="line">  // ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h3 id="6ã€Service"><a href="#6ã€Service" class="headerlink" title="6ã€Service"></a>6ã€Service</h3><p>Â  æ ¹æ®æŠ¥é”™å¯çŸ¥ serviceå±‚ç¼ºå°‘ä¸€ä¸ªæ–¹æ³•validInterfaceInfo Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @author xuan</span><br><span class="line"> * @description é’ˆå¯¹è¡¨ã€interface_info(æ¥å£ä¿¡æ¯)ã€‘çš„æ•°æ®åº“æ“ä½œServiceå®ç°</span><br><span class="line"> * @createDate 2023-01-12 16:11:19</span><br><span class="line"> */</span><br><span class="line">@Service</span><br><span class="line">public class InterfaceInfoServiceImpl extends ServiceImpl&lt;InterfaceInfoMapper, InterfaceInfo&gt;</span><br><span class="line">implements InterfaceInfoService &#123;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public void validInterfaceInfo(InterfaceInfo interfaceInfo, boolean add) &#123;</span><br><span class="line">if (interfaceInfo == null) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.PARAMS_ERROR);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">String name = interfaceInfo.getName();</span><br><span class="line">String description = interfaceInfo.getDescription();</span><br><span class="line">String url = interfaceInfo.getUrl();</span><br><span class="line">String requestHeader = interfaceInfo.getRequestHeader();</span><br><span class="line">String responseHeader = interfaceInfo.getResponseHeader();</span><br><span class="line">Integer status = interfaceInfo.getStatus();</span><br><span class="line">String method = interfaceInfo.getMethod();</span><br><span class="line">Long userId = interfaceInfo.getUserId();</span><br><span class="line"></span><br><span class="line">// åˆ›å»ºæ—¶ï¼Œæ‰€æœ‰å‚æ•°å¿…é¡»éç©º</span><br><span class="line">if (add) &#123;</span><br><span class="line">if (StringUtils.isAnyBlank(name, description, url, requestHeader, responseHeader, method)  ObjectUtils.anyNull(userId, status)) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.PARAMS_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">if (StringUtils.isNotBlank(name) &amp;&amp; name.length() &gt; 256) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.PARAMS_ERROR, &quot;åå­—è¿‡é•¿&quot;);</span><br><span class="line">&#125;</span><br><span class="line">if (StringUtils.isNotBlank(description) &amp;&amp; description.length() &gt; 512) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.PARAMS_ERROR, &quot;æè¿°è¿‡é•¿&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  è¿™é‡Œçš„å¤§é‡getter æ˜¯ä½¿ç”¨æ’ä»¶Â <strong>GenerateAllSetter</strong>Â ç”Ÿæˆ macOSåœ¨å˜é‡ä¸Šæ‘ä½ option + Enter Â å³å¯ Â </p>
<h2 id="3ã€å‰ç«¯"><a href="#3ã€å‰ç«¯" class="headerlink" title="3ã€å‰ç«¯"></a>3ã€å‰ç«¯</h2><hr>
<h3 id="1ã€é…ç½®æ’ä»¶"><a href="#1ã€é…ç½®æ’ä»¶" class="headerlink" title="1ã€é…ç½®æ’ä»¶"></a>1ã€é…ç½®æ’ä»¶</h3><p>Â  ä¸ºäº†é¡¹ç›®æ›´åŠ è§„èŒƒ Â  æœç´¢Â <strong>eslint</strong>Â é€‰ä¸Šè‡ªåŠ¨è¯†åˆ« Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230112193957977.png"> Â  æœç´¢<strong>prettier</strong>Â æ‰“âˆš Â ç¾åŒ–ä»£ç  Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230112194107217.png"> Â </p>
<h3 id="2ã€æ¥å£è°ƒç”¨"><a href="#2ã€æ¥å£è°ƒç”¨" class="headerlink" title="2ã€æ¥å£è°ƒç”¨"></a>2ã€æ¥å£è°ƒç”¨</h3><p>Â  ä½¿ç”¨Â <strong>oneapi</strong>Â æ’ä»¶è‡ªåŠ¨ç”Ÿæˆ Â  å¦‚æœè¦å‰ç«¯è‡ªåŠ¨ç”Ÿæˆï¼Œéœ€è¦å°†åç«¯çš„éµå¾ª<strong>openapi</strong>è§„èŒƒçš„<strong>json</strong>æ–‡æ¡£ Â  åç«¯çš„éµå¾ª<strong>openapi</strong>è§„èŒƒçš„<strong>json</strong>æ–‡æ¡£ Â  æ‰¾åˆ°æˆ‘ä»¬èµ·çš„åç«¯ä¸»é¡µ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230112195321863.png"> Â  åœ¨åœ°å€æ è¾“å…¥<a target="_blank" rel="noopener" href="http://localhost:7529/api/v3/api-docs">http://localhost:7529/api/v3/api-docs</a> Â  å‘ç°å¦‚ä¸‹æ‰€ç¤º Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230112195351679.png"> Â  é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªurläº† Â  æ‰“å¼€configç›®å½•ä¸‹<strong>config.ts</strong>Â æ‰¾åˆ°<strong>openApi</strong>Â ä¿®æ”¹å¦‚ä¸‹ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">openAPI: [</span><br><span class="line">  // &#123;</span><br><span class="line">  //   requestLibPath: &quot;import &#123; request &#125; from &#x27;@umijs/max&#x27;&quot;,</span><br><span class="line">  //   // æˆ–è€…ä½¿ç”¨åœ¨çº¿çš„ç‰ˆæœ¬</span><br><span class="line">  //   // schemaPath: &quot;https://gw.alipayobjects.com/os/antfincdn/M%24jrzTTYJN/oneapi.json&quot;</span><br><span class="line">  //   schemaPath: join(__dirname, &#x27;oneapi.json&#x27;),</span><br><span class="line">  //   mock: false,</span><br><span class="line">  // &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    requestLibPath: &quot;import &#123; request &#125; from &#x27;@umijs/max&#x27;&quot;,</span><br><span class="line">    schemaPath: &#x27;http://localhost:7529/api/v3/api-docs&#x27;,</span><br><span class="line">    projectName: &#x27;api-platform-backend&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p>Â  æµ‹è¯•ä¸€ä¸‹æ˜¯å¦èƒ½ç”¨ Â  æ‰¾åˆ°<strong>package.json</strong>,æ‰§è¡Œ<strong>openapi</strong>å‘½ä»¤ Â  æ‰§è¡ŒæˆåŠŸï¼Œæˆ‘ä»¬å»<strong>service</strong>çœ‹ä¸€ä¸‹ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230112195813202.png"> Â  ç”±äºæˆ‘ä»¬æœ‰åç«¯ ï¼Œåº”è¯·æ±‚çœŸå®ç¯å¢ƒï¼Œæ‰€ä»¥ç›´æ¥ç”¨<strong>devæ¨¡å¼</strong>è¿è¡Œ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run start:dev</span><br></pre></td></tr></table></figure>

<p>Â  å¯ä»¥å°†é¡¹ç›®ä¸­çš„<strong>requestErrorConfig.ts</strong>æ”¹ä¸º<strong>requestConfig.ts</strong> Â  ç„¶ååœ¨<strong>app.tsx</strong>Â æ‰¾åˆ° requesté…ç½®ï¼Œå°†å…¶ä¿®æ”¹æˆæˆ‘ä»¬æ”¹çš„ Â  å†æ‰“å¼€<strong>requestConfig.ts</strong> Â  ä¿®æ”¹åå­—ï¼Œå¹¶è®¾ç½®ä¸€ä¸‹åç«¯åœ°å€ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230112200749537.png"> Â  <strong>æµ‹è¯•ä¸€ä¸‹</strong> Â  ä½¿ç”¨å®ƒæç¤ºè´¦æˆ·å¯†ç ç™»å½•ï¼Œå¤±è´¥äº† Â  æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹å‘ç°æ˜¯<strong>å‰åç«¯æ¥å£å®šä¹‰ä¸ä¸€è‡´</strong> Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230112201646377.png"> Â </p>
<h3 id="3ã€ä¿®æ”¹ç™»å½•çš„æ¥å£"><a href="#3ã€ä¿®æ”¹ç™»å½•çš„æ¥å£" class="headerlink" title="3ã€ä¿®æ”¹ç™»å½•çš„æ¥å£"></a>3ã€ä¿®æ”¹ç™»å½•çš„æ¥å£</h3><p>Â  æ‰¾åˆ°<strong>src&#x2F;pages&#x2F;User&#x2F;Login&#x2F;index.tsx</strong>ä¸‹çš„<strong>handleSubmit</strong> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const handleSubmit = async (values: API.UserLoginRequest) =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    // ç™»å½•</span><br><span class="line">    const res = await userLoginUsingPOST(&#123; ...values &#125;);</span><br><span class="line">    if (res.data) &#123;</span><br><span class="line">      const urlParams = new URL(window.location.href).searchParams;</span><br><span class="line">      history.push(urlParams.get(&#x27;redirect&#x27;)  &#x27;/&#x27;);</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    const defaultLoginFailureMessage = intl.formatMessage(&#123;</span><br><span class="line">      id: &#x27;pages.login.failure&#x27;,</span><br><span class="line">      defaultMessage: &#x27;ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•ï¼&#x27;,</span><br><span class="line">    &#125;);</span><br><span class="line">    console.log(error);</span><br><span class="line">    message.error(defaultLoginFailureMessage);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Â  ä¿®æ”¹ç”¨æˆ·åå’Œå¯†ç çš„å­—æ®µå’Œæˆ‘ä»¬åç«¯ä¸€æ · Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;ProFormText</span><br><span class="line">  name=&quot;userAccount&quot;</span><br><span class="line">  fieldProps=&#123;&#123;</span><br><span class="line">    size: &#x27;large&#x27;,</span><br><span class="line">      prefix: &lt;UserOutlined /&gt;,</span><br><span class="line">  &#125;&#125;</span><br><span class="line">  placeholder=&#123;intl.formatMessage(&#123;</span><br><span class="line">    id: &#x27;pages.login.username.placeholder&#x27;,</span><br><span class="line">    defaultMessage: &#x27;ç”¨æˆ·å: admin or user&#x27;,</span><br><span class="line">  &#125;)&#125;</span><br><span class="line">  rules=&#123;[</span><br><span class="line">    &#123;</span><br><span class="line">      required: true,</span><br><span class="line">      message: (</span><br><span class="line">        &lt;FormattedMessage</span><br><span class="line">          id=&quot;pages.login.username.required&quot;</span><br><span class="line">          defaultMessage=&quot;è¯·è¾“å…¥ç”¨æˆ·å!&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">      ),</span><br><span class="line">    &#125;,</span><br><span class="line">  ]&#125;</span><br><span class="line">  /&gt;</span><br></pre></td></tr></table></figure>

<p>Â  è¿”å›ç™»å½•é¡µé¢ï¼Œè¿›è¡Œç™»å½• Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230112202314036.png"> Â  è¯·æ±‚æˆåŠŸä½†æ˜¯æ²¡è·³è½¬ Â  ä¸ºä»€ä¹ˆæ²¡è·³è½¬ï¼Ÿå› ä¸ºæˆ‘ä»¬æ²¡æœ‰è®°å½•ç”¨æˆ·çš„<strong>ç™»å½•æ€</strong>ï¼Œä¸çŸ¥é“å®ƒæ˜¯å¦ç™»å½•æˆåŠŸ Â  <strong>è®¾ç½®ç”¨æˆ·çš„ç™»å½•æ€</strong> Â  å›åˆ°<strong>app.tsx</strong> Â  æ‰¾åˆ°<strong>getInitialState()<strong>è¿™ä¸ªæ–¹æ³• Â  è¿™ä¸ªæ–¹æ³•å½“æˆ‘ä»¬é¦–æ¬¡è®¿é—®é¡µé¢çš„æ—¶å€™ï¼Œè·å–ç”¨æˆ·çš„ä¿¡æ¯ï¼Œè·å–å½“å‰å…¨å±€çš„ä¸€äº›çŠ¶æ€ï¼Œå¯ä»¥æŠŠå®ƒå½“æˆå…¨å±€å˜é‡ Â  æˆ‘ä»¬å…ˆæ‰¾åˆ°</strong>typings.d.ts</strong> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// æœ€åé¢æ·»åŠ </span><br><span class="line">/**</span><br><span class="line"> * å…¨å±€çŠ¶æ€ç±»å‹</span><br><span class="line"> */</span><br><span class="line">interface InitialState &#123;</span><br><span class="line">  loginUser?: API.UserVO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  è¿”å›**getInitialState()**å°†å®ƒæ”¹ä¸º Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">export async function getInitialState(): Promise&lt;InitialState&gt; &#123;</span><br><span class="line">  // å½“é¡µé¢é¦–æ¬¡åŠ è½½æ—¶ï¼Œè·å–è¦å…¨å±€ä¿å­˜çš„ä¿¡æ¯æ¯”å¦‚ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">  const state: InitialState = &#123;</span><br><span class="line">    loginUser: undefined,</span><br><span class="line">  &#125;;</span><br><span class="line">  try &#123;</span><br><span class="line">    const res = await getLoginUserUsingGET();</span><br><span class="line">    if (res.data) &#123;</span><br><span class="line">      state.loginUser = res.data;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    history.push(loginPath);</span><br><span class="line">  &#125;</span><br><span class="line">  return state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  è¿”å›<strong>src&#x2F;pages&#x2F;User&#x2F;Login&#x2F;index.tsx</strong>ä¸‹çš„<strong>handleSubmit</strong> Â  è®¾ç½®ç™»å½•çŠ¶æ€ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const handleSubmit = async (values: API.UserLoginRequest) =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    // ç™»å½•</span><br><span class="line">    const res = await userLoginUsingPOST(&#123; ...values &#125;);</span><br><span class="line">    if (res.data) &#123;</span><br><span class="line">      const urlParams = new URL(window.location.href).searchParams;</span><br><span class="line">      history.push(urlParams.get(&#x27;redirect&#x27;)  &#x27;/&#x27;);</span><br><span class="line">      setInitialState(&#123;</span><br><span class="line">        loginUser: res.data</span><br><span class="line">      &#125;);</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    const defaultLoginFailureMessage = intl.formatMessage(&#123;</span><br><span class="line">      id: &#x27;pages.login.failure&#x27;,</span><br><span class="line">      defaultMessage: &#x27;ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•ï¼&#x27;,</span><br><span class="line">    &#125;);</span><br><span class="line">    console.log(error);</span><br><span class="line">    message.error(defaultLoginFailureMessage);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Â  æµ‹è¯• Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230113103454564.png"> Â  æˆåŠŸè¿›å…¥ Â  <strong>Butï¼Œ æœ‰bugï¼Œæˆ‘ä»¬åˆ·æ–°ä¸€ä¸‹å‘ç°åˆè¦é‡æ–°ç™»å½•ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</strong> Â  æˆ‘ä»¬æ¨æµ‹æ˜¯å‰ç«¯å‘åç«¯å‘é€è¯·æ±‚çš„æ—¶å€™æ²¡æœ‰å¸¦ä¸Š<strong>cookie</strong>ï¼ï¼ï¼ Â  æ‰¾åˆ°<strong>requestConfig.ts</strong> Â  æ·»åŠ  Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">withCredentials: true,</span><br></pre></td></tr></table></figure>

<p>Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export const requestConfig: RequestConfig = &#123;</span><br><span class="line">  baseURL: &#x27;http://localhost:7529&#x27;,</span><br><span class="line">  withCredentials: true,</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  åˆ·æ–°æµ‹è¯•ä¸€ä¸‹ é—®é¢˜è§£å†³ Â </p>
<h3 id="4ã€æ³¨é”€"><a href="#4ã€æ³¨é”€" class="headerlink" title="4ã€æ³¨é”€"></a>4ã€æ³¨é”€</h3><p>Â  å’Œç™»å½•å·®ä¸å¤šï¼ŒåŒç† Â  å…¨å±€æœç´¢logout Â  å‘ç°åœ¨<strong>src&#x2F;components&#x2F;RightContent&#x2F;AvatarDropdown.tsx</strong>ä¸­æœ‰loginOut() å°†å…¶æ”¹æˆæˆ‘ä»¬çš„åç«¯æ–¹æ³• Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const onMenuClick = useCallback(</span><br><span class="line">  (event: MenuInfo) =&gt; &#123;</span><br><span class="line">    const &#123; key &#125; = event;</span><br><span class="line">    if (key === &#x27;logout&#x27;) &#123;</span><br><span class="line">      flushSync(() =&gt; &#123;</span><br><span class="line">        setInitialState((s) =&gt; (&#123; ...s, currentUser: undefined &#125;));</span><br><span class="line">      &#125;);</span><br><span class="line">      userLogoutUsingPOST()</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">    history.push(`/account/$&#123;key&#125;`);</span><br><span class="line">  &#125;,</span><br><span class="line">  [setInitialState],</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>Â  <strong>è‡ªåŠ¨ç”Ÿæˆçš„å¥½å¤„</strong> Â  å¦‚æœæˆ‘ä»¬åç«¯çš„å®ä½“ç±»ä¿®æ”¹äº†,æˆ‘ä»¬å¯ä»¥ç›´æ¥è¿è¡ŒÂ <strong>openapi</strong>Â æ¥ç›´æ¥æ›´æ–° Â </p>
<h3 id="5ã€ç®¡ç†æƒé™"><a href="#5ã€ç®¡ç†æƒé™" class="headerlink" title="5ã€ç®¡ç†æƒé™"></a>5ã€ç®¡ç†æƒé™</h3><p>Â  æ˜¯å¦ä¸ºç®¡ç†å‘˜ Â  æ‰“å¼€<strong>access.ts</strong> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @see https://umijs.org/zh-CN/plugins/plugin-access</span><br><span class="line"> * */</span><br><span class="line">export default function access(initialState: &#123; currentUser?: API.CurrentUser &#125;  undefined) &#123;</span><br><span class="line">  const &#123; currentUser &#125; = initialState ?? &#123;&#125;;</span><br><span class="line">  return &#123;</span><br><span class="line">    canAdmin: currentUser &amp;&amp; currentUser.access === &#x27;admin&#x27;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å°†canAdminæ”¹æˆ</span><br><span class="line">canAdmin: true,</span><br></pre></td></tr></table></figure>

<p>Â  å‘ç°å‰ç«¯ç®¡ç†ç•Œé¢å‡ºæ¥äº†ï¼Œæ‰€ä»¥é€»è¾‘å°±æ˜¯åœ¨è¿™é‡Œæ§åˆ¶çš„ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230113104939414.png"> Â  æ‰€ä»¥ä»£ç ä¿®æ”¹å¦‚ä¸‹ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export default function access(initialState: InitialState  undefined) &#123;</span><br><span class="line">  const &#123; loginUser &#125; = initialState ?? &#123;&#125;;</span><br><span class="line">  return &#123;</span><br><span class="line">    canUser: loginUser,</span><br><span class="line">    canAdmin: loginUser?.userRole === &#x27;admin&#x27;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h3 id="6ã€è¡¨æ ¼é¡µé¢"><a href="#6ã€è¡¨æ ¼é¡µé¢" class="headerlink" title="6ã€è¡¨æ ¼é¡µé¢"></a>6ã€è¡¨æ ¼é¡µé¢</h3><p>Â  æ‰¾åˆ°<strong>src&#x2F;pages&#x2F;TableList&#x2F;index.tsx</strong> Â  æ‰¾åˆ°<strong>columns</strong> Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230113112228199.png"> Â  æ¢æˆæˆ‘ä»¬è‡ªå·±çš„ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">const columns: ProColumns&lt;API.InterfaceInfo&gt;[] = [</span><br><span class="line">    &#123;</span><br><span class="line">      title: &#x27;id&#x27;,</span><br><span class="line">      dataIndex: &#x27;id&#x27;,</span><br><span class="line">      valueType: &#x27;index&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">      title: &#x27;æ¥å£åç§°&#x27;,</span><br><span class="line">      dataIndex: &#x27;name&#x27;,</span><br><span class="line">      valueType: &#x27;text&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      title: &#x27;æè¿°&#x27;,</span><br><span class="line">      dataIndex: &#x27;description&#x27;,</span><br><span class="line">      valueType: &#x27;textarea&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      title: &#x27;è¯·æ±‚æ–¹æ³•&#x27;,</span><br><span class="line">      dataIndex: &#x27;method&#x27;,</span><br><span class="line">      valueType: &#x27;text&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      title: &#x27;url&#x27;,</span><br><span class="line">      dataIndex: &#x27;url&#x27;,</span><br><span class="line">      valueType: &#x27;text&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      title: &#x27;è¯·æ±‚å¤´&#x27;,</span><br><span class="line">      dataIndex: &#x27;requestHeader&#x27;,</span><br><span class="line">      valueType: &#x27;textarea&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      title: &#x27;å“åº”å¤´&#x27;,</span><br><span class="line">      dataIndex: &#x27;responseHeader&#x27;,</span><br><span class="line">      valueType: &#x27;textarea&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      title: &#x27;çŠ¶æ€&#x27;,</span><br><span class="line">      dataIndex: &#x27;status&#x27;,</span><br><span class="line">      hideInForm: true,</span><br><span class="line">      valueEnum: &#123;</span><br><span class="line">        0: &#123;</span><br><span class="line">          text: &#x27;å…³é—­&#x27;,</span><br><span class="line">          status: &#x27;Default&#x27;,</span><br><span class="line">        &#125;,</span><br><span class="line">        1: &#123;</span><br><span class="line">          text: &#x27;å¼€å¯&#x27;,</span><br><span class="line">          status: &#x27;Processing&#x27;,</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      title: &#x27;åˆ›å»ºæ—¶é—´&#x27;,</span><br><span class="line">      dataIndex: &#x27;createTime&#x27;,</span><br><span class="line">      valueType: &#x27;dateTime&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      title: &#x27;æ›´æ–°æ—¶é—´&#x27;,</span><br><span class="line">      dataIndex: &#x27;updateTime&#x27;,</span><br><span class="line">      valueType: &#x27;dateTime&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      title: &#x27;æ“ä½œ&#x27;,</span><br><span class="line">      dataIndex: &#x27;option&#x27;,</span><br><span class="line">      valueType: &#x27;option&#x27;,</span><br><span class="line">      render: (_, record) =&gt; [</span><br><span class="line">        &lt;a</span><br><span class="line">          key=&quot;config&quot;</span><br><span class="line">          onClick=&#123;() =&gt; &#123;</span><br><span class="line">            handleUpdateModalVisible(true);</span><br><span class="line">            setCurrentRow(record);</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          é…ç½®</span><br><span class="line">        &lt;/a&gt;,</span><br><span class="line">        &lt;a key=&quot;subscribeAlert&quot; href=&quot;https://procomponents.ant.design/&quot;&gt;</span><br><span class="line">          è®¢é˜…è­¦æŠ¥</span><br><span class="line">        &lt;/a&gt;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br></pre></td></tr></table></figure>

<p>Â  åŠ è½½å‡ºæ¥äº† Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230113113509859.png"> Â  ä½†æ˜¯æ²¡æœ‰æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦è®©å®ƒæœ‰æ•°æ® Â  å‘ä¸‹æ‰¾ï¼Œå‘ç°æœ‰ä¸€ä¸ª<strong>request</strong>æˆ‘ä»¬éœ€è¦å°†ä»–æ”¹æˆè‡ªå·±çš„listInterfaceInfoByPageUsingGET è¿™æ ·å°±æœ‰æ•°æ®äº† Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230113113932612.png"> Â  åˆ·æ–°æŸ¥çœ‹é¡µé¢ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230113114748766.png"> Â  æ— æ³•åŠ è½½ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°æ•°æ®å·²ç»æœ‰äº† Â  å¯¹äºè¿™ç§é”™è¯¯ï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥ Â </p>
<ul>
<li><p>ä½ çš„è¯·æ±‚å‚æ•°å’Œä»–çš„è¯·æ±‚å‚æ•°æ˜¯å¦ä¸€è‡´</p>
</li>
<li><p>ä½ çš„å“åº”å€¼å’Œä»–è¦æ±‚çš„å“åº”å€¼æ˜¯å¦ä¸€è‡´</p>
</li>
</ul>
<p>Â  æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½å®Œå…¨æ›¿æ¢ Â  æŸ¥çœ‹<strong>request</strong>çš„è¯·æ±‚å‚æ•° Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">request?: (params: U &amp; &#123;</span><br><span class="line">  pageSize?: number;</span><br><span class="line">  current?: number;</span><br><span class="line">  keyword?: string;</span><br><span class="line">&#125;, sort: Record&lt;string, SortOrder&gt;, filter: Record&lt;string, React.ReactText[]  null&gt;) =&gt; Promise&lt;Partial&lt;RequestData&lt;T&gt;&gt;&gt;;</span><br></pre></td></tr></table></figure>

<p>Â  åœ¨<strong>request</strong>åœ¨ç‚¹å‡»<strong>RequestData</strong>Â æŸ¥çœ‹å“åº”å‚æ•° Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export type RequestData&lt;T&gt; = &#123;</span><br><span class="line">    data: T[]  undefined;</span><br><span class="line">    success?: boolean;</span><br><span class="line">    total?: number;</span><br><span class="line">&#125; &amp; Record&lt;string, any&gt;;</span><br></pre></td></tr></table></figure>

<p>Â  æ‰€ä»¥åˆšåˆšç®€å•æ›¿æ¢è¯·æ±‚æ–¹æ³•çš„ä»£ç æˆ‘ä»¬é‡æ–°å†™ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">request=&#123;async (</span><br><span class="line">         params: &#123;</span><br><span class="line">         pageSize?: number;</span><br><span class="line">         current?: number;</span><br><span class="line">         keyword?: string;</span><br><span class="line">        &#125;, sort: Record&lt;string, SortOrder&gt;,  filter: Record&lt;string, React.ReactText[]  null&gt;,) =&gt; &#123;</span><br><span class="line">          const res = await listInterfaceInfoByPageUsingGET(&#123; ...params &#125;);</span><br><span class="line">          if (res.data) &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">              data: res.data.records  [],</span><br><span class="line">              success: true,</span><br><span class="line">              total: res.data.total,</span><br><span class="line">            &#125;;</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">              data: [],</span><br><span class="line">              success: false,</span><br><span class="line">              total: 0,</span><br><span class="line">            &#125;;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>Â  åˆ·æ–°é¡µé¢ï¼Œæ˜¾ç¤ºæˆåŠŸ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230113121556718.png"> Â </p>
<h1 id="äºŒã€åŸºç¡€å¢åˆ æ”¹æŸ¥"><a href="#äºŒã€åŸºç¡€å¢åˆ æ”¹æŸ¥" class="headerlink" title="äºŒã€åŸºç¡€å¢åˆ æ”¹æŸ¥"></a>äºŒã€åŸºç¡€å¢åˆ æ”¹æŸ¥</h1><hr>
<h2 id="1ã€ä¿®æ”¹è·¯ç”±"><a href="#1ã€ä¿®æ”¹è·¯ç”±" class="headerlink" title="1ã€ä¿®æ”¹è·¯ç”±"></a>1ã€ä¿®æ”¹è·¯ç”±</h2><hr>
<p>æ‰“å¼€<strong>config</strong>åŒ…æ‰¾åˆ°Â <strong>routes.ts</strong> Â  å°†åŸæ¥pagesä¸‹çš„<strong>TableList</strong>è¡¨å•åç§°æ”¹ä¸ºæˆ‘ä»¬çš„<strong>interfaceInfo</strong>ï¼Œå†æŠŠæ¥å£ç®¡ç†é¡µé¢é…ç½®åˆ°ç®¡ç†å‘˜é¡µé¢ä¸‹ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  name: &#x27;æ¥å£ç®¡ç†&#x27;,</span><br><span class="line">  icon: &#x27;table&#x27;,</span><br><span class="line">  path: &#x27;/admin/interface_info&#x27;,</span><br><span class="line">  component: &#x27;./InterfaceInfo&#x27;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">export default [</span><br><span class="line">  &#123;</span><br><span class="line">    path: &#x27;/user&#x27;,</span><br><span class="line">    layout: false,</span><br><span class="line">    routes: [</span><br><span class="line">      &#123;</span><br><span class="line">        name: &#x27;login&#x27;,</span><br><span class="line">        path: &#x27;/user/login&#x27;,</span><br><span class="line">        component: &#x27;./User/Login&#x27;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: &#x27;/welcome&#x27;,</span><br><span class="line">    name: &#x27;welcome&#x27;,</span><br><span class="line">    icon: &#x27;smile&#x27;,</span><br><span class="line">    component: &#x27;./Welcome&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: &#x27;/admin&#x27;,</span><br><span class="line">    name: &#x27;admin&#x27;,</span><br><span class="line">    icon: &#x27;crown&#x27;,</span><br><span class="line">    access: &#x27;canAdmin&#x27;,</span><br><span class="line">    routes: [</span><br><span class="line">      &#123;</span><br><span class="line">        path: &#x27;/admin&#x27;,</span><br><span class="line">        redirect: &#x27;/admin/sub-page&#x27;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: &#x27;/admin/sub-page&#x27;,</span><br><span class="line">        name: &#x27;sub-page&#x27;,</span><br><span class="line">        component: &#x27;./Admin&#x27;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: &#x27;æ¥å£ç®¡ç†&#x27;,</span><br><span class="line">        icon: &#x27;table&#x27;,</span><br><span class="line">        path: &#x27;/admin/interface_info&#x27;,</span><br><span class="line">        component: &#x27;./InterfaceInfo&#x27;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: &#x27;/&#x27;,</span><br><span class="line">    redirect: &#x27;/welcome&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: &#x27;*&#x27;,</span><br><span class="line">    layout: false,</span><br><span class="line">    component: &#x27;./404&#x27;,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>Â  æ•ˆæœå¦‚ä¸‹ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230113145422228.png"> Â </p>
<h2 id="2ã€æ–°å¢æ¥å£ä¿¡æ¯"><a href="#2ã€æ–°å¢æ¥å£ä¿¡æ¯" class="headerlink" title="2ã€æ–°å¢æ¥å£ä¿¡æ¯"></a>2ã€æ–°å¢æ¥å£ä¿¡æ¯</h2><hr>
<h3 id="1ï¼‰è¡¨å•æ¨¡å—"><a href="#1ï¼‰è¡¨å•æ¨¡å—" class="headerlink" title="1ï¼‰è¡¨å•æ¨¡å—"></a>1ï¼‰è¡¨å•æ¨¡å—</h3><p>Â  <strong>interfaceInfo</strong>ä¸­çš„<strong>index.tsx</strong>æ‰¾åˆ°æ–°å»ºçš„Button Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230113153334776.png"> Â  æˆ‘ä»¬ç‚¹å‡»æ–°å»ºçš„æ—¶å€™ï¼Œä»–ä¼šæ‰“å¼€ä¸€ä¸ªæ¨¡æ€æ¡†ã€‚å¾€ä¸‹æ‰¾ï¼Œå‘ç°å®ƒå·²ç»ç»™æˆ‘ä»¬æä¾›äº†è¿™ä¸ªç»„ä»¶ã€‚ä½†æ˜¯æˆ‘ä»¬éœ€è¦é‡æ–°å†™ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230113153512970.png"> Â  æˆ‘ä»¬å¯ä»¥å°±åƒæ›´æ–°æ¨¡æ€æ¡†ä¸€æ ·æ–°å»ºä¸€ä¸ªCreateModal.tsx Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230113153639726.png"> Â  æ¥ä¸‹æ¥ä¿®æ”¹ä»UpdateFormä¸­ç²˜è´´çš„<strong>CreateModal.tsx</strong>çš„ä»£ç  Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Modal &#125; from &#x27;antd&#x27;;</span><br><span class="line">import React from &#x27;react&#x27;;</span><br><span class="line">import &#123; ProColumns, ProTable &#125; from &#x27;@ant-design/pro-components&#x27;;</span><br><span class="line">import &#x27;@umijs/max&#x27;;</span><br><span class="line"></span><br><span class="line">export type Props = &#123;</span><br><span class="line">  columns: ProColumns&lt;API.InterfaceInfo&gt;[];</span><br><span class="line">  onCancel: () =&gt; void;</span><br><span class="line">  onSubmit: (values: API.InterfaceInfo) =&gt; Promise&lt;boolean&gt;;</span><br><span class="line">  open: boolean;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const CreateModal: React.FC&lt;Props&gt; = (props) =&gt; &#123;</span><br><span class="line">  const &#123; columns, open, onCancel &#125; = props;</span><br><span class="line">  return (</span><br><span class="line">    &lt;Modal open=&#123;open&#125; onCancel=&#123;() =&gt; onCancel?.()&#125;&gt;</span><br><span class="line">      &lt;ProTable columns=&#123;columns&#125; /&gt;</span><br><span class="line">    &lt;/Modal&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default CreateModal;</span><br></pre></td></tr></table></figure>

<p>Â  <strong>è¿™é‡Œæˆ‘ä»¬å¤ç”¨äº†indexä¸­çš„columns</strong>Â Â è¿™é‡Œæˆ‘é¡ºä¾¿æŠŠå–æ¶ˆä¹Ÿå†™äº† Â  åœ¨<strong>index.tsx</strong>ä¸­ä½¿ç”¨ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  /**</span><br><span class="line">   * @en-US Pop-up window of new window</span><br><span class="line">   * @zh-CN æ–°å»ºçª—å£çš„å¼¹çª—</span><br><span class="line">   *  */</span><br><span class="line">  const [createModalOpen, handleModalOpen] = useState&lt;boolean&gt;(false);</span><br><span class="line"></span><br><span class="line"> const columns: ProColumns&lt;API.InterfaceInfo&gt;[] = [</span><br><span class="line">    &#123;</span><br><span class="line">      title: &#x27;id&#x27;,</span><br><span class="line">      dataIndex: &#x27;id&#x27;,</span><br><span class="line">      valueType: &#x27;index&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">   // ...</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">// ...</span><br><span class="line">&lt;CreateModal</span><br><span class="line">    columns=&#123;columns&#125;</span><br><span class="line">    onCancel=&#123;() =&gt; handleModalOpen(false)&#125;</span><br><span class="line">    onSubmit=&#123;() =&gt; &#123;&#125;&#125;</span><br><span class="line">    open=&#123;createModalOpen&#125;</span><br><span class="line">  /&gt;</span><br></pre></td></tr></table></figure>

<p>Â  æµ‹è¯•ä¸€ä¸‹ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230113164234500.png"> Â  emmmmâ€¦ è¿™æ˜¯ä»€ä¹ˆç©æ„?? Â  æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£å¯çŸ¥ï¼Œè¿™æ˜¯ProTableçš„é»˜è®¤type æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»™å®ƒæŒ‡å®šä¸€ä¸ªformçš„type Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const CreateModal: React.FC&lt;Props&gt; = (props) =&gt; &#123;</span><br><span class="line">  const &#123; columns, open, onCancel &#125; = props;</span><br><span class="line">  return (</span><br><span class="line">    &lt;Modal open=&#123;open&#125; onCancel=&#123;() =&gt; onCancel?.()&#125;&gt;</span><br><span class="line">      &lt;ProTable columns=&#123;columns&#125; type=&#123;&#x27;form&#x27;&#125; /&gt;</span><br><span class="line">    &lt;/Modal&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Â  å†æµ‹è¯•ä¸€ä¸‹å°±æ­£å¸¸å•¦~ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230113164846052.png"> Â  å‘ç°åˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´æˆ‘ä»¬å¹¶ä¸éœ€è¦ã€‚å¢åŠ hideInFormå±æ€§ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  title: &#x27;åˆ›å»ºæ—¶é—´&#x27;,</span><br><span class="line">  dataIndex: &#x27;createTime&#x27;,</span><br><span class="line">  valueType: &#x27;dateTime&#x27;,</span><br><span class="line">  hideInForm: true,</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  title: &#x27;æ›´æ–°æ—¶é—´&#x27;,</span><br><span class="line">  dataIndex: &#x27;updateTime&#x27;,</span><br><span class="line">  valueType: &#x27;dateTime&#x27;,</span><br><span class="line">  hideInForm: true,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h3 id="2ï¼‰è¯·æ±‚åç«¯"><a href="#2ï¼‰è¯·æ±‚åç«¯" class="headerlink" title="2ï¼‰è¯·æ±‚åç«¯"></a>2ï¼‰è¯·æ±‚åç«¯</h3><p>Â  <strong>å…ˆç®€å•å¤„ç†ä¸€ä¸‹è¯·æ±‚æŠ¥é”™çš„æƒ…å†µ</strong> Â  æ‰¾åˆ°src&#x2F;requestConfig.ts ä¿®æ”¹ä¸€ä¸‹å“åº”æ‹¦æˆªå™¨ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// å“åº”æ‹¦æˆªå™¨</span><br><span class="line">responseInterceptors: [</span><br><span class="line">  (response) =&gt; &#123;</span><br><span class="line">    // æ‹¦æˆªå“åº”æ•°æ®ï¼Œè¿›è¡Œä¸ªæ€§åŒ–å¤„ç†</span><br><span class="line">    const &#123; data &#125; = response as unknown as ResponseStructure;</span><br><span class="line">    console.log(&#x27;data&#x27;, data);</span><br><span class="line">    if (data.code !== 0) &#123;</span><br><span class="line">      throw new Error(data.message);</span><br><span class="line">    &#125;</span><br><span class="line">    return response;</span><br><span class="line">  &#125;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p>Â  å†åœ¨interfaceinfo&#x2F;index.tsxä¸­æ–°å¢è¯·æ±‚åç«¯çš„æ–¹æ³• Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">  const handleAddInterfaceInfo = async (fields: API.InterfaceInfoAddRequest) =&gt; &#123;</span><br><span class="line">    const hide = message.loading(&#x27;æ­£åœ¨æ·»åŠ &#x27;);</span><br><span class="line">    try &#123;</span><br><span class="line">      await addInterfaceInfoUsingPOST(&#123; ...fields &#125;);</span><br><span class="line">      hide();</span><br><span class="line">      message.success(&#x27;åˆ›å»ºæˆåŠŸ!&#x27;);</span><br><span class="line">      // å…³é—­Modal</span><br><span class="line">      handleModalOpen(false);</span><br><span class="line">      return true;</span><br><span class="line">    &#125; catch (error: any) &#123;</span><br><span class="line">      hide();</span><br><span class="line">      console.log(error);</span><br><span class="line">      message.error(&#x27;åˆ›å»ºå¤±è´¥!&#x27; + error.message);</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">// ...</span><br><span class="line"></span><br><span class="line">&lt;CreateModal</span><br><span class="line">  columns=&#123;columns&#125;</span><br><span class="line">  onCancel=&#123;() =&gt; handleModalOpen(false)&#125;</span><br><span class="line">  onSubmit=&#123;(values) =&gt; handleAddInterfaceInfo(values)&#125;</span><br><span class="line">  open=&#123;createModalOpen&#125;</span><br><span class="line">  /&gt;</span><br></pre></td></tr></table></figure>

<p>Â  å†ä¿®æ”¹CreateModal.tsx Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const CreateModal: React.FC&lt;Props&gt; = (props) =&gt; &#123;</span><br><span class="line">  const &#123; columns, open, onCancel, onSubmit &#125; = props;</span><br><span class="line">  return (</span><br><span class="line">    &lt;Modal title=&#123;&#x27;æ–°å»ºæ¥å£&#x27;&#125; open=&#123;open&#125; onCancel=&#123;() =&gt; onCancel?.()&#125;&gt;</span><br><span class="line">      &lt;ProTable columns=&#123;columns&#125; type=&#123;&#x27;form&#x27;&#125; onSubmit=&#123;async (value) =&gt; onSubmit?.(value)&#125; /&gt;</span><br><span class="line">    &lt;/Modal&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Â  æµ‹è¯•æ·»åŠ æˆåŠŸ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230113183349785.png"> Â </p>
<h2 id="3ã€ç¼–è¾‘æ¥å£ä¿¡æ¯"><a href="#3ã€ç¼–è¾‘æ¥å£ä¿¡æ¯" class="headerlink" title="3ã€ç¼–è¾‘æ¥å£ä¿¡æ¯"></a>3ã€ç¼–è¾‘æ¥å£ä¿¡æ¯</h2><hr>
<p>å…ˆæŠŠModalçš„footerå¹²æ‰ Â  footer&#x3D;{null} Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Modal title=&#123;&#x27;æ›´æ–°æ¥å£&#x27;&#125; footer=&#123;null&#125; open=&#123;open&#125; onCancel=&#123;() =&gt; onCancel?.()&#125;&gt;</span><br><span class="line">  // ...</span><br><span class="line">  );</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h3 id="1ï¼‰è¡¨å•æ¨¡å—-1"><a href="#1ï¼‰è¡¨å•æ¨¡å—-1" class="headerlink" title="1ï¼‰è¡¨å•æ¨¡å—"></a>1ï¼‰è¡¨å•æ¨¡å—</h3><p>Â  æ–°å»ºæ–‡ä»¶src&#x2F;pages&#x2F;InterfaceInfo&#x2F;components&#x2F;UpdateModal.tsx Â  è¿™é‡Œä½¿ç”¨çš„useRefã€formRefå‚è€ƒäº†<a target="_blank" rel="noopener" href="https://procomponents.ant.design/components/table#%E9%80%9A%E8%BF%87-formref-%E6%9D%A5%E6%93%8D%E4%BD%9C%E6%9F%A5%E8%AF%A2%E8%A1%A8%E5%8D%95">å®˜æ–¹æ–‡æ¡£</a> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Modal &#125; from &#x27;antd&#x27;;</span><br><span class="line">import React, &#123;useEffect, useRef&#125; from &#x27;react&#x27;;</span><br><span class="line">import &#123; ProColumns, ProFormInstance, ProTable &#125; from &#x27;@ant-design/pro-components&#x27;;</span><br><span class="line">import &#x27;@umijs/max&#x27;;</span><br><span class="line"></span><br><span class="line">export type Props = &#123;</span><br><span class="line">  value: API.InterfaceInfo;</span><br><span class="line">  columns: ProColumns&lt;API.InterfaceInfoUpdateRequest&gt;[];</span><br><span class="line">  onCancel: () =&gt; void;</span><br><span class="line">  onSubmit: (values: API.InterfaceInfoUpdateRequest) =&gt; Promise&lt;void&gt;;</span><br><span class="line">  open: boolean;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const UpdateModal: React.FC&lt;Props&gt; = (props) =&gt; &#123;</span><br><span class="line">  const &#123; value, columns, open, onCancel, onSubmit &#125; = props;</span><br><span class="line"></span><br><span class="line">  const formRef = useRef&lt;ProFormInstance&gt;();</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    if (formRef) &#123;</span><br><span class="line">      formRef.current?.setFieldsValue(value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [value]);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;Modal title=&#123;&#x27;æ›´æ–°æ¥å£&#x27;&#125; footer=&#123;null&#125; open=&#123;open&#125; onCancel=&#123;() =&gt; onCancel?.()&#125;&gt;</span><br><span class="line">      &lt;ProTable</span><br><span class="line">        columns=&#123;columns&#125;</span><br><span class="line">        formRef=&#123;formRef&#125;</span><br><span class="line">        type=&#123;&#x27;form&#x27;&#125;</span><br><span class="line">        onSubmit=&#123;async (value) =&gt; onSubmit?.(value)&#125;</span><br><span class="line">        // è®¾ç½®é»˜è®¤å€¼</span><br><span class="line">        form=&#123;&#123; initialValues: value &#125;&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/Modal&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default UpdateModal;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h3 id="2ï¼‰è¯·æ±‚åç«¯-1"><a href="#2ï¼‰è¯·æ±‚åç«¯-1" class="headerlink" title="2ï¼‰è¯·æ±‚åç«¯"></a>2ï¼‰è¯·æ±‚åç«¯</h3><p>Â  åœ¨interfaceinfo&#x2F;index.tsxä¸­æ–°å¢è¯·æ±‚åç«¯çš„æ–¹æ³• Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">  /**</span><br><span class="line">   * @en-US Update InterfaceInfo</span><br><span class="line">   * @zh-CN æ›´æ–°æ¥å£ä¿¡æ¯</span><br><span class="line">   *</span><br><span class="line">   * @param updateValue</span><br><span class="line">   */</span><br><span class="line">  const handleUpdateInterfaceInfo = async (updateValue: API.InterfaceInfoUpdateRequest) =&gt; &#123;</span><br><span class="line">    const hide = message.loading(&#x27;æ­£åœ¨æ›´æ–°&#x27;);</span><br><span class="line">    try &#123;</span><br><span class="line">      let res = await updateInterfaceInfoUsingPOST(&#123; ...updateValue &#125;);</span><br><span class="line">      if (res.data) &#123;</span><br><span class="line">        hide();</span><br><span class="line">        handleUpdateModalOpen(false);</span><br><span class="line">        message.success(&#x27;æ›´æ–°æˆåŠŸ!&#x27;);</span><br><span class="line">        return true;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; catch (error: any) &#123;</span><br><span class="line">      hide();</span><br><span class="line">      message.error(&#x27;æ›´æ–°å¤±è´¥!&#x27; + error.message);</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;      </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// è¿™é‡Œçš„&lt;UpdateModal/&gt;ä»£ç æ˜¯åœ¨åŸæœ‰çš„ &lt;UpdateForm/&gt; åŸºç¡€ä¸Šé¢æ”¹çš„</span><br><span class="line">&lt;UpdateModal</span><br><span class="line">        value=&#123;currentRow  &#123;&#125;&#125;</span><br><span class="line">        columns=&#123;columns&#125;</span><br><span class="line">        open=&#123;updateModalOpen&#125;</span><br><span class="line">        onSubmit=&#123;async (value) =&gt; &#123;</span><br><span class="line">          const success = await handleUpdateInterfaceInfo(value);</span><br><span class="line">          if (success) &#123;</span><br><span class="line">            handleUpdateModalOpen(false);</span><br><span class="line">            setCurrentRow(undefined);</span><br><span class="line">            if (actionRef.current) &#123;</span><br><span class="line">              actionRef.current.reload();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">        onCancel=&#123;() =&gt; &#123;</span><br><span class="line">          handleUpdateModalOpen(false);</span><br><span class="line">          if (!showDetail) &#123;</span><br><span class="line">            setCurrentRow(undefined);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      /&gt;</span><br></pre></td></tr></table></figure>

<p>Â  å‡ºé”™äº†ï¼ŒçŒœæµ‹æ˜¯Ant Design Proçš„é—®é¢˜ï¼ŒçŒœé”™äº†ï¼Œå…¶å®æ˜¯columnsä¸­çš„idçš„typeä¸ºindexçš„åŸå› ã€‚å¹¶æ²¡æœ‰idå­—æ®µï¼Œæ‰€ä»¥æˆ‘æ‰‹åŠ¨ç»™ä¸€ä¸‹ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230113222955554.png"> Â  ä¿®æ”¹ä»£ç å¦‚ä¸‹ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">   * @en-US Update InterfaceInfo</span><br><span class="line">   * @zh-CN æ›´æ–°æ¥å£ä¿¡æ¯</span><br><span class="line">   *</span><br><span class="line">   * @param fields</span><br><span class="line">   */</span><br><span class="line">  const handleUpdateInterfaceInfo = async (fields: API.InterfaceInfoUpdateRequest) =&gt; &#123;</span><br><span class="line">    const hide = message.loading(&#x27;æ­£åœ¨æ›´æ–°&#x27;);</span><br><span class="line">    try &#123;</span><br><span class="line">      if(!currentRow)&#123;</span><br><span class="line">        return false;</span><br><span class="line">      &#125;</span><br><span class="line">      let res = await updateInterfaceInfoUsingPOST(&#123;</span><br><span class="line">        // å› ä¸ºcolumnsä¸­çš„id valueTypeä¸ºindex ä¸ä¼šä¼ é€’ æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨èµ‹å€¼id</span><br><span class="line">        id: currentRow.id,</span><br><span class="line">        ...fields,</span><br><span class="line">      &#125;);</span><br><span class="line">      if (res.data) &#123;</span><br><span class="line">        hide();</span><br><span class="line">        handleUpdateModalOpen(false);</span><br><span class="line">        message.success(&#x27;æ›´æ–°æˆåŠŸ!&#x27;);</span><br><span class="line">        // åˆ·æ–°é¡µé¢</span><br><span class="line">        actionRef.current?.reload();</span><br><span class="line">        return true;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; catch (error: any) &#123;</span><br><span class="line">      hide();</span><br><span class="line">      message.error(&#x27;æ›´æ–°å¤±è´¥!&#x27; + error.message);</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<p>Â  æµ‹è¯•æ›´æ–°æˆåŠŸ~ Â </p>
<h2 id="4ã€åˆ é™¤æ¥å£ä¿¡æ¯"><a href="#4ã€åˆ é™¤æ¥å£ä¿¡æ¯" class="headerlink" title="4ã€åˆ é™¤æ¥å£ä¿¡æ¯"></a>4ã€åˆ é™¤æ¥å£ä¿¡æ¯</h2><hr>
<p><strong>åˆ é™¤æŒ‰é’®</strong> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// åœ¨columnsä¸­æ·»åŠ åˆ é™¤æŒ‰é’®</span><br><span class="line">&#123;</span><br><span class="line">      title: &#x27;æ“ä½œ&#x27;,</span><br><span class="line">      dataIndex: &#x27;option&#x27;,</span><br><span class="line">      valueType: &#x27;option&#x27;,</span><br><span class="line">      render: (_, record) =&gt; [</span><br><span class="line">        &lt;a</span><br><span class="line">          key=&quot;config&quot;</span><br><span class="line">          onClick=&#123;() =&gt; &#123;</span><br><span class="line">            handleUpdateModalOpen(true);</span><br><span class="line">            setCurrentRow(record);</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          ç¼–è¾‘</span><br><span class="line">        &lt;/a&gt;,</span><br><span class="line">        &lt;a</span><br><span class="line">          key=&quot;delete&quot;</span><br><span class="line">          onClick=&#123;() =&gt; &#123;</span><br><span class="line">            handleRemoveInterfaceInfo(record);</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          åˆ é™¤</span><br><span class="line">        &lt;/a&gt;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>Â  <strong>è°ƒç”¨æ–¹æ³•</strong> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const handleRemoveInterfaceInfo = async (record: API.InterfaceInfo) =&gt; &#123;</span><br><span class="line">  const hide = message.loading(&#x27;æ­£åœ¨åˆ é™¤&#x27;);</span><br><span class="line">  if (!record) return true;</span><br><span class="line">  try &#123;</span><br><span class="line">    await deleteInterfaceInfoUsingPOST(&#123;</span><br><span class="line">      id: record.id,</span><br><span class="line">    &#125;);</span><br><span class="line">    hide();</span><br><span class="line">    message.success(&#x27;åˆ é™¤æˆåŠŸ!&#x27;);</span><br><span class="line">    // åˆ·æ–°é¡µé¢</span><br><span class="line">    actionRef.current?.reload();</span><br><span class="line">    return true;</span><br><span class="line">  &#125; catch (error: any) &#123;</span><br><span class="line">    hide();</span><br><span class="line">    message.error(&#x27;åˆ é™¤å¤±è´¥!&#x27; + error.message);</span><br><span class="line">    return false;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Â  æµ‹è¯•åˆ é™¤æˆåŠŸ~ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230114154218713.png"> Â </p>
<h1 id="ä¸‰ã€APIå¼€å‘"><a href="#ä¸‰ã€APIå¼€å‘" class="headerlink" title="ä¸‰ã€APIå¼€å‘"></a>ä¸‰ã€APIå¼€å‘</h1><hr>
<h2 id="1ã€æ¨¡æ‹Ÿæ¥å£"><a href="#1ã€æ¨¡æ‹Ÿæ¥å£" class="headerlink" title="1ã€æ¨¡æ‹Ÿæ¥å£"></a>1ã€æ¨¡æ‹Ÿæ¥å£</h2><hr>
<p><strong>åˆ›å»ºé¡¹ç›®</strong> Â  å¿«é€Ÿåˆ›å»ºä¸€ä¸ªspring Booté¡¹ç›® å‹¾é€‰SpringWebã€Lombokã€Spring Boot DevTools Â  <strong>æä¾›ä¸‰ä¸ªæ¨¡æ‹Ÿæ¥å£</strong> Â  æ¥å£å¤§ä½“å†…å®¹ Â </p>
<ol>
<li><p>GET æ¥å£</p>
</li>
<li><p>POST æ¥å£ï¼ˆurlä¼ å‚ï¼‰</p>
</li>
<li><p>POSTæ¥å£ï¼ˆRestfulï¼‰</p>
</li>
</ol>
<p>Â  ç®€å•çš„é¡¹ç›®ç»“æ„ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230114233348076.png"> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">package com.xuan.controller;</span><br><span class="line"></span><br><span class="line">import com.xuan.model.User;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æ¨¡æ‹Ÿæ¥å£</span><br><span class="line"> * </span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @author: ç„</span><br><span class="line"> * @date: 2023/1/14</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/name&quot;)</span><br><span class="line">public class NameController &#123;</span><br><span class="line"></span><br><span class="line">@GetMapping(&quot;/&#123;name&#125;&quot;)</span><br><span class="line">public String getNameByGet(@PathVariable(value = &quot;name&quot;) String name) &#123;</span><br><span class="line">return &quot;å‘é€GETè¯·æ±‚ ä½ çš„åå­—æ˜¯ï¼š&quot; + name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@PostMapping()</span><br><span class="line">public String getNameByPost(@RequestParam(value = &quot;name&quot;) String name) &#123;</span><br><span class="line">return &quot;å‘é€POSTè¯·æ±‚ ä½ çš„åå­—æ˜¯ï¼š&quot; + name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@PostMapping(&quot;/user&quot;)</span><br><span class="line">public String getNameByPostWithJson(@RequestBody User user) &#123;</span><br><span class="line">return &quot;å‘é€POSTè¯·æ±‚ JSONä¸­ä½ çš„åå­—æ˜¯ï¼š&quot; + user.getName();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  application.ymlé…ç½®ä¸€ä¸‹ç«¯å£ã€ç„¶åæŒ‡å®šä¸€ä¸‹å…¨å±€æ¥å£çš„åœ°å€ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8123</span><br><span class="line">  servlet:</span><br><span class="line">    context-path: /api</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h2 id="2ã€è°ƒç”¨æ¥å£"><a href="#2ã€è°ƒç”¨æ¥å£" class="headerlink" title="2ã€è°ƒç”¨æ¥å£"></a>2ã€è°ƒç”¨æ¥å£</h2><hr>
<p><strong>å‡ ç§HTTPçš„è°ƒç”¨æ–¹å¼ï¼š</strong> Â </p>
<ol>
<li><p>HttpClient</p>
</li>
<li><p>RestTemplate</p>
</li>
<li><p>ç¬¬ä¸‰æ–¹åº“ï¼ˆOKHttpï¼ŒHutoolï¼‰</p>
</li>
</ol>
<p>Â  è¿™é‡Œæˆ‘ä½¿ç”¨äº†<strong>Hutool</strong>è°ƒç”¨Â <a target="_blank" rel="noopener" href="https://hutool.cn/docs/#/">hutoolæ–‡æ¡£</a> Â  mavenä¸­æ·»åŠ  Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;cn.hutool&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;hutool-all&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.8.11&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>Â  æŸ¥çœ‹æ–‡æ¡£ä¸­çš„Httpè¯·æ±‚ç›¸å…³ç”¨æ³• ç¼–å†™XuanApiClientç±» Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">package com.xuan.client;</span><br><span class="line"></span><br><span class="line">import cn.hutool.http.HttpRequest;</span><br><span class="line">import cn.hutool.http.HttpResponse;</span><br><span class="line">import cn.hutool.http.HttpUtil;</span><br><span class="line">import cn.hutool.json.JSONUtil;</span><br><span class="line">import com.xuan.model.User;</span><br><span class="line"></span><br><span class="line">import java.util.HashMap;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è°ƒç”¨APIä½¿ç”¨</span><br><span class="line"> *</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @author: ç„</span><br><span class="line"> * @date: 2023/1/15</span><br><span class="line"> */</span><br><span class="line">public class XuanApiClient &#123;</span><br><span class="line">public String getNameByGet(String name) &#123;</span><br><span class="line">return HttpUtil.get(&quot;http://localhost:8123/api/name/&quot; + name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public String getNameByPost(String name) &#123;</span><br><span class="line">// å¯ä»¥å•ç‹¬ä¼ å…¥httpå‚æ•°ï¼Œè¿™æ ·å‚æ•°ä¼šè‡ªåŠ¨åšURLç¼–ç ï¼Œæ‹¼æ¥åœ¨URLä¸­</span><br><span class="line">HashMap&lt;String, Object&gt; paramMap = new HashMap&lt;&gt;();</span><br><span class="line">paramMap.put(&quot;name&quot;, name);</span><br><span class="line">return HttpUtil.post(&quot;http://localhost:8123/api/name&quot;, paramMap);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public String getNameByPostWithJson(User user) &#123;</span><br><span class="line">String json = JSONUtil.toJsonStr(user);</span><br><span class="line">HttpResponse response = HttpRequest.post(&quot;http://localhost:8123/api/name/user&quot;)</span><br><span class="line">.body(json)</span><br><span class="line">.execute();</span><br><span class="line">System.out.println(&quot;response = &quot; + response);</span><br><span class="line">System.out.println(&quot;status = &quot; + response.getStatus());</span><br><span class="line">if (response.isOk()) &#123;</span><br><span class="line">return response.body();</span><br><span class="line">&#125;</span><br><span class="line">return &quot;fail&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  åˆ›å»ºæµ‹è¯•ç±»è°ƒç”¨æµ‹è¯• Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230115162508894.png"> Â </p>
<h1 id="å››ã€APIç­¾åè®¤è¯"><a href="#å››ã€APIç­¾åè®¤è¯" class="headerlink" title="å››ã€APIç­¾åè®¤è¯"></a>å››ã€APIç­¾åè®¤è¯</h1><hr>
<p><strong>æœ¬è´¨ï¼š</strong> Â </p>
<ol>
<li><p>ç­¾å‘ç­¾å</p>
</li>
<li><p>ä½¿ç”¨ç­¾åï¼ˆæ ¡éªŒç­¾åï¼‰</p>
</li>
</ol>
<p>Â  <strong>ä¸ºä»€ä¹ˆéœ€è¦</strong> Â  ä¿è¯å®‰å…¨æ€§ï¼Œä¸èƒ½éšä¾¿ä¸€ä¸ªäººå°±å¯ä»¥è°ƒç”¨ Â  <strong>æ€ä¹ˆå®ç°</strong> Â </p>
<ul>
<li><p><strong>accessKey</strong>Â è°ƒç”¨çš„æ ‡è¯†ï¼ˆå¤æ‚ï¼Œæ— åºï¼Œæ— è§„å¾‹ï¼‰</p>
</li>
<li><p><strong>secretKey</strong>Â å¯†é’¥ ï¼ˆå¤æ‚ï¼Œæ— åºï¼Œæ— è§„å¾‹ï¼‰</p>
</li>
</ul>
<p>Â  ç±»ä¼¼<strong>ç”¨æˆ·å</strong>å’Œ<strong>å¯†ç </strong>ï¼ŒåŒºåˆ«ï¼šaccessKeyã€secretKeyæ˜¯<strong>æ— çŠ¶æ€</strong>çš„ Â  åƒä¸‡ä¸èƒ½æŠŠå¯†é’¥ç›´æ¥åœ¨æœåŠ¡å™¨é—´è¿›è¡Œä¼ é€’ï¼Œæœ‰å¯èƒ½è¢«æ‹¦æˆª Â  åŠ å¯†çœ‹ç¬¬äºŒç‚¹ Â </p>
<h2 id="1ã€ä¿®æ”¹æ•°æ®åº“"><a href="#1ã€ä¿®æ”¹æ•°æ®åº“" class="headerlink" title="1ã€ä¿®æ”¹æ•°æ®åº“"></a>1ã€ä¿®æ”¹æ•°æ®åº“</h2><hr>
<p>ç”±äºæˆ‘ä»¬çš„<strong>userè¡¨</strong>é‡Œé¢æ²¡æœ‰access_keyã€secret_key æ‰€ä»¥æˆ‘ä»¬è¦ä¿®æ”¹æ•°æ®åº“è¡¨ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists user</span><br><span class="line">(</span><br><span class="line">    id            bigint auto_increment comment &#x27;id&#x27; primary key,</span><br><span class="line">    user_name     varchar(256)                           null comment &#x27;ç”¨æˆ·æ˜µç§°&#x27;,</span><br><span class="line">    user_account  varchar(256)                           not null comment &#x27;è´¦å·&#x27;,</span><br><span class="line">    user_avatar   varchar(1024)                          null comment &#x27;ç”¨æˆ·å¤´åƒ&#x27;,</span><br><span class="line">    gender        tinyint                                null comment &#x27;æ€§åˆ«&#x27;,</span><br><span class="line">    user_role     varchar(256) default &#x27;user&#x27;            not null comment &#x27;ç”¨æˆ·è§’è‰²ï¼šuser / admin&#x27;,</span><br><span class="line">    user_password varchar(512)                           not null comment &#x27;å¯†ç &#x27;,</span><br><span class="line">    access_key    varchar(256)                           null comment &#x27;access_key&#x27;,</span><br><span class="line">    secret_key    varchar(256)                           null comment &#x27;secret_key&#x27;,</span><br><span class="line">    create_time   datetime     default CURRENT_TIMESTAMP not null comment &#x27;åˆ›å»ºæ—¶é—´&#x27;,</span><br><span class="line">    update_time   datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment &#x27;æ›´æ–°æ—¶é—´&#x27;,</span><br><span class="line">    is_delete     tinyint      default 0                 not null comment &#x27;æ˜¯å¦åˆ é™¤&#x27;,</span><br><span class="line">    constraint uni_user_account</span><br><span class="line">        unique (user_account)</span><br><span class="line">) comment &#x27;ç”¨æˆ·&#x27;;</span><br></pre></td></tr></table></figure>

<p>Â  ç›´æ¥dropæ‰ä¹‹å‰çš„tableé‡æ–°å»ºè¡¨ï¼Œæ’å…¥ä¸€æ¡æµ‹è¯•æ•°æ®ã€‚ Â  æ ‡å‡†çš„è¯ åº”è¯¥æ–°å»ºä¸€ä¸ªè¡¨ ä¸»è¦å­—æ®µä¸ºæ¥å£idã€ä½¿ç”¨ç”¨æˆ·idã€access_keyã€secret_keyç­‰ç­‰ Â </p>
<h2 id="2ã€åŠ å¯†"><a href="#2ã€åŠ å¯†" class="headerlink" title="2ã€åŠ å¯†"></a>2ã€åŠ å¯†</h2><hr>
<h3 id="1ã€åŠ å¯†æ–¹å¼"><a href="#1ã€åŠ å¯†æ–¹å¼" class="headerlink" title="1ã€åŠ å¯†æ–¹å¼"></a>1ã€åŠ å¯†æ–¹å¼</h3><p>Â  å°†accessKeyã€secretKeyæ”¾åœ¨Headeré‡Œæ˜æ–‡ä¼ é€’å®‰å…¨å— Â  ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„<strong>è¯·æ±‚å¯èƒ½è¢«äººæ‹¦æˆª</strong>ï¼Œè€Œæˆ‘ä»¬æŠŠå¯†ç æ”¾è¿›è¯·æ±‚å¤´é‡Œé¢ï¼Œå¯èƒ½ä¼šè¢«åˆ«äººè·å– Â  ä¸€èˆ¬æ˜¯æ ¹æ®å¯†é’¥ï¼Œç”Ÿæˆ<strong>ç­¾åsign</strong> Â  <strong>åŠ å¯†æ–¹å¼</strong> Â </p>
<ol>
<li><p>å¯¹ç§°åŠ å¯†</p>
</li>
<li><p>éå¯¹ç§°åŠ å¯†</p>
</li>
<li><p>md5 ç­¾åï¼ˆä¸å¯è§£å¯†ï¼‰</p>
</li>
</ol>
<p>Â  <strong>ç­¾åçš„åšæ³•</strong> Â  å‡å¦‚ ï¼Œæˆ‘ä»¬æœ‰ç”¨æˆ·å‚æ•°ï¼Œæˆ‘ä»¬ç”¨å¯†é’¥ä¸ä»–æ‹¼æ¥ï¼Œç”¨ç­¾åç®—æ³•å¾—åˆ°ä¸€ä¸ªä¸å¯è§£å¯†çš„å€¼ Â  <strong>ç”¨æˆ·å‚æ•° + å¯†é’¥ &#x3D;&gt; ç­¾åç”Ÿæˆç®—æ³•ï¼ˆMD5,HMac,Sha1) &#x3D;&gt; ä¸å¯è§£å¯†çš„å€¼</strong> Â  ä¾‹å­ï¼š xuan + abc &#x3D;&gt; 7e7b9583aa0bc3e834fe8bcaebda38b5ï¼ˆè¿™é‡Œæ˜¯æˆ‘éšä¾¿è¾“çš„ï¼Œå¾—åˆ°çš„å€¼æ˜¯éšæœºçš„ï¼‰ Â  æ€ä¹ˆçŸ¥é“ç­¾åå¯¹ä¸å¯¹ï¼Ÿ Â  æœåŠ¡ç«¯ç”¨ä¸€æ¨¡ä¸€æ ·çš„å‚æ•°å’Œç®—æ³•å»ç”Ÿæˆç­¾åï¼Œåªè¦å’Œç”¨æˆ·ä¼ çš„ä¸€è‡´ï¼Œå°±è¡¨ç¤ºå¯†é’¥ä¸€è‡´ Â  <strong>æ€ä¹ˆé˜²é‡æ”¾ï¼Ÿ</strong> Â  åŠ nonceéšæœºæ•° åªèƒ½ç”¨ä¸€æ¬¡ Â  æœåŠ¡ç«¯è¦ä¿å­˜ç”¨è¿‡çš„éšæœºæ•° Â  åŠ timestamp æ—¶é—´æˆ³ï¼Œæ ¡éªŒå®ƒçš„æœ‰æ•ˆæœŸ Â  ç»¼ä¸Šæ‰€å± Â  <strong>ä¼ é€’çš„å‚æ•°</strong> Â </p>
<ol>
<li><p>accessKey</p>
</li>
<li><p>sign ï¼ˆç”±accessKey(æˆ–è€…ä½¿ç”¨ç”¨æˆ·è¯·æ±‚å‚æ•°bodyç­‰)ã€secretKeyåŠ å¯†è€Œæ¥ï¼‰</p>
</li>
<li><p>nonceéšæœºæ•°</p>
</li>
<li><p>timestamp</p>
</li>
<li><p>bodyï¼ˆç”¨æˆ·è¯·æ±‚å‚æ•° å¯è¦å¯ä¸è¦ï¼‰</p>
</li>
</ol>
<p>Â  <strong>APIç­¾åè®¤è¯æ˜¯ä¸€ä¸ªå¾ˆçµæ´»çš„è®¾è®¡ï¼Œå…·ä½“è¦æœ‰å“ªäº›å‚æ•°ï¼Œå°½é‡æœåŠ¡ç«¯è°ƒç”¨ï¼Œå‚æ•°åå¦‚ä½•è¦æ ¹æ®åœºæ™¯æ¥ã€‚</strong> Â </p>
<h3 id="2ã€åŠ å¯†ä»£ç "><a href="#2ã€åŠ å¯†ä»£ç " class="headerlink" title="2ã€åŠ å¯†ä»£ç "></a>2ã€åŠ å¯†ä»£ç </h3><p>Â  æˆ‘è¿™é‡Œç›´æ¥ä½¿ç”¨äº†bodyã€å’ŒsecretKeyè¿›è¡ŒåŠ å¯† Â  å…ˆåˆ›å»ºä¸€ä¸ªåŠ å¯†ç­¾åç±»SignUtil.java Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package com.xuan.util;</span><br><span class="line"></span><br><span class="line">import cn.hutool.crypto.digest.DigestUtil;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ç­¾åå·¥å…·ç±»</span><br><span class="line"> *</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @author: ç„</span><br><span class="line"> * @date: 2023/1/15</span><br><span class="line"> */</span><br><span class="line">public class SignUtil &#123;</span><br><span class="line">public static String getSign(String body, String secretKey) &#123;</span><br><span class="line">String content = body + &quot;.&quot; + secretKey;</span><br><span class="line">return DigestUtil.md5Hex(content);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  åœ¨Clientç±»ä¸­æ–°å¢æ„é€ Headerçš„æ–¹æ³• Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">public class XuanApiClient &#123;</span><br><span class="line"></span><br><span class="line">private final String accessKey;</span><br><span class="line">private final String secretKey;</span><br><span class="line"></span><br><span class="line">public XuanApiClient(String accessKey, String secretKey) &#123;</span><br><span class="line">this.accessKey = accessKey;</span><br><span class="line">this.secretKey = secretKey;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">// ...</span><br><span class="line"></span><br><span class="line">public String getNameByPostWithJson(User user) &#123;</span><br><span class="line">String json = JSONUtil.toJsonStr(user);</span><br><span class="line">HttpResponse response = HttpRequest.post(&quot;http://localhost:8123/api/name/user&quot;)</span><br><span class="line">.addHeaders(getHeaders(json))</span><br><span class="line">.body(json)</span><br><span class="line">.execute();</span><br><span class="line">System.out.println(&quot;response = &quot; + response);</span><br><span class="line">System.out.println(&quot;status = &quot; + response.getStatus());</span><br><span class="line">if (response.isOk()) &#123;</span><br><span class="line">return response.body();</span><br><span class="line">&#125;</span><br><span class="line">return &quot;fail&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private Map&lt;String, String&gt; getHeaders(String body) throws UnsupportedEncodingException &#123;</span><br><span class="line">Map&lt;String, String&gt; header = new HashMap&lt;&gt;();</span><br><span class="line">header.put(&quot;accessKey&quot;, accessKey);</span><br><span class="line">header.put(&quot;sign&quot;, SignUtil.getSign(body, secretKey));</span><br><span class="line">// é˜²æ­¢ä¸­æ–‡ä¹±ç </span><br><span class="line">header.put(&quot;body&quot;, URLEncoder.encode(body, StandardCharsets.UTF_8.name()));</span><br><span class="line">header.put(&quot;nonce&quot;, RandomUtil.randomNumbers(5));</span><br><span class="line">header.put(&quot;timestamp&quot;, String.valueOf(System.currentTimeMillis()));</span><br><span class="line">return header;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  è°ƒç”¨APIçš„æ—¶å€™åŠ å¯†ä»£ç å·²ç»å†™å¥½äº†ï¼Œæ˜¾ç„¶æˆ‘ä»¬åœ¨APIä¸­éœ€è¦ç”¨åŒæ ·çš„æ–¹æ³•æ¥éªŒè¯åŠ å¯†ã€‚è¿™é‡Œä»¥æºå¸¦JSON bodyçš„POSTè¯·æ±‚ä¸ºä¾‹ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">package com.xuan.controller;</span><br><span class="line"></span><br><span class="line">import cn.hutool.core.util.NumberUtil;</span><br><span class="line">import cn.hutool.core.util.StrUtil;</span><br><span class="line">import com.xuan.model.User;</span><br><span class="line">import com.xuan.util.SignUtil;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æ¨¡æ‹Ÿæ¥å£</span><br><span class="line"> *</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @author: ç„</span><br><span class="line"> * @date: 2023/1/14</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/name&quot;)</span><br><span class="line">public class NameController &#123;</span><br><span class="line"></span><br><span class="line">@PostMapping(&quot;/user&quot;)</span><br><span class="line">public String getNameByPostWithJson(@RequestBody User user, HttpServletRequest request) throws UnsupportedEncodingException &#123;</span><br><span class="line">String accessKey = request.getHeader(&quot;accessKey&quot;);</span><br><span class="line">// é˜²æ­¢ä¸­æ–‡ä¹±ç </span><br><span class="line">String body = URLDecoder.decode(request.getHeader(&quot;body&quot;), StandardCharsets.UTF_8.name());</span><br><span class="line">String sign = request.getHeader(&quot;sign&quot;);</span><br><span class="line">String nonce = request.getHeader(&quot;nonce&quot;);</span><br><span class="line">String timestamp = request.getHeader(&quot;timestamp&quot;);</span><br><span class="line">boolean hasBlank = StrUtil.hasBlank(accessKey, body, sign, nonce, timestamp);</span><br><span class="line">// åˆ¤æ–­æ˜¯å¦æœ‰ç©º</span><br><span class="line">if (hasBlank) &#123;</span><br><span class="line">return &quot;æ— æƒé™&quot;;</span><br><span class="line">&#125;</span><br><span class="line">// TODO ä½¿ç”¨accessKeyå»æ•°æ®åº“æŸ¥è¯¢secretKey</span><br><span class="line">// å‡è®¾æŸ¥åˆ°çš„secretæ˜¯abc è¿›è¡ŒåŠ å¯†å¾—åˆ°sign</span><br><span class="line">String secretKey = &quot;abc&quot;;</span><br><span class="line">String sign1 = SignUtil.getSign(body, secretKey);</span><br><span class="line">if (!StrUtil.equals(sign, sign1)) &#123;</span><br><span class="line">return &quot;æ— æƒé™&quot;;</span><br><span class="line">&#125;</span><br><span class="line">// TODO åˆ¤æ–­éšæœºæ•°nonce</span><br><span class="line">// æ—¶é—´æˆ³æ˜¯å¦ä¸ºæ•°å­—</span><br><span class="line">if (!NumberUtil.isNumber(timestamp)) &#123;</span><br><span class="line">return &quot;æ— æƒé™&quot;;</span><br><span class="line">&#125;</span><br><span class="line">// äº”åˆ†é’Ÿå†…çš„è¯·æ±‚æœ‰æ•ˆ</span><br><span class="line">if (System.currentTimeMillis() - Long.parseLong(timestamp) &gt; 5 * 60 * 1000) &#123;</span><br><span class="line">return &quot;æ— æƒé™&quot;;</span><br><span class="line">&#125;</span><br><span class="line">return &quot;å‘é€POSTè¯·æ±‚ JSONä¸­ä½ çš„åå­—æ˜¯ï¼š&quot; + user.getName();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  è¿›è¡Œæµ‹è¯•secretKey &#x3D; â€œabcâ€ å¯ä»¥æ­£ç¡®è®¿é—®ï¼Œå½“secreté”™è¯¯æ—¶è¿”å›æ— æƒé™ï½ Â  Â  Â </p>
<h1 id="äº”ã€å¼€å‘ä¸€ä¸ªSDKï¼ˆstarterï¼‰"><a href="#äº”ã€å¼€å‘ä¸€ä¸ªSDKï¼ˆstarterï¼‰" class="headerlink" title="äº”ã€å¼€å‘ä¸€ä¸ªSDKï¼ˆstarterï¼‰"></a>äº”ã€å¼€å‘ä¸€ä¸ªSDKï¼ˆstarterï¼‰</h1><hr>
<p>ç†æƒ³æƒ…å†µï¼šå¼€å‘è€…åªéœ€è¦å…³å¿ƒè°ƒç”¨å“ªäº›æ¥å£ã€ä¼ é€’å“ªäº›å‚æ•°ã€‚å°±è·Ÿè°ƒç”¨è‡ªå·±å†™çš„ä»£ç ä¸€æ ·ç®€å•ã€‚ Â  å¼€å‘starterçš„å¥½å¤„ï¼šå¼€å‘è€…å¼•å…¥ä¹‹åï¼Œå¯ä»¥ç›´æ¥åœ¨application.ymlä¸­å†™é…ç½®ï¼Œè‡ªåŠ¨åˆ›å»ºå®¢æˆ·ç«¯ Â </p>
<h2 id="1ã€æ–°å»ºé¡¹ç›®"><a href="#1ã€æ–°å»ºé¡¹ç›®" class="headerlink" title="1ã€æ–°å»ºé¡¹ç›®"></a>1ã€æ–°å»ºé¡¹ç›®</h2><p>Â  åˆ›å»ºä¸€ä¸ªxuanapi-client-sdkçš„springbooté¡¹ç›® å‹¾é€‰lombokã€Spring Configuration Processorï¼ˆä½œç”¨ï¼šè‡ªåŠ¨ç”Ÿæˆé…ç½®çš„ä»£ç æç¤ºï¼‰ Â  ç„¶åå¤„ç†pom.xml Â  è¿™ä¸ªä¸€å®šéœ€è¦åˆ é™¤å› ä¸ºè¿™ä¸ªæ˜¯mavençš„æ„å»ºé¡¹ç›®æˆå¯è¿è¡ŒjaråŒ…ã€‚ç°åœ¨æ˜¯åˆ¶ä½œstarterä¾èµ–åŒ… Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230116142827466.png"> Â </p>
<h2 id="2ã€ç¼–å†™é…ç½®ç±»"><a href="#2ã€ç¼–å†™é…ç½®ç±»" class="headerlink" title="2ã€ç¼–å†™é…ç½®ç±»"></a>2ã€ç¼–å†™é…ç½®ç±»</h2><p>Â  æˆ‘ä»¬ä¸éœ€è¦spring bootå¯åŠ¨ç±»ï¼Œå°†å…¶åˆ å»ã€‚ Â  ç„¶åå°†ä¹‹å‰ç¼–å†™å¥½çš„clientã€utilã€modelç²˜è´´è¿‡æ¥ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230116153646366.png"> Â  å†æ–°å»ºé…ç½®ç±» Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@ComponentScan</span><br><span class="line">@Configuration</span><br><span class="line">@ConfigurationProperties(prefix = &quot;xuan.api.client&quot;)</span><br><span class="line">public class XuanApiClientConfig &#123;</span><br><span class="line">private String accessKey;</span><br><span class="line">private String secretKey;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">public XuanApiClient xuanApiClient() &#123;</span><br><span class="line">return new XuanApiClient(accessKey, secretKey);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h2 id="3ã€æŒ‡å®šé…ç½®ç±»"><a href="#3ã€æŒ‡å®šé…ç½®ç±»" class="headerlink" title="3ã€æŒ‡å®šé…ç½®ç±»"></a>3ã€æŒ‡å®šé…ç½®ç±»</h2><p>Â  æ–°å»ºresources&#x2F;META-INF&#x2F;spring.factorieså¹¶æŒ‡å®š Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># spring boot starter</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.xuan.XuanApiClientConfig</span><br></pre></td></tr></table></figure>

<p>Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230116153954227.png"> Â </p>
<h2 id="4ã€å‘å¸ƒstarter"><a href="#4ã€å‘å¸ƒstarter" class="headerlink" title="4ã€å‘å¸ƒstarter"></a>4ã€å‘å¸ƒstarter</h2><p>Â  åŒå‡»Maven lifecycleä¸‹çš„installæˆ–è€…å‘½ä»¤è¡Œmvn install Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230116154259164.png"> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[INFO] Installing /Users/xuan/Desktop/project/api-platform/xuanapi-client-sdk/target/xuanapi-client-sdk-0.0.1.jar to /Users/xuan/.m2/repository/com/xuan/xuanapi-client-sdk/0.0.1/xuanapi-client-sdk-0.0.1.jar</span><br><span class="line">[INFO] Installing /Users/xuan/Desktop/project/api-platform/xuanapi-client-sdk/pom.xml to /Users/xuan/.m2/repository/com/xuan/xuanapi-client-sdk/0.0.1/xuanapi-client-sdk-0.0.1.pom</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h2 id="5ã€æµ‹è¯•"><a href="#5ã€æµ‹è¯•" class="headerlink" title="5ã€æµ‹è¯•"></a>5ã€æµ‹è¯•</h2><p>Â  <strong>å¼•å…¥ä¾èµ–</strong> Â  å›åˆ°xuan-Interfaceé¡¹ç›®ï¼ŒæŠŠä¹‹å‰çš„clientã€utilã€modelå…¨éƒ¨åˆ æ‰ã€‚ç„¶ååœ¨pomä¸­å¼•å…¥æˆ‘ä»¬åˆšåˆšåˆ¶ä½œå¥½çš„starter Â  æ³¨æ„ï¼šè¿™é‡Œèƒ½ç›´æ¥å¼•å…¥ï¼Œæ˜¯å› ä¸ºåˆšåˆšæˆ‘ä»¬installçš„stateråœ¨æˆ‘ä»¬çš„æœ¬åœ°ï¼Œå¯ä»¥å‘å¸ƒåˆ°Mavenä»“åº“æˆ–è€…æä¾›jaråŒ…ä¾›å¤§å®¶ä½¿ç”¨ã€‚ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--è‡ªå·±åˆ¶ä½œçš„starter--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.xuan&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;xuanapi-client-sdk&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.0.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>Â  <strong>é…ç½®ä¿¡æ¯</strong> Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230116155915000.png"> Â  æˆ‘ä»¬åœ¨ymlæ–‡ä»¶ä¸­é…ç½®çš„æ—¶å€™æœ‰æç¤ºå°±æ˜¯ä¹‹å‰å¼•å…¥çš„Spring Configuration Processorå‘æŒ¥çš„ä½œç”¨ã€‚æ‰“å¼€ä¾èµ–æºç åˆ†æå¯å¾—æ˜¯è¿™ä¸ªjsonæ–‡ä»¶çš„ä½œç”¨ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230116160142141.png"> Â  åœ¨æµ‹è¯•ç±»ä½¿ç”¨@Resourceæ³¨å…¥XuanApiClientè¿›è¡Œæµ‹è¯• Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230116160643683.png"> Â  ymlä¸­secretä¸æ­£ç¡®ä¹Ÿä¼šè¿”å› â€œæ— æƒé™â€ Â </p>
<h1 id="å…­ã€æ¥å£å‘å¸ƒ-ä¸‹çº¿"><a href="#å…­ã€æ¥å£å‘å¸ƒ-ä¸‹çº¿" class="headerlink" title="å…­ã€æ¥å£å‘å¸ƒ&#x2F;ä¸‹çº¿"></a>å…­ã€æ¥å£å‘å¸ƒ&#x2F;ä¸‹çº¿</h1><hr>
<p>è¿™ä¸ªåŠŸèƒ½é¦–å…ˆæ˜¯ä»…ç®¡ç†å‘˜ä½¿ç”¨çš„ Â  <strong>å‘å¸ƒæ¥å£</strong> Â </p>
<ol>
<li><p>æ ¡éªŒè¯¥æ¥å£æ˜¯å¦å­˜åœ¨</p>
</li>
<li><p>åˆ¤æ–­æ¥å£æ˜¯å¦å¯ä»¥è¢«è°ƒç”¨</p>
</li>
<li><p>ä¿®æ”¹æ•°æ®åº“æ¥å£å­—æ®µä¸º1</p>
</li>
</ol>
<p>Â  <strong>ä¸‹çº¿æ¥å£</strong> Â </p>
<ol>
<li><p>æ ¡éªŒè¯¥æ¥å£æ˜¯å¦å­˜åœ¨</p>
</li>
<li><p>ä¿®æ”¹æ•°æ®åº“æ¥å£å­—æ®µä¸º 0</p>
</li>
</ol>
<p>Â </p>
<h2 id="1ã€åç«¯"><a href="#1ã€åç«¯" class="headerlink" title="1ã€åç«¯"></a>1ã€åç«¯</h2><hr>
<ol>
<li><strong>é€šç”¨è¯·æ±‚ç±»</strong> ä¸Šä¸‹çº¿éƒ½æ˜¯é€šè¿‡idæ¥æ§åˆ¶çš„</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * é€šè¿‡idå‘é€è¯·æ±‚</span><br><span class="line"> *</span><br><span class="line"> * @author xuan</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">public class IdRequest implements Serializable &#123;</span><br><span class="line">    /**</span><br><span class="line">     * id</span><br><span class="line">     */</span><br><span class="line">    private Long id;</span><br><span class="line"></span><br><span class="line">    private static final long serialVersionUID = 1L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<ol start="2">
<li><strong>æšä¸¾ç±»</strong> ä½¿ç”¨æšä¸¾ç±»æ¥è¡¨ç¤ºä¸Šçº¿&#x2F;ä¸‹çº¿çŠ¶æ€</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">package com.xuan.project.model.enums;</span><br><span class="line"></span><br><span class="line">import java.util.Arrays;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æ¥å£çŠ¶æ€æšä¸¾</span><br><span class="line"> *</span><br><span class="line"> * @author xuan</span><br><span class="line"> */</span><br><span class="line">public enum InterfaceInfoStatusEnum &#123;</span><br><span class="line"></span><br><span class="line">    OFFLINE(&quot;ä¸‹çº¿&quot;, 0),</span><br><span class="line">    ONLINE(&quot;ä¸Šçº¿&quot;, 1);</span><br><span class="line"></span><br><span class="line">    private final String text;</span><br><span class="line"></span><br><span class="line">    private final int value;</span><br><span class="line"></span><br><span class="line">    InterfaceInfoStatusEnum(String text, int value) &#123;</span><br><span class="line">        this.text = text;</span><br><span class="line">        this.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * @return è·å–å€¼åˆ—è¡¨</span><br><span class="line">     */</span><br><span class="line">    public static List&lt;Integer&gt; getValues() &#123;</span><br><span class="line">        return Arrays.stream(values()).map(item -&gt; item.value).collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getValue() &#123;</span><br><span class="line">        return value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getText() &#123;</span><br><span class="line">        return text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<ol start="3">
<li><strong>åœ¨controlleré‡Œç¼–å†™ä¸Šä¸‹çº¿ä»£ç </strong> è¿™é‡Œæœ‰ä¸ªTODO åˆ¤æ–­è¯¥æ¥å£æ˜¯å¦å¯ä»¥è°ƒç”¨æ—¶ï¼Œç”±XuanApiClientå›ºå®šæ–¹æ³•åæ”¹ä¸ºæ ¹æ®æµ‹è¯•åœ°å€æ¥è°ƒç”¨</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * APIä¿¡æ¯æ¥å£</span><br><span class="line"> *</span><br><span class="line"> * @author xuan</span><br><span class="line"> */</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/interfaceInfo&quot;)</span><br><span class="line">@Slf4j</span><br><span class="line">public class InterfaceInfoController &#123;</span><br><span class="line"></span><br><span class="line">@Resource</span><br><span class="line">private InterfaceInfoService interfaceInfoService;</span><br><span class="line"></span><br><span class="line">@Resource</span><br><span class="line">private UserService userService;</span><br><span class="line"></span><br><span class="line">@Resource</span><br><span class="line">private XuanApiClient xuanApiClient;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ä¸Šçº¿æ¥å£</span><br><span class="line"> *</span><br><span class="line"> * @param idRequest æºå¸¦id</span><br><span class="line"> * @return æ˜¯å¦ä¸Šçº¿æˆåŠŸ</span><br><span class="line"> */</span><br><span class="line">@PostMapping(&quot;/online&quot;)</span><br><span class="line">@AuthCheck(mustRole = &quot;admin&quot;)</span><br><span class="line">public BaseResponse&lt;Boolean&gt; onlineInterfaceInfo(@RequestBody IdRequest idRequest) throws UnsupportedEncodingException &#123;</span><br><span class="line">if (idRequest == null  idRequest.getId() &lt; 0) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.PARAMS_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">// åˆ¤æ–­æ¥å£æ˜¯å¦å­˜åœ¨</span><br><span class="line">long id = idRequest.getId();</span><br><span class="line">InterfaceInfo oldInterfaceInfo = interfaceInfoService.getById(id);</span><br><span class="line">if (oldInterfaceInfo == null) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.NOT_FOUND_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">// åˆ¤æ–­æ¥å£æ˜¯å¦èƒ½ä½¿ç”¨</span><br><span class="line">// TODO æ ¹æ®æµ‹è¯•åœ°å€æ¥è°ƒç”¨</span><br><span class="line">// è¿™é‡Œæˆ‘å…ˆç”¨å›ºå®šçš„æ–¹æ³•è¿›è¡Œæµ‹è¯•ï¼Œåé¢æ¥æ”¹</span><br><span class="line">com.xuan.model.User user = new com.xuan.model.User();</span><br><span class="line">user.setName(&quot;MARS&quot;);</span><br><span class="line">String name = xuanApiClient.getNameByPostWithJson(user);</span><br><span class="line">if (StrUtil.isBlank(name)) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.SYSTEM_ERROR, &quot;æ¥å£éªŒè¯å¤±è´¥&quot;);</span><br><span class="line">&#125;</span><br><span class="line">// æ›´æ–°æ•°æ®åº“</span><br><span class="line">InterfaceInfo interfaceInfo = new InterfaceInfo();</span><br><span class="line">interfaceInfo.setId(id);</span><br><span class="line">interfaceInfo.setStatus(InterfaceInfoStatusEnum.ONLINE.getValue());</span><br><span class="line">boolean isSuccessful = interfaceInfoService.updateById(interfaceInfo);</span><br><span class="line">return ResultUtils.success(isSuccessful);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ä¸‹çº¿æ¥å£</span><br><span class="line"> *</span><br><span class="line"> * @param idRequest æºå¸¦id</span><br><span class="line"> * @return æ˜¯å¦ä¸‹çº¿æˆåŠŸ</span><br><span class="line"> */</span><br><span class="line">@PostMapping(&quot;/offline&quot;)</span><br><span class="line">@AuthCheck(mustRole = &quot;admin&quot;)</span><br><span class="line">public BaseResponse&lt;Boolean&gt; offlineInterfaceInfo(@RequestBody IdRequest idRequest) &#123;</span><br><span class="line">if (idRequest == null  idRequest.getId() &lt; 0) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.PARAMS_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">// åˆ¤æ–­æ¥å£æ˜¯å¦å­˜åœ¨</span><br><span class="line">long id = idRequest.getId();</span><br><span class="line">InterfaceInfo oldInterfaceInfo = interfaceInfoService.getById(id);</span><br><span class="line">if (oldInterfaceInfo == null) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.NOT_FOUND_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">// æ›´æ–°æ•°æ®åº“</span><br><span class="line">InterfaceInfo interfaceInfo = new InterfaceInfo();</span><br><span class="line">interfaceInfo.setId(id);</span><br><span class="line">interfaceInfo.setStatus(InterfaceInfoStatusEnum.OFFLINE.getValue());</span><br><span class="line">boolean isSuccessful = interfaceInfoService.updateById(interfaceInfo);</span><br><span class="line">return ResultUtils.success(isSuccessful);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<ol start="4">
<li><strong>æƒé™æ§åˆ¶</strong> è¿™é‡Œæ·»åŠ æƒé™æ ¡éªŒï¼Œè¿™é‡Œç”¨åˆ°<a href="/AuthCheck(mustRole"><strong>@AuthCheck(mustRole</strong></a> <strong>= â€œadminâ€)</strong> çš„åˆ‡é¢æ³¨è§£ï¼Œå¯¹åº”çš„å®ç°æ–¹æ³•åœ¨aop&#x2F;AuthInterceptor</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">package com.xuan.project.annotation;</span><br><span class="line"></span><br><span class="line">import java.lang.annotation.ElementType;</span><br><span class="line">import java.lang.annotation.Retention;</span><br><span class="line">import java.lang.annotation.RetentionPolicy;</span><br><span class="line">import java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æƒé™æ ¡éªŒ</span><br><span class="line"> *</span><br><span class="line"> * @author xuan</span><br><span class="line"> */</span><br><span class="line">@Target(ElementType.METHOD)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">public @interface AuthCheck &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * æœ‰ä»»ä½•ä¸€ä¸ªè§’è‰²</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    String[] anyRole() default &quot;&quot;;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * å¿…é¡»æœ‰æŸä¸ªè§’è‰²</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    String mustRole() default &quot;&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>aop&#x2F;AuthInterceptor.java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">package com.xuan.project.aop;</span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.core.toolkit.CollectionUtils;</span><br><span class="line">import com.xuan.project.common.ErrorCode;</span><br><span class="line">import com.xuan.project.exception.BusinessException;</span><br><span class="line">import com.xuan.project.model.entity.User;</span><br><span class="line">import com.xuan.project.service.UserService;</span><br><span class="line">import com.xuan.project.annotation.AuthCheck;</span><br><span class="line">import org.apache.commons.lang3.StringUtils;</span><br><span class="line">import org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line">import org.aspectj.lang.annotation.Around;</span><br><span class="line">import org.aspectj.lang.annotation.Aspect;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import org.springframework.web.context.request.RequestAttributes;</span><br><span class="line">import org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line">import org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import java.util.Arrays;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æƒé™æ ¡éªŒ AOP</span><br><span class="line"> *</span><br><span class="line"> * @author xuan</span><br><span class="line"> */</span><br><span class="line">@Aspect</span><br><span class="line">@Component</span><br><span class="line">public class AuthInterceptor &#123;</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private UserService userService;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * æ‰§è¡Œæ‹¦æˆª</span><br><span class="line">     *</span><br><span class="line">     * @param joinPoint</span><br><span class="line">     * @param authCheck</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Around(&quot;@annotation(authCheck)&quot;)</span><br><span class="line">    public Object doInterceptor(ProceedingJoinPoint joinPoint, AuthCheck authCheck) throws Throwable &#123;</span><br><span class="line">        List&lt;String&gt; anyRole = Arrays.stream(authCheck.anyRole()).filter(StringUtils::isNotBlank).collect(Collectors.toList());</span><br><span class="line">        String mustRole = authCheck.mustRole();</span><br><span class="line">        RequestAttributes requestAttributes = RequestContextHolder.currentRequestAttributes();</span><br><span class="line">        HttpServletRequest request = ((ServletRequestAttributes) requestAttributes).getRequest();</span><br><span class="line">        // å½“å‰ç™»å½•ç”¨æˆ·</span><br><span class="line">        User user = userService.getLoginUser(request);</span><br><span class="line">        // æ‹¥æœ‰ä»»æ„æƒé™å³é€šè¿‡</span><br><span class="line">        if (CollectionUtils.isNotEmpty(anyRole)) &#123;</span><br><span class="line">            String userRole = user.getUserRole();</span><br><span class="line">            if (!anyRole.contains(userRole)) &#123;</span><br><span class="line">                throw new BusinessException(ErrorCode.NO_AUTH_ERROR);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        // å¿…é¡»æœ‰æ‰€æœ‰æƒé™æ‰é€šè¿‡</span><br><span class="line">        if (StringUtils.isNotBlank(mustRole)) &#123;</span><br><span class="line">            String userRole = user.getUserRole();</span><br><span class="line">            if (!mustRole.equals(userRole)) &#123;</span><br><span class="line">                throw new BusinessException(ErrorCode.NO_AUTH_ERROR);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        // é€šè¿‡æƒé™æ ¡éªŒï¼Œæ”¾è¡Œ</span><br><span class="line">        return joinPoint.proceed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>userService.getLoginUser(request)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * è·å–å½“å‰ç™»å½•ç”¨æˆ·</span><br><span class="line"> *</span><br><span class="line"> * @param request</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@Override</span><br><span class="line">public User getLoginUser(HttpServletRequest request) &#123;</span><br><span class="line">// å…ˆåˆ¤æ–­æ˜¯å¦å·²ç™»å½•</span><br><span class="line">Object userObj = request.getSession().getAttribute(USER_LOGIN_STATE);</span><br><span class="line">User currentUser = (User) userObj;</span><br><span class="line">if (currentUser == null  currentUser.getId() == null) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.NOT_LOGIN_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">// ä»æ•°æ®åº“æŸ¥è¯¢ï¼ˆè¿½æ±‚æ€§èƒ½çš„è¯å¯ä»¥æ³¨é‡Šï¼Œç›´æ¥èµ°ç¼“å­˜ï¼‰</span><br><span class="line">long userId = currentUser.getId();</span><br><span class="line">currentUser = this.getById(userId);</span><br><span class="line">if (currentUser == null) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.NOT_LOGIN_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">return currentUser;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  Â </p>
<h2 id="2ã€å‰ç«¯"><a href="#2ã€å‰ç«¯" class="headerlink" title="2ã€å‰ç«¯"></a>2ã€å‰ç«¯</h2><hr>
<h3 id="1ã€æ·»åŠ å‘å¸ƒæŒ‰é’®å’Œä¸‹çº¿æŒ‰é’®"><a href="#1ã€æ·»åŠ å‘å¸ƒæŒ‰é’®å’Œä¸‹çº¿æŒ‰é’®" class="headerlink" title="1ã€æ·»åŠ å‘å¸ƒæŒ‰é’®å’Œä¸‹çº¿æŒ‰é’®"></a>1ã€æ·»åŠ å‘å¸ƒæŒ‰é’®å’Œä¸‹çº¿æŒ‰é’®</h3><p>Â  æŸ¥çœ‹äº†Ant DesignÂ <a target="_blank" rel="noopener" href="https://ant.design/components/button-cn">Buttonçš„å®˜æ–¹æ–‡æ¡£</a> Â  å‘å¸ƒ&#x2F;ä¸‹çº¿åšæˆä¸€ä¸ªæŒ‰é’®ã€‚é€šè¿‡statusæ¥åŠ¨æ€åˆ¤æ–­ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">      title: &#x27;æ“ä½œ&#x27;,</span><br><span class="line">      dataIndex: &#x27;option&#x27;,</span><br><span class="line">      valueType: &#x27;option&#x27;,</span><br><span class="line">      render: (_, record) =&gt; [</span><br><span class="line">        &lt;Button</span><br><span class="line">          key=&quot;config&quot;</span><br><span class="line">          type=&#123;&quot;link&quot;&#125;</span><br><span class="line">          onClick=&#123;() =&gt; &#123;</span><br><span class="line">            handleUpdateModalOpen(true);</span><br><span class="line">            setCurrentRow(record);</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          ç¼–è¾‘</span><br><span class="line">        &lt;/Button&gt;,</span><br><span class="line">        record.status === 0 ? (</span><br><span class="line">          &lt;Button</span><br><span class="line">            key=&quot;online&quot;</span><br><span class="line">            type=&#123;&#x27;link&#x27;&#125;</span><br><span class="line">            onClick=&#123;() =&gt; &#123;</span><br><span class="line">              handleOnlineInterface(record);</span><br><span class="line">            &#125;&#125;</span><br><span class="line">          &gt;</span><br><span class="line">            å‘å¸ƒ</span><br><span class="line">          &lt;/Button&gt;</span><br><span class="line">        ) : (</span><br><span class="line">          &lt;Button</span><br><span class="line">            key=&quot;offline&quot;</span><br><span class="line">            type=&#123;&#x27;text&#x27;&#125;</span><br><span class="line">            // danger=&#123;true&#125;</span><br><span class="line">            onClick=&#123;() =&gt; &#123;</span><br><span class="line">              handleOfflineInterface(record);</span><br><span class="line">            &#125;&#125;</span><br><span class="line">          &gt;</span><br><span class="line">            ä¸‹çº¿</span><br><span class="line">          &lt;/Button&gt;</span><br><span class="line">        ),</span><br><span class="line">        &lt;Button</span><br><span class="line">          key=&quot;delete&quot;</span><br><span class="line">          type=&#123;&#x27;text&#x27;&#125;</span><br><span class="line">          danger=&#123;true&#125;</span><br><span class="line">          onClick=&#123;() =&gt; &#123;</span><br><span class="line">            handleRemoveInterfaceInfo(record);</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          åˆ é™¤</span><br><span class="line">        &lt;/Button&gt;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>Â  æ•ˆæœå¦‚ä¸‹ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230117142012585.png"> Â </p>
<h3 id="2ã€ç¼–å†™å‘å¸ƒ-ä¸‹çº¿çš„æ–¹æ³•"><a href="#2ã€ç¼–å†™å‘å¸ƒ-ä¸‹çº¿çš„æ–¹æ³•" class="headerlink" title="2ã€ç¼–å†™å‘å¸ƒ&#x2F;ä¸‹çº¿çš„æ–¹æ³•"></a>2ã€ç¼–å†™å‘å¸ƒ&#x2F;ä¸‹çº¿çš„æ–¹æ³•</h3><p>Â  å› ä¸ºåç«¯æ–°å¢äº†ä»£ç ï¼Œæ‰€ä»¥è¿˜æ˜¯ä½¿ç”¨openapiè‡ªåŠ¨ç”Ÿæˆå‰ç«¯æ–¹æ³• Â  è·Ÿä¹‹å‰æ“ä½œä¸€æ ·ï¼Œå»<a target="_blank" rel="noopener" href="http://localhost:7529/api/v3/api-docs%E5%A4%8D%E5%88%B6json%E5%88%B0config/oneapi.json">http://localhost:7529/api/v3/api-docså¤åˆ¶jsonåˆ°config/oneapi.json</a> ç„¶åè¿è¡Œopenapi Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230117121821846.png"> Â  æ–°å¢æ–¹æ³• Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">   * @en-US Online Interface</span><br><span class="line">   * @zh-CN å‘å¸ƒæ¥å£</span><br><span class="line">   *</span><br><span class="line">   * @param fields</span><br><span class="line">   */</span><br><span class="line">  const handleOnlineInterface = async (fields: API.IdRequest) =&gt; &#123;</span><br><span class="line">    const hide = message.loading(&#x27;æ­£åœ¨å‘å¸ƒ&#x27;);</span><br><span class="line">    try &#123;</span><br><span class="line">      let res = await onlineInterfaceInfoUsingPOST(&#123; ...fields &#125;);</span><br><span class="line">      if (res.data) &#123;</span><br><span class="line">        hide();</span><br><span class="line">        message.success(&#x27;å‘å¸ƒæˆåŠŸ!&#x27;);</span><br><span class="line">        // åˆ·æ–°é¡µé¢</span><br><span class="line">        actionRef.current?.reload();</span><br><span class="line">        return true;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; catch (error: any) &#123;</span><br><span class="line">      hide();</span><br><span class="line">      message.error(&#x27;å‘å¸ƒå¤±è´¥!&#x27; + error.message);</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @en-US Offline Interface</span><br><span class="line">   * @zh-CN ä¸‹çº¿æ¥å£</span><br><span class="line">   *</span><br><span class="line">   * @param fields</span><br><span class="line">   */</span><br><span class="line">  const handleOfflineInterface = async (fields: API.IdRequest) =&gt; &#123;</span><br><span class="line">    const hide = message.loading(&#x27;æ­£åœ¨ä¸‹çº¿&#x27;);</span><br><span class="line">    try &#123;</span><br><span class="line">      let res = await offlineInterfaceInfoUsingPOST(&#123; ...fields &#125;);</span><br><span class="line">      if (res.data) &#123;</span><br><span class="line">        hide();</span><br><span class="line">        message.success(&#x27;ä¸‹çº¿æˆåŠŸ!&#x27;);</span><br><span class="line">        // åˆ·æ–°é¡µé¢</span><br><span class="line">        actionRef.current?.reload();</span><br><span class="line">        return true;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; catch (error: any) &#123;</span><br><span class="line">      hide();</span><br><span class="line">      message.error(&#x27;ä¸‹çº¿å¤±è´¥!&#x27; + error.message);</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<p>Â  ç½‘é¡µè¿›è¡Œæµ‹è¯•æ²¡æœ‰é—®é¢˜~ Â </p>
<h1 id="ä¸ƒã€ç”¨æˆ·ä¸»é¡µ"><a href="#ä¸ƒã€ç”¨æˆ·ä¸»é¡µ" class="headerlink" title="ä¸ƒã€ç”¨æˆ·ä¸»é¡µ"></a>ä¸ƒã€ç”¨æˆ·ä¸»é¡µ</h1><hr>
<p>å‰ç«¯æµè§ˆæ¥å£ï¼ŒæŸ¥çœ‹æ¥å£æ–‡æ¡£ï¼Œç”³è¯·ç­¾åï¼ˆæ³¨å†Œï¼‰ Â </p>
<h3 id="1ã€æµè§ˆæ¥å£"><a href="#1ã€æµè§ˆæ¥å£" class="headerlink" title="1ã€æµè§ˆæ¥å£"></a>1ã€æµè§ˆæ¥å£</h3><hr>
<p>åœ¨src&#x2F;pagesç›®å½•ä¸‹æ–°å»ºIndexç›®å½•å¹¶æŠŠWelcome.tsxæ‹–å…¥å…¶ä¸­æ”¹åä¸ºindex.tsx Â  <strong>é…ç½®è·¯ç”±</strong> Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230118113613886.png"> Â  æµ‹è¯•ä¸€ä¸‹ ä¸»é¡µèƒ½å¤Ÿæ­£å¸¸è®¿é—®ï¼Œæ¥ä¸‹æ¥å†æ¥ç¼–å†™é¡µé¢ Â  <strong>ç¼–å†™é¡µé¢</strong> Â  è¿™é‡Œå‚è€ƒäº†Â <a target="_blank" rel="noopener" href="https://ant.design/components/list-cn">Ant Design Listç»„ä»¶</a> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">import &#123; PageContainer &#125; from &#x27;@ant-design/pro-components&#x27;;</span><br><span class="line">import &#123; List, message &#125; from &#x27;antd&#x27;;</span><br><span class="line">import React, &#123; useEffect, useState &#125; from &#x27;react&#x27;;</span><br><span class="line">import &#123; listInterfaceInfoByPageUsingGET &#125; from &#x27;@/services/api-platform-backend/interfaceInfoController&#x27;;</span><br><span class="line"></span><br><span class="line">const Index: React.FC = () =&gt; &#123;</span><br><span class="line">  const [loading, setLoading] = useState(false);</span><br><span class="line">  const [list, setList] = useState&lt;API.InterfaceInfo[]&gt;([]);</span><br><span class="line">  const [total, setTotal] = useState&lt;number&gt;(0);</span><br><span class="line"></span><br><span class="line">  const loadData = async (current = 1, pageSize = 10) =&gt; &#123;</span><br><span class="line">    setLoading(true);</span><br><span class="line">    try &#123;</span><br><span class="line">      const res = await listInterfaceInfoByPageUsingGET(&#123;</span><br><span class="line">        current,</span><br><span class="line">        pageSize,</span><br><span class="line">      &#125;);</span><br><span class="line">      setList(res?.data?.records ?? []);</span><br><span class="line">      setTotal(res?.data?.total ?? 0);</span><br><span class="line">      setLoading(false);</span><br><span class="line">    &#125; catch (error: any) &#123;</span><br><span class="line">      setLoading(false);</span><br><span class="line">      message.error(&#x27;è¯·æ±‚å¤±è´¥,&#x27; + error.message);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    loadData();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;PageContainer title=&#123;&#x27;ä¸»é¡µ&#x27;&#125;&gt;</span><br><span class="line">      &lt;List</span><br><span class="line">        className=&quot;interfaceInfo-list&quot;</span><br><span class="line">        loading=&#123;loading&#125;</span><br><span class="line">        itemLayout=&quot;horizontal&quot;</span><br><span class="line">        dataSource=&#123;list&#125;</span><br><span class="line">        pagination=&#123;&#123;</span><br><span class="line">          showSizeChanger: true,</span><br><span class="line">          total: total,</span><br><span class="line">          showTotal(total, range) &#123;</span><br><span class="line">            return `$&#123;range[0]&#125;-$&#123;range[1]&#125; / $&#123;total&#125;`;</span><br><span class="line">          &#125;,</span><br><span class="line">          onChange(page, pageSize) &#123;</span><br><span class="line">            loadData(page, pageSize);</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;&#125;</span><br><span class="line">        renderItem=&#123;(item) =&gt; (</span><br><span class="line">          &lt;List.Item actions=&#123;[&lt;a key=&quot;list-more&quot;&gt;æŸ¥çœ‹è¯¦æƒ…&lt;/a&gt;]&#125;&gt;</span><br><span class="line">            &lt;List.Item.Meta</span><br><span class="line">              title=&#123;&lt;a href=&quot;https://ant.design&quot;&gt;&#123;item.name&#125;&lt;/a&gt;&#125;</span><br><span class="line">              description=&#123;item.description&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;div&gt;&#123;item.method&#125;&lt;/div&gt;</span><br><span class="line">          &lt;/List.Item&gt;</span><br><span class="line">        )&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/PageContainer&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default Index;</span><br></pre></td></tr></table></figure>

<p>Â  æ•ˆæœå¦‚ä¸‹ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230118140557053.png"> Â </p>
<h3 id="2ã€æŸ¥çœ‹æ¥å£æ–‡æ¡£"><a href="#2ã€æŸ¥çœ‹æ¥å£æ–‡æ¡£" class="headerlink" title="2ã€æŸ¥çœ‹æ¥å£æ–‡æ¡£"></a>2ã€æŸ¥çœ‹æ¥å£æ–‡æ¡£</h3><hr>
<ol>
<li><p><strong>æ–°å»ºæ–‡ä»¶</strong> åœ¨pagesä¸‹æ–°å»º InterfaceInfo&#x2F;index.tsx</p>
</li>
<li><p><strong>é…ç½®åŠ¨æ€è·¯ç”±</strong> è¿™é‡Œéœ€è¦æŸ¥çœ‹Â <a target="_blank" rel="noopener" href="https://umijs.org/docs/guides/routes">umiæ–‡æ¡£</a></p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  // åŠ¨æ€è·¯ç”±</span><br><span class="line">  path: &#x27;/interface_info/:id&#x27;,</span><br><span class="line">  name: &#x27;interface info&#x27;,</span><br><span class="line">  component: &#x27;./InterfaceInfo&#x27;,</span><br><span class="line">  // ä¸åœ¨èœå•é¡µæ˜¾ç¤º</span><br><span class="line">  hideInMenu: true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230118152720709.png"></p>
<ol start="3">
<li><strong>ä¿®æ”¹è·³è½¬</strong> ç‚¹å‡»é¡µé¢å³å¯æŸ¥çœ‹è¯¦æƒ… <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230118152832702.png"> ä¸»é¡µä»£ç ç‰‡æ®µä¿®æ”¹</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">return (</span><br><span class="line">    &lt;PageContainer title=&#123;&#x27;æ¥å£å¼€æ”¾å¹³å°&#x27;&#125;&gt;</span><br><span class="line">      &lt;List</span><br><span class="line">        className=&quot;interfaceInfo-list&quot;</span><br><span class="line">        loading=&#123;loading&#125;</span><br><span class="line">        itemLayout=&quot;horizontal&quot;</span><br><span class="line">        dataSource=&#123;list&#125;</span><br><span class="line">        pagination=&#123;&#123;</span><br><span class="line">          showSizeChanger: true,</span><br><span class="line">          total: total,</span><br><span class="line">          showTotal(total, range) &#123;</span><br><span class="line">            return `$&#123;range[0]&#125;-$&#123;range[1]&#125; / $&#123;total&#125;`;</span><br><span class="line">          &#125;,</span><br><span class="line">          onChange(page, pageSize) &#123;</span><br><span class="line">            loadData(page, pageSize);</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;&#125;</span><br><span class="line">        // ä¿®æ”¹çš„åœ°æ–¹</span><br><span class="line">        renderItem=&#123;(item) =&gt; &#123;</span><br><span class="line">          const infoLink = `/interface_info/$&#123;item.id&#125;`;</span><br><span class="line">          return (</span><br><span class="line">            &lt;List.Item</span><br><span class="line">              actions=&#123;[</span><br><span class="line">                &lt;a key=&quot;list-more&quot; href=&#123;infoLink&#125;&gt;</span><br><span class="line">                  æŸ¥çœ‹è¯¦æƒ…</span><br><span class="line">                &lt;/a&gt;,</span><br><span class="line">              ]&#125;</span><br><span class="line">            &gt;</span><br><span class="line">              &lt;List.Item.Meta</span><br><span class="line">                title=&#123;&lt;a href=&#123;infoLink&#125;&gt;&#123;item.name&#125;&lt;/a&gt;&#125;</span><br><span class="line">                description=&#123;item.description&#125;</span><br><span class="line">              /&gt;</span><br><span class="line">              &lt;div&gt;&#123;item.method&#125;&lt;/div&gt;</span><br><span class="line">            &lt;/List.Item&gt;</span><br><span class="line">          );</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/PageContainer&gt;</span><br><span class="line">  );</span><br></pre></td></tr></table></figure>

<p>Â </p>
<ol start="4">
<li><strong>ç¼–å†™InterfaceInfo&#x2F;index.tsx</strong> è¿™é‡Œéœ€è¦æŸ¥çœ‹Ant Designä¸­çš„Card å’Œ Descriptions ç»„ä»¶ å·²ç»umiä¸­åŠ¨æ€è·¯ç”±å¦‚ä½•è·å–è·¯å¾„ä¸­çš„id <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230118153556403.png"> å¦‚å®˜æ–¹æ–‡æ¡£æ‰€ç¤ºï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨useParams()</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">import &#123; PageContainer &#125; from &#x27;@ant-design/pro-components&#x27;;</span><br><span class="line">import &#123; Badge, Card, Descriptions, message &#125; from &#x27;antd&#x27;;</span><br><span class="line">import React, &#123; useEffect, useState &#125; from &#x27;react&#x27;;</span><br><span class="line">import &#123; getInterfaceInfoByIdUsingGET &#125; from &#x27;@/services/api-platform-backend/interfaceInfoController&#x27;;</span><br><span class="line">import &#123; useParams &#125; from &#x27;react-router&#x27;;</span><br><span class="line">import moment from &quot;moment&quot;;</span><br><span class="line"></span><br><span class="line">const InterfaceInfo: React.FC = () =&gt; &#123;</span><br><span class="line">  const [loading, setLoading] = useState(false);</span><br><span class="line">  const [data, setData] = useState&lt;API.InterfaceInfo&gt;();</span><br><span class="line"></span><br><span class="line">  const params = useParams();</span><br><span class="line"></span><br><span class="line">  const loadData = async () =&gt; &#123;</span><br><span class="line">    if (!params.id) &#123;</span><br><span class="line">      message.error(&#x27;æ— æ•°æ®ï¼Œè¯·é‡è¯•&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    setLoading(true);</span><br><span class="line">    try &#123;</span><br><span class="line">      const res = await getInterfaceInfoByIdUsingGET(&#123;</span><br><span class="line">        id: Number(params.id),</span><br><span class="line">      &#125;);</span><br><span class="line">      setData(res?.data);</span><br><span class="line">      setLoading(false);</span><br><span class="line">    &#125; catch (error: any) &#123;</span><br><span class="line">      setLoading(false);</span><br><span class="line">      message.error(&#x27;è¯·æ±‚å¤±è´¥,&#x27; + error.message);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    loadData();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;PageContainer title=&#123;&#x27;æ¥å£è¯¦æƒ…&#x27;&#125;&gt;</span><br><span class="line">      &lt;Card loading=&#123;loading&#125;&gt;</span><br><span class="line">        &#123;data ? (</span><br><span class="line">          &lt;Descriptions title=&#123;data.name&#125; column=&#123;2&#125; layout=&quot;vertical&quot; bordered=&#123;true&#125;&gt;</span><br><span class="line">            &lt;Descriptions.Item label=&quot;æè¿°&quot;&gt;&#123;data.description&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">            &lt;Descriptions.Item label=&quot;æ¥å£çŠ¶æ€&quot;&gt;</span><br><span class="line">              &#123;data.status === 0 ? (</span><br><span class="line">                &lt;Badge text=&#123;&#x27;å…³é—­&#x27;&#125; status=&#123;&#x27;default&#x27;&#125; /&gt;</span><br><span class="line">              ) : (</span><br><span class="line">                &lt;Badge text=&#123;&#x27;å¯ç”¨&#x27;&#125; status=&#123;&#x27;processing&#x27;&#125; /&gt;</span><br><span class="line">              )&#125;</span><br><span class="line">            &lt;/Descriptions.Item&gt;</span><br><span class="line">            &lt;Descriptions.Item label=&quot;è¯·æ±‚åœ°å€&quot;&gt;&#123;data.url&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">            &lt;Descriptions.Item label=&quot;è¯·æ±‚æ–¹æ³•&quot;&gt;&#123;data.method&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">            &lt;Descriptions.Item label=&quot;è¯·æ±‚å¤´&quot;&gt;&#123;data.requestHeader&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">            &lt;Descriptions.Item label=&quot;å“åº”å¤´&quot;&gt;&#123;data.responseHeader&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">            &lt;Descriptions.Item label=&quot;åˆ›å»ºæ—¶é—´&quot;&gt;&#123;moment(data.createTime).format(&#x27;yyyy-MM-DD HH:mm:ss&#x27;)&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">            &lt;Descriptions.Item label=&quot;æ›´æ–°æ—¶é—´&quot;&gt;&#123;moment(data.updateTime).format(&#x27;yyyy-MM-DD HH:mm:ss&#x27;)&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">          &lt;/Descriptions&gt;</span><br><span class="line">        ) : (</span><br><span class="line">          &lt;&gt;æ¥å£ä¸å­˜åœ¨&lt;/&gt;</span><br><span class="line">        )&#125;</span><br><span class="line">      &lt;/Card&gt;</span><br><span class="line">    &lt;/PageContainer&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default InterfaceInfo;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<ol start="5">
<li><strong>æ•ˆæœå¦‚ä¸‹</strong> ç‚¹å‡»åè·³è½¬è¯¦æƒ… <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230118153729873.png"></li>
</ol>
<p>Â </p>
<h3 id="3ã€ç”³è¯·ç­¾å"><a href="#3ã€ç”³è¯·ç­¾å" class="headerlink" title="3ã€ç”³è¯·ç­¾å"></a>3ã€ç”³è¯·ç­¾å</h3><hr>
<p><strong>æ³¨å†Œç”¨æˆ·çš„æ—¶å€™å°±ç»™ä»–åˆ†é…ä¸€ä¸ªç­¾å</strong> Â  å…ˆåœ¨Userç±»å’ŒUserMapper.xmlä¸­åŠ ä¸€ä¸‹accessKeyã€secretKeyçš„å­—æ®µ Â  æ›´æ–°æ³¨å†Œæ–¹æ³• Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public long userRegister(String userAccount, String userPassword, String checkPassword) &#123;</span><br><span class="line">// 1. æ ¡éªŒ</span><br><span class="line">if (StringUtils.isAnyBlank(userAccount, userPassword, checkPassword)) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.PARAMS_ERROR, &quot;å‚æ•°ä¸ºç©º&quot;);</span><br><span class="line">&#125;</span><br><span class="line">if (userAccount.length() &lt; 4) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.PARAMS_ERROR, &quot;ç”¨æˆ·è´¦å·è¿‡çŸ­&quot;);</span><br><span class="line">&#125;</span><br><span class="line">if (userPassword.length() &lt; 8  checkPassword.length() &lt; 8) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.PARAMS_ERROR, &quot;ç”¨æˆ·å¯†ç è¿‡çŸ­&quot;);</span><br><span class="line">&#125;</span><br><span class="line">// å¯†ç å’Œæ ¡éªŒå¯†ç ç›¸åŒ</span><br><span class="line">if (!userPassword.equals(checkPassword)) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.PARAMS_ERROR, &quot;ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´&quot;);</span><br><span class="line">&#125;</span><br><span class="line">synchronized (userAccount.intern()) &#123;</span><br><span class="line">// è´¦æˆ·ä¸èƒ½é‡å¤</span><br><span class="line">LambdaQueryWrapper&lt;User&gt; lambdaQueryWrapper = new LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">lambdaQueryWrapper.eq(User::getUserAccount, userAccount);</span><br><span class="line">long count = userMapper.selectCount(lambdaQueryWrapper);</span><br><span class="line">if (count &gt; 0) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.PARAMS_ERROR, &quot;è´¦å·é‡å¤&quot;);</span><br><span class="line">&#125;</span><br><span class="line">// 2. åŠ å¯†</span><br><span class="line">String encryptPassword = DigestUtils.md5DigestAsHex((SALT + userPassword).getBytes());</span><br><span class="line">// 3. åˆ†é…accessKeyã€secretKey</span><br><span class="line">String accessKey = &quot;cli_&quot; + DigestUtil.md5Hex(SALT + userAccount + RandomUtil.randomNumbers(4));</span><br><span class="line">String secretKey = DigestUtil.md5Hex(SALT + userAccount + RandomUtil.randomNumbers(8));</span><br><span class="line">// 4. æ’å…¥æ•°æ®</span><br><span class="line">User user = new User();</span><br><span class="line">user.setUserAccount(userAccount);</span><br><span class="line">user.setUserPassword(encryptPassword);</span><br><span class="line">user.setAccessKey(accessKey);</span><br><span class="line">user.setSecretKey(secretKey);</span><br><span class="line">boolean saveResult = this.save(user);</span><br><span class="line">if (!saveResult) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.SYSTEM_ERROR, &quot;æ³¨å†Œå¤±è´¥ï¼Œæ•°æ®åº“é”™è¯¯&quot;);</span><br><span class="line">&#125;</span><br><span class="line">return user.getId();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  å‰å¾€<a target="_blank" rel="noopener" href="http://localhost:7529/api/doc.html%E6%B3%A8%E5%86%8C%E3%80%82">http://localhost:7529/api/doc.htmlæ³¨å†Œã€‚</a> åˆ†é…æˆåŠŸ~ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230118174821662.png"> Â  <strong>æ›´æ¢ç­¾å</strong> Â  æ‰©å±•ï¼šç”¨æˆ·å¯ä»¥ç”³è¯·æ›´æ¢ç­¾å Â </p>
<h1 id="å…«ã€åœ¨çº¿è°ƒç”¨"><a href="#å…«ã€åœ¨çº¿è°ƒç”¨" class="headerlink" title="å…«ã€åœ¨çº¿è°ƒç”¨"></a>å…«ã€åœ¨çº¿è°ƒç”¨</h1><hr>
<p>å‘ç°å°‘äº†ä¸€ä¸ªã€Œè¯·æ±‚å‚æ•°ã€å­—æ®µâ€¦ç°åœ¨ç»™è¡¥ä¸Š Â  æ•°æ®åº“ã€åç«¯ã€å‰ç«¯éƒ½éœ€è¦è¡¥ä¸Šã€‚ ä¸åšè¿‡å¤šé˜è¿° Â  è¿™é‡Œè®¾è®¡çš„å…¶å®ä¸å¤ªå®Œç¾ï¼Œåªæ˜¯è·‘é€šäº†ã€‚åç»­åšä¼˜åŒ– Â </p>
<h2 id="1ã€å‰ç«¯ç®€å•æ ·å¼"><a href="#1ã€å‰ç«¯ç®€å•æ ·å¼" class="headerlink" title="1ã€å‰ç«¯ç®€å•æ ·å¼"></a>1ã€å‰ç«¯ç®€å•æ ·å¼</h2><hr>
<p>è¿™é‡Œæˆ‘æ‹¿äº†Ant Designå®˜ç½‘ä¾‹å­æ”¹äº†ä¸€ä¸‹ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;Card title=&#123;&#x27;åœ¨çº¿è°ƒç”¨&#x27;&#125;&gt;</span><br><span class="line">  &lt;Form</span><br><span class="line">    name=&quot;basic&quot;</span><br><span class="line">    layout=&#123;&#x27;vertical&#x27;&#125;</span><br><span class="line">    onFinish=&#123;onFinish&#125;</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;Form.Item</span><br><span class="line">      label=&quot;è¯·æ±‚å‚æ•°&quot;</span><br><span class="line">      name=&quot;requestParams&quot;</span><br><span class="line">      &gt;</span><br><span class="line">      &lt;Input.TextArea /&gt;</span><br><span class="line">    &lt;/Form.Item&gt;</span><br><span class="line">    &lt;Form.Item &gt;</span><br><span class="line">      &lt;Button type=&quot;primary&quot; htmlType=&quot;submit&quot;&gt;</span><br><span class="line">        è°ƒç”¨</span><br><span class="line">      &lt;/Button&gt;</span><br><span class="line">    &lt;/Form.Item&gt;</span><br><span class="line">  &lt;/Form&gt;</span><br><span class="line">&lt;/Card&gt;</span><br></pre></td></tr></table></figure>

<p>Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230119102254234.png"> Â </p>
<h2 id="2ã€ä¿®æ”¹åç«¯"><a href="#2ã€ä¿®æ”¹åç«¯" class="headerlink" title="2ã€ä¿®æ”¹åç«¯"></a>2ã€ä¿®æ”¹åç«¯</h2><hr>
<p>è¿™é‡Œæˆ‘ä»¬å…¶å®æœ‰ä¸¤ç§æ–¹æ¡ˆ Â </p>
<ul>
<li><p>èµ°åç«¯è°ƒç”¨</p>
</li>
<li><p>ç›´æ¥è¯·æ±‚æ¨¡æ‹Ÿæ¥å£</p>
</li>
</ul>
<p>Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230119102921966.png"> Â  è¿™é‡Œç”¨ç¬¬ä¸€ç§æµæ–¹æ¡ˆï¼Œæ›´å®‰å…¨æ›´è§„èŒƒã€‚æ¨¡æ‹Ÿæ¥å£çš„åœ°å€å°±ä¸ç”¨æš´éœ²å‡ºæ¥ Â  å¤§æ¦‚æµç¨‹å¦‚ä¸‹ Â </p>
<ol>
<li><p>å‰ç«¯å°†ç”¨æˆ·è¾“å…¥çš„è¯·æ±‚å‚æ•°å’Œè¦æµ‹è¯•çš„æ¥å£ idå‘ç»™å¹³å°åç«¯</p>
</li>
<li><p>è°ƒç”¨å‰æ ¡éªŒ</p>
</li>
<li><p>å¹³å°åç«¯å»è°ƒç”¨æ¨¡æ‹Ÿæ¥å£</p>
</li>
</ol>
<p>Â  <strong>æ–°å¢DTOç±»</strong> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">package com.xuan.project.model.dto.interfaceinfo;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è°ƒç”¨æ¥å£å‚æ•°</span><br><span class="line"> *</span><br><span class="line"> * @author xuan</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">public class InvokeInterfaceRequest implements Serializable &#123;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ä¸»é”®</span><br><span class="line"> */</span><br><span class="line">private Long id;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è¯·æ±‚å‚æ•°</span><br><span class="line"> */</span><br><span class="line">private String requestParams;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  controllerç±»æ–°å¢æ–¹æ³• Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * åœ¨çº¿è°ƒç”¨æ¥å£</span><br><span class="line"> *</span><br><span class="line"> * @param invokeInterfaceRequest æºå¸¦idã€è¯·æ±‚å‚æ•°</span><br><span class="line"> * @return data</span><br><span class="line"> */</span><br><span class="line">@PostMapping(&quot;/invoke&quot;)</span><br><span class="line">public BaseResponse&lt;Object&gt; invokeInterface(@RequestBody InvokeInterfaceRequest invokeInterfaceRequest, HttpServletRequest request) throws UnsupportedEncodingException &#123;</span><br><span class="line">if (invokeInterfaceRequest == null  invokeInterfaceRequest.getId() &lt; 0) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.PARAMS_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">// åˆ¤æ–­æ¥å£æ˜¯å¦å­˜åœ¨</span><br><span class="line">long id = invokeInterfaceRequest.getId();</span><br><span class="line">InterfaceInfo interfaceInfo = interfaceInfoService.getById(id);</span><br><span class="line">if (interfaceInfo == null) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.NOT_FOUND_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">if (interfaceInfo.getStatus() != InterfaceInfoStatusEnum.ONLINE.getValue()) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.SYSTEM_ERROR, &quot;æ¥å£æœªä¸Šçº¿&quot;);</span><br><span class="line">&#125;</span><br><span class="line">// å¾—åˆ°å½“å‰ç”¨æˆ·</span><br><span class="line">User loginUser = userService.getLoginUser(request);</span><br><span class="line">String accessKey = loginUser.getAccessKey();</span><br><span class="line">String secretKey = loginUser.getSecretKey();</span><br><span class="line">XuanApiClient client = new XuanApiClient(accessKey, secretKey);</span><br><span class="line">// å…ˆå†™æ­»è¯·æ±‚</span><br><span class="line">String userRequestParams = invokeInterfaceRequest.getRequestParams();</span><br><span class="line">com.xuan.model.User user = JSONUtil.toBean(userRequestParams, com.xuan.model.User.class);</span><br><span class="line">String result = client.getNameByPostWithJson(user);</span><br><span class="line">return ResultUtils.success(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h2 id="3ã€ä¿®æ”¹å‰ç«¯"><a href="#3ã€ä¿®æ”¹å‰ç«¯" class="headerlink" title="3ã€ä¿®æ”¹å‰ç«¯"></a>3ã€ä¿®æ”¹å‰ç«¯</h2><hr>
<p>Ant Designä¸­ Formç»„ä»¶ onFinishï¼š æäº¤è¡¨å•ä¸”æ•°æ®éªŒè¯æˆåŠŸåå›è°ƒäº‹ä»¶ Â  æ‰€ä»¥æˆ‘ä»¬æ¥ç¼–å†™onFinishæ–¹æ³• Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const onFinish = async (requestData: API.InvokeInterfaceRequest) =&gt; &#123;</span><br><span class="line">  if (!params.id) &#123;</span><br><span class="line">    message.error(&#x27;æ— æ•°æ®ï¼Œè¯·é‡è¯•&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">  try &#123;</span><br><span class="line">    const res = await invokeInterfaceUsingPOST(&#123;</span><br><span class="line">      id: Number(params.id),</span><br><span class="line">      ...requestData,</span><br><span class="line">    &#125;);</span><br><span class="line">    setResData(res.data);</span><br><span class="line">    message.success(&#x27;è°ƒç”¨æˆåŠŸ!&#x27;);</span><br><span class="line">  &#125; catch (error: any) &#123;</span><br><span class="line">    message.error(&#x27;è¯·æ±‚å¤±è´¥,&#x27; + error.message);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Â  å†ä¿®æ”¹ä¸€ä¸‹æ ·å¼ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">import &#123; PageContainer &#125; from &#x27;@ant-design/pro-components&#x27;;</span><br><span class="line">import &#123; Badge, Card, Descriptions, message, Form, Input, Button, Divider &#125; from &#x27;antd&#x27;;</span><br><span class="line">import React, &#123; useEffect, useState &#125; from &#x27;react&#x27;;</span><br><span class="line">import &#123;</span><br><span class="line">  getInterfaceInfoByIdUsingGET,</span><br><span class="line">  invokeInterfaceUsingPOST,</span><br><span class="line">&#125; from &#x27;@/services/api-platform-backend/interfaceInfoController&#x27;;</span><br><span class="line">import &#123; useParams &#125; from &#x27;react-router&#x27;;</span><br><span class="line">import moment from &#x27;moment&#x27;;</span><br><span class="line"></span><br><span class="line">const InterfaceInfo: React.FC = () =&gt; &#123;</span><br><span class="line">  const [loading, setLoading] = useState(false);</span><br><span class="line">  const [data, setData] = useState&lt;API.InterfaceInfo&gt;();</span><br><span class="line">  const [resData, setResData] = useState&lt;any&gt;();</span><br><span class="line"></span><br><span class="line">  const params = useParams();</span><br><span class="line"></span><br><span class="line">  const loadData = async () =&gt; &#123;</span><br><span class="line">    if (!params.id) &#123;</span><br><span class="line">      message.error(&#x27;æ— æ•°æ®ï¼Œè¯·é‡è¯•&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    setLoading(true);</span><br><span class="line">    try &#123;</span><br><span class="line">      const res = await getInterfaceInfoByIdUsingGET(&#123;</span><br><span class="line">        id: Number(params.id),</span><br><span class="line">      &#125;);</span><br><span class="line">      setData(res?.data);</span><br><span class="line">      setLoading(false);</span><br><span class="line">    &#125; catch (error: any) &#123;</span><br><span class="line">      setLoading(false);</span><br><span class="line">      message.error(&#x27;è¯·æ±‚å¤±è´¥,&#x27; + error.message);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    loadData();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  const onFinish = async (requestData: API.InvokeInterfaceRequest) =&gt; &#123;</span><br><span class="line">    if (!params.id) &#123;</span><br><span class="line">      message.error(&#x27;æ— æ•°æ®ï¼Œè¯·é‡è¯•&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    try &#123;</span><br><span class="line">      const res = await invokeInterfaceUsingPOST(&#123;</span><br><span class="line">        id: Number(params.id),</span><br><span class="line">        ...requestData,</span><br><span class="line">      &#125;);</span><br><span class="line">      setResData(res.data);</span><br><span class="line">      message.success(&#x27;è°ƒç”¨æˆåŠŸ!&#x27;);</span><br><span class="line">    &#125; catch (error: any) &#123;</span><br><span class="line">      message.error(&#x27;è¯·æ±‚å¤±è´¥,&#x27; + error.message);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;PageContainer title=&#123;&#x27;æ¥å£è¯¦æƒ…&#x27;&#125;&gt;</span><br><span class="line">      &#123;data ? (</span><br><span class="line">        &lt;&gt;</span><br><span class="line">          &lt;Card loading=&#123;loading&#125;&gt;</span><br><span class="line">            &lt;Descriptions title=&#123;data.name&#125; column=&#123;2&#125; layout=&quot;vertical&quot; bordered=&#123;true&#125;&gt;</span><br><span class="line">              &lt;Descriptions.Item label=&quot;æè¿°&quot;&gt;&#123;data.description&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">              &lt;Descriptions.Item label=&quot;æ¥å£çŠ¶æ€&quot;&gt;</span><br><span class="line">                &#123;data.status === 0 ? (</span><br><span class="line">                  &lt;Badge text=&#123;&#x27;å…³é—­&#x27;&#125; status=&#123;&#x27;default&#x27;&#125; /&gt;</span><br><span class="line">                ) : (</span><br><span class="line">                  &lt;Badge text=&#123;&#x27;å¯ç”¨&#x27;&#125; status=&#123;&#x27;processing&#x27;&#125; /&gt;</span><br><span class="line">                )&#125;</span><br><span class="line">              &lt;/Descriptions.Item&gt;</span><br><span class="line">              &lt;Descriptions.Item label=&quot;è¯·æ±‚åœ°å€&quot;&gt;&#123;data.url&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">              &lt;Descriptions.Item label=&quot;è¯·æ±‚æ–¹æ³•&quot;&gt;&#123;data.method&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">              &lt;Descriptions.Item label=&quot;è¯·æ±‚å¤´&quot;&gt;&#123;data.requestHeader&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">              &lt;Descriptions.Item label=&quot;è¯·æ±‚å‚æ•°&quot;&gt;&#123;data.requestParams&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">              &lt;Descriptions.Item label=&quot;å“åº”å¤´&quot;&gt;&#123;data.responseHeader&#125;&lt;/Descriptions.Item&gt;</span><br><span class="line">              &lt;Descriptions.Item label=&quot;åˆ›å»ºæ—¶é—´&quot;&gt;</span><br><span class="line">                &#123;moment(data.createTime).format(&#x27;yyyy-MM-DD HH:mm:ss&#x27;)&#125;</span><br><span class="line">              &lt;/Descriptions.Item&gt;</span><br><span class="line">              &lt;Descriptions.Item label=&quot;æ›´æ–°æ—¶é—´&quot;&gt;</span><br><span class="line">                &#123;moment(data.updateTime).format(&#x27;yyyy-MM-DD HH:mm:ss&#x27;)&#125;</span><br><span class="line">              &lt;/Descriptions.Item&gt;</span><br><span class="line">            &lt;/Descriptions&gt;</span><br><span class="line">          &lt;/Card&gt;</span><br><span class="line">          &lt;Divider /&gt;</span><br><span class="line">          &lt;Card title=&#123;&#x27;åœ¨çº¿è°ƒç”¨&#x27;&#125;&gt;</span><br><span class="line">            &lt;Form name=&quot;basic&quot; layout=&#123;&#x27;vertical&#x27;&#125; onFinish=&#123;onFinish&#125;&gt;</span><br><span class="line">              &lt;Form.Item label=&quot;è¯·æ±‚å‚æ•°&quot; name=&quot;requestParams&quot;&gt;</span><br><span class="line">                &lt;Input.TextArea /&gt;</span><br><span class="line">              &lt;/Form.Item&gt;</span><br><span class="line">              &lt;Form.Item&gt;</span><br><span class="line">                &lt;Button type=&quot;primary&quot; htmlType=&quot;submit&quot;&gt;</span><br><span class="line">                  è°ƒç”¨</span><br><span class="line">                &lt;/Button&gt;</span><br><span class="line">              &lt;/Form.Item&gt;</span><br><span class="line">            &lt;/Form&gt;</span><br><span class="line">          &lt;/Card&gt;</span><br><span class="line">          &#123;resData ? &lt;Card title=&#123;&#x27;è°ƒç”¨ç»“æœ&#x27;&#125;&gt;&#123;resData&#125;&lt;/Card&gt; : null&#125;</span><br><span class="line">        &lt;/&gt;</span><br><span class="line">      ) : (</span><br><span class="line">        &#x27;æ¥å£ä¸å­˜åœ¨&#x27;</span><br><span class="line">      )&#125;</span><br><span class="line">    &lt;/PageContainer&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default InterfaceInfo;</span><br></pre></td></tr></table></figure>

<p>Â  æµ‹è¯•å¦‚ä¸‹ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230119113714929.png"> Â </p>
<h2 id="4ã€TODO"><a href="#4ã€TODO" class="headerlink" title="4ã€TODO"></a>4ã€TODO</h2><hr>
<ul>
<li><p>åˆ¤æ–­è¯¥æ¥å£æ˜¯å¦å¯ä»¥è°ƒç”¨æ—¶ç”±å›ºå®šæ–¹æ³•åæ”¹ä¸ºæ ¹æ®æµ‹è¯•åœ°å€æ¥è°ƒç”¨</p>
</li>
<li><p>ç”¨æˆ·æµ‹è¯•æ¥å£å›ºå®šæ–¹æ³•åæ”¹ä¸ºæ ¹æ®æµ‹è¯•åœ°å€æ¥è°ƒç”¨</p>
</li>
<li><p>æ¨¡æ‹Ÿæ¥å›—æ”¹ä¸ºä»æ•°æ®åº“æ ¡éªŒaccessKeyã€secretKey</p>
</li>
</ul>
<p>Â </p>
<h1 id="ä¹ã€æ¥å£è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡"><a href="#ä¹ã€æ¥å£è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡" class="headerlink" title="ä¹ã€æ¥å£è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡"></a>ä¹ã€æ¥å£è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡</h1><hr>
<p><strong>éœ€æ±‚</strong> Â </p>
<ol>
<li><p>ç”¨æˆ·æ¯æ¬¡è°ƒç”¨æ¥å£æˆåŠŸï¼Œæ¬¡æ•°+1</p>
</li>
<li><p>ç»™ç”¨æˆ·åˆ†é…æˆ–è€…ç”¨æˆ·è‡ªä¸»ç”³è¯·è°ƒç”¨æ¬¡æ•°</p>
</li>
</ol>
<p>Â  <strong>ä¸šåŠ¡æµç¨‹</strong> Â </p>
<ol>
<li><p>ç”¨æˆ·è°ƒç”¨æ¥å£ï¼ˆä¹‹å‰å·²å®Œæˆï¼‰</p>
</li>
<li><p>ä¿®æ”¹æ•°æ®åº“ï¼Œè°ƒç”¨æ¬¡æ•°+1</p>
</li>
</ol>
<p>Â </p>
<h2 id="1ã€è®¾è®¡åº“è¡¨"><a href="#1ã€è®¾è®¡åº“è¡¨" class="headerlink" title="1ã€è®¾è®¡åº“è¡¨"></a>1ã€è®¾è®¡åº“è¡¨</h2><p>Â  å“ªä¸ªç”¨æˆ·ï¼Ÿå“ªä¸ªæ¥å£ï¼Ÿ ç”¨æˆ·&#x3D;&gt;æ¥å£ï¼ˆå¤šå¯¹å¤šï¼‰ Â  <strong>ç”¨æˆ·è°ƒç”¨æ¥å£å…³ç³»è¡¨</strong> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists api_platform.`user_interface_info`</span><br><span class="line">(</span><br><span class="line">    `id` bigint not null auto_increment comment &#x27;ä¸»é”®&#x27; primary key,</span><br><span class="line">    `user_id` bigint not null comment &#x27;è°ƒç”¨ç”¨æˆ·Id&#x27;,</span><br><span class="line">    `interface_info_id` bigint not null comment &#x27;æ¥å£Id&#x27;,</span><br><span class="line">    `total_num` int default 0 not null comment &#x27;æ€»è°ƒç”¨æ¬¡æ•°&#x27;,</span><br><span class="line">  `left_num` int default 0 not null comment &#x27;å‰©ä½™è°ƒç”¨æ¬¡æ•°&#x27;,</span><br><span class="line">    `status` int default 0 not null comment &#x27;0-æ­£å¸¸ ï¼Œ1-ç¦ç”¨&#x27;,</span><br><span class="line">    `create_time` datetime default CURRENT_TIMESTAMP not null comment &#x27;åˆ›å»ºæ—¶é—´&#x27;,</span><br><span class="line">    `update_time` datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment &#x27;æ›´æ–°æ—¶é—´&#x27;,</span><br><span class="line">    `is_delete` tinyint default 0 not null comment &#x27;æ˜¯å¦åˆ é™¤(0-æœªåˆ , 1-å·²åˆ )&#x27;</span><br><span class="line">) comment &#x27;ç”¨æˆ·è°ƒç”¨æ¥å£å…³ç³»è¡¨&#x27;;</span><br></pre></td></tr></table></figure>

<p>Â  æ‰§è¡Œsqlè¯­å¥ Â  <strong>ä½¿ç”¨MybatisXæ’ä»¶</strong> Â  ç”Ÿæˆuser_interface_infoè¡¨çš„ä»£ç  Â  åœ¨isDeleteä¸Šå¢åŠ <a href="/TableLogic">@TableLogic</a> æ³¨é‡Š ä»£è¡¨é€»è¾‘åˆ é™¤ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * ç”¨æˆ·è°ƒç”¨æ¥å£å…³ç³»è¡¨</span><br><span class="line"> * @TableName user_interface_info</span><br><span class="line"> */</span><br><span class="line">@TableName(value =&quot;user_interface_info&quot;)</span><br><span class="line">@Data</span><br><span class="line">public class UserInterfaceInfo implements Serializable &#123;</span><br><span class="line">    /**</span><br><span class="line">     * ä¸»é”®</span><br><span class="line">     */</span><br><span class="line">    @TableId(type = IdType.AUTO)</span><br><span class="line">    private Long id;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * æ˜¯å¦åˆ é™¤(0-æœªåˆ , 1-å·²åˆ )</span><br><span class="line">     */</span><br><span class="line">    @TableLogic</span><br><span class="line">    private Integer isDelete;</span><br><span class="line"></span><br><span class="line">    @TableField(exist = false)</span><br><span class="line">    private static final long serialVersionUID = 1L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h2 id="2ã€åŸºç¡€å¢åˆ æ”¹æŸ¥"><a href="#2ã€åŸºç¡€å¢åˆ æ”¹æŸ¥" class="headerlink" title="2ã€åŸºç¡€å¢åˆ æ”¹æŸ¥"></a>2ã€åŸºç¡€å¢åˆ æ”¹æŸ¥</h2><p>Â  å…ˆéœ€è¦åœ¨dtoä¸­åˆ›å»ºç±» Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230123172908757.png"> Â  å†å¤åˆ¶ä¹‹å‰çš„controlleræ”¹åæ›¿æ¢ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line">package com.xuan.project.controller;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * APIä¿¡æ¯æ¥å£</span><br><span class="line"> *</span><br><span class="line"> * @author xuan</span><br><span class="line"> */</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/userInterfaceInfo&quot;)</span><br><span class="line">@Slf4j</span><br><span class="line">public class UserInterfaceInfoController &#123;</span><br><span class="line"></span><br><span class="line">@Resource</span><br><span class="line">private UserInterfaceInfoService userInterfaceInfoService;</span><br><span class="line"></span><br><span class="line">@Resource</span><br><span class="line">private UserService userService;</span><br><span class="line"></span><br><span class="line">// region å¢åˆ æ”¹æŸ¥</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * åˆ›å»º</span><br><span class="line"> *</span><br><span class="line"> * @param userInterfaceInfoAddRequest</span><br><span class="line"> * @param request</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@PostMapping(&quot;/add&quot;)</span><br><span class="line">@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)</span><br><span class="line">public BaseResponse&lt;Long&gt; addUserInterfaceInfo(@RequestBody UserInterfaceInfoAddRequest userInterfaceInfoAddRequest, HttpServletRequest request) &#123;</span><br><span class="line">if (userInterfaceInfoAddRequest == null) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.PARAMS_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">UserInterfaceInfo userInterfaceInfo = new UserInterfaceInfo();</span><br><span class="line">BeanUtils.copyProperties(userInterfaceInfoAddRequest, userInterfaceInfo);</span><br><span class="line">// æ ¡éªŒ</span><br><span class="line">userInterfaceInfoService.validUserInterfaceInfo(userInterfaceInfo, true);</span><br><span class="line">// è®¾ç½®å½“å‰ç”¨æˆ·id</span><br><span class="line">User loginUser = userService.getLoginUser(request);</span><br><span class="line">userInterfaceInfo.setUserId(loginUser.getId());</span><br><span class="line">boolean result = userInterfaceInfoService.save(userInterfaceInfo);</span><br><span class="line">if (!result) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.OPERATION_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">long newUserInterfaceInfoId = userInterfaceInfo.getId();</span><br><span class="line">return ResultUtils.success(newUserInterfaceInfoId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * åˆ é™¤</span><br><span class="line"> *</span><br><span class="line"> * @param deleteRequest</span><br><span class="line"> * @param request</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@PostMapping(&quot;/delete&quot;)</span><br><span class="line">public BaseResponse&lt;Boolean&gt; deleteUserInterfaceInfo(@RequestBody DeleteRequest deleteRequest, HttpServletRequest request) &#123;</span><br><span class="line">if (deleteRequest == null  deleteRequest.getId() &lt;= 0) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.PARAMS_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">User user = userService.getLoginUser(request);</span><br><span class="line">long id = deleteRequest.getId();</span><br><span class="line">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span><br><span class="line">UserInterfaceInfo oldUserInterfaceInfo = userInterfaceInfoService.getById(id);</span><br><span class="line">if (oldUserInterfaceInfo == null) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.NOT_FOUND_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">// ä»…æœ¬äººæˆ–ç®¡ç†å‘˜å¯åˆ é™¤</span><br><span class="line">if (!oldUserInterfaceInfo.getUserId().equals(user.getId()) &amp;&amp; !userService.isAdmin(request)) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.NO_AUTH_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">boolean b = userInterfaceInfoService.removeById(id);</span><br><span class="line">return ResultUtils.success(b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æ›´æ–°</span><br><span class="line"> *</span><br><span class="line"> * @param userInterfaceInfoUpdateRequest</span><br><span class="line"> * @param request</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@PostMapping(&quot;/update&quot;)</span><br><span class="line">public BaseResponse&lt;Boolean&gt; updateUserInterfaceInfo(@RequestBody UserInterfaceInfoUpdateRequest userInterfaceInfoUpdateRequest,</span><br><span class="line">                                                     HttpServletRequest request) &#123;</span><br><span class="line">if (userInterfaceInfoUpdateRequest == null  userInterfaceInfoUpdateRequest.getId() &lt;= 0) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.PARAMS_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">UserInterfaceInfo userInterfaceInfo = new UserInterfaceInfo();</span><br><span class="line">BeanUtils.copyProperties(userInterfaceInfoUpdateRequest, userInterfaceInfo);</span><br><span class="line">// å‚æ•°æ ¡éªŒ</span><br><span class="line">userInterfaceInfoService.validUserInterfaceInfo(userInterfaceInfo, false);</span><br><span class="line">User user = userService.getLoginUser(request);</span><br><span class="line">System.out.println(user);</span><br><span class="line">long id = userInterfaceInfoUpdateRequest.getId();</span><br><span class="line">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span><br><span class="line">UserInterfaceInfo oldUserInterfaceInfo = userInterfaceInfoService.getById(id);</span><br><span class="line">if (oldUserInterfaceInfo == null) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.NOT_FOUND_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">// ä»…æœ¬äººæˆ–ç®¡ç†å‘˜å¯ä¿®æ”¹</span><br><span class="line">userService.isAdmin(request);</span><br><span class="line">if (!oldUserInterfaceInfo.getUserId().equals(user.getId()) &amp;&amp; !userService.isAdmin(request)) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.NO_AUTH_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">boolean result = userInterfaceInfoService.updateById(userInterfaceInfo);</span><br><span class="line">return ResultUtils.success(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æ ¹æ® id è·å–</span><br><span class="line"> *</span><br><span class="line"> * @param id</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@GetMapping(&quot;/get&quot;)</span><br><span class="line">public BaseResponse&lt;UserInterfaceInfo&gt; getUserInterfaceInfoById(long id) &#123;</span><br><span class="line">if (id &lt;= 0) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.PARAMS_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">UserInterfaceInfo userInterfaceInfo = userInterfaceInfoService.getById(id);</span><br><span class="line">return ResultUtils.success(userInterfaceInfo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è·å–åˆ—è¡¨ï¼ˆä»…ç®¡ç†å‘˜å¯ä½¿ç”¨ï¼‰</span><br><span class="line"> *</span><br><span class="line"> * @param userInterfaceInfoQueryRequest</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@AuthCheck(mustRole = &quot;admin&quot;)</span><br><span class="line">@GetMapping(&quot;/list&quot;)</span><br><span class="line">public BaseResponse&lt;List&lt;UserInterfaceInfo&gt;&gt; listUserInterfaceInfo(UserInterfaceInfoQueryRequest userInterfaceInfoQueryRequest) &#123;</span><br><span class="line">UserInterfaceInfo userInterfaceInfoQuery = new UserInterfaceInfo();</span><br><span class="line">if (userInterfaceInfoQueryRequest != null) &#123;</span><br><span class="line">BeanUtils.copyProperties(userInterfaceInfoQueryRequest, userInterfaceInfoQuery);</span><br><span class="line">&#125;</span><br><span class="line">QueryWrapper&lt;UserInterfaceInfo&gt; queryWrapper = new QueryWrapper&lt;&gt;(userInterfaceInfoQuery);</span><br><span class="line">List&lt;UserInterfaceInfo&gt; userInterfaceInfoList = userInterfaceInfoService.list(queryWrapper);</span><br><span class="line">return ResultUtils.success(userInterfaceInfoList);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * åˆ†é¡µè·å–åˆ—è¡¨</span><br><span class="line"> *</span><br><span class="line"> * @param userInterfaceInfoQueryRequest</span><br><span class="line"> * @param request</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@GetMapping(&quot;/list/page&quot;)</span><br><span class="line">public BaseResponse&lt;Page&lt;UserInterfaceInfo&gt;&gt; listUserInterfaceInfoByPage(UserInterfaceInfoQueryRequest userInterfaceInfoQueryRequest, HttpServletRequest request) &#123;</span><br><span class="line">if (userInterfaceInfoQueryRequest == null) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.PARAMS_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">UserInterfaceInfo userInterfaceInfoQuery = new UserInterfaceInfo();</span><br><span class="line">BeanUtils.copyProperties(userInterfaceInfoQueryRequest, userInterfaceInfoQuery);</span><br><span class="line">long current = userInterfaceInfoQueryRequest.getCurrent();</span><br><span class="line">long size = userInterfaceInfoQueryRequest.getPageSize();</span><br><span class="line">String sortField = userInterfaceInfoQueryRequest.getSortField();</span><br><span class="line">String sortOrder = userInterfaceInfoQueryRequest.getSortOrder();</span><br><span class="line">// é™åˆ¶çˆ¬è™«</span><br><span class="line">if (size &gt; 50) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.PARAMS_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">QueryWrapper&lt;UserInterfaceInfo&gt; queryWrapper = new QueryWrapper&lt;&gt;(userInterfaceInfoQuery);</span><br><span class="line">queryWrapper.orderBy(StringUtils.isNotBlank(sortField),</span><br><span class="line">sortOrder.equals(CommonConstant.SORT_ORDER_ASC), sortField);</span><br><span class="line">Page&lt;UserInterfaceInfo&gt; userInterfaceInfoPage = userInterfaceInfoService.page(new Page&lt;&gt;(current, size), queryWrapper);</span><br><span class="line">return ResultUtils.success(userInterfaceInfoPage);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h2 id="3ã€è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡"><a href="#3ã€è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡" class="headerlink" title="3ã€è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡"></a>3ã€è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡</h2><p>Â  ç”¨æˆ·æ¯æ¬¡è°ƒç”¨æ¥å£æˆåŠŸï¼Œæ¬¡æ•°+1ï¼ˆservice) Â  <strong>ç¼–å†™æ–¹æ³•</strong> Â  åœ¨<strong>service</strong>å±‚çš„<strong>UserInterfaceInfoService</strong>ç¼–å†™æ–¹æ³• Â  è¿™é‡Œåªæ˜¯è¿‡æµç¨‹ï¼Œå®é™…åº”è¯¥å¤šæ ¡éªŒ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public boolean invokeInterfaceCount(long userId, long interfaceInfoId) &#123;</span><br><span class="line">if (userId &lt;= 0  interfaceInfoId &lt;= 0) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.NOT_FOUND_ERROR);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LambdaUpdateWrapper&lt;UserInterfaceInfo&gt; updateWrapper = new LambdaUpdateWrapper&lt;&gt;();</span><br><span class="line">updateWrapper.eq(UserInterfaceInfo::getUserId, userId)</span><br><span class="line">.eq(UserInterfaceInfo::getInterfaceInfoId, interfaceInfoId)</span><br><span class="line">.gt(UserInterfaceInfo::getLeftNum, 0)</span><br><span class="line">.setSql(&quot;left_num = left_num -1, total_num = total_num + 1&quot;);</span><br><span class="line"></span><br><span class="line">return update(updateWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  æ³¨æ„ï¼šå…¶å®è¿™é‡Œåº”è¯¥æ·»åŠ äº‹åŠ¡ï¼Œæ·»åŠ é” Â  æ¥å£æµ‹è¯•æˆåŠŸ Â </p>
<h2 id="4ã€é—®é¢˜"><a href="#4ã€é—®é¢˜" class="headerlink" title="4ã€é—®é¢˜"></a>4ã€é—®é¢˜</h2><p>Â  å¦‚æœæ¯ä¸ªæ¥å£çš„æ–¹æ³•éƒ½å†™è°ƒç”¨æ¬¡æ•°+1ï¼Œæ˜¯ä¸æ˜¯æ¯”è¾ƒéº»çƒ¦ï¼Ÿ Â  è‡´å‘½é—®é¢˜ï¼šæ¥å£å¼€å‘è€…éœ€è¦è‡ªå·±å»æ·»åŠ ç»Ÿè®¡ä»£ç  Â  å°±æƒ³åˆ°å¯ä»¥ä½¿ç”¨AOPã€ç½‘å…³ Â  <strong>é€»è¾‘å›¾</strong> Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230126112301389.png"> Â  <strong>AOPåˆ‡é¢çš„ä¼˜ç‚¹</strong>ï¼šç‹¬ç«‹äºæ¥å£ï¼Œåœ¨æ¯ä¸ªæ¥å£è°ƒç”¨åç»Ÿè®¡æ¬¡æ•°+1 <strong>AOPåˆ‡é¢çš„ç¼ºç‚¹</strong>ï¼šåªå­˜åœ¨äºå•ä¸ªé¡¹ç›®ä¸­ï¼Œå¦‚æœæ¯ä¸ªå›¢é˜Ÿéƒ½è¦å¼€å‘è‡ªå·±çš„æ¨¡æ‹Ÿæ¥å£ï¼Œé‚£ä¹ˆéƒ½è¦å†™ä¸€ä¸ªåˆ‡é¢ Â  æ‰€ä»¥æœ€ç»ˆæˆ‘ä»¬åœ¨è¿™ä¸ªé¡¹ç›®é€‰æ‹©ä½¿ç”¨<strong>ç½‘å…³</strong> Â </p>
<h1 id="åã€ç½‘å…³"><a href="#åã€ç½‘å…³" class="headerlink" title="åã€ç½‘å…³"></a>åã€ç½‘å…³</h1><hr>
<p>ä»€ä¹ˆæ˜¯ç½‘å…³ï¼Ÿç†è§£æˆç«è½¦ç«™çš„æ£€ç¥¨å£ï¼Œ<strong>ç»Ÿä¸€</strong>Â æ£€ç¥¨ Â  <strong>ç½‘å…³ä¼˜ç‚¹</strong>ï¼š ç»Ÿä¸€è¿›è¡Œæ“ä½œï¼Œå»å¤„ç†ä¸€äº›é—®é¢˜ Â </p>
<h2 id="1ã€ç½‘å…³ä½œç”¨"><a href="#1ã€ç½‘å…³ä½œç”¨" class="headerlink" title="1ã€ç½‘å…³ä½œç”¨"></a>1ã€ç½‘å…³ä½œç”¨</h2><hr>
<ol>
<li><p>è·¯ç”±</p>
</li>
<li><p>è´Ÿè½½å‡è¡¡</p>
</li>
<li><p>ç»Ÿä¸€é‰´æƒ</p>
</li>
<li><p>ç»Ÿä¸€å¤„ç†è·¨åŸŸ</p>
</li>
<li><p>ç»Ÿä¸€ä¸šåŠ¡å¤„ç†ï¼ˆç¼“å­˜ï¼‰</p>
</li>
<li><p>è®¿é—®æ§åˆ¶</p>
</li>
<li><p>å‘å¸ƒæ§åˆ¶</p>
</li>
<li><p>æµé‡æŸ“è‰²</p>
</li>
<li><p>ç»Ÿä¸€æ¥å£ä¿æŠ¤</p>
</li>
<li><p>é™åˆ¶è¯·æ±‚</p>
</li>
<li><p>ä¿¡æ¯è„±æ•</p>
</li>
<li><p>é™çº§ï¼ˆç†”æ–­ï¼‰</p>
</li>
<li><p>é™æµ å­¦ä¹ ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œå­¦ä¹ éœ²æ¡¶ç®—æ³•ï¼Œå­¦ä¹ ä¸€ä¸‹RedislimitHandler</p>
</li>
<li><p>è¶…æ—¶æ—¶é—´</p>
</li>
<li><p>é‡è¯•ï¼ˆä¸šåŠ¡ä¿æŠ¤ï¼‰</p>
</li>
<li><p>ç»Ÿä¸€æ—¥å¿—</p>
</li>
<li><p>ç»Ÿä¸€æ–‡æ¡£</p>
</li>
</ol>
<p>Â </p>
<h2 id="2ã€å…·ä½“ä½œç”¨"><a href="#2ã€å…·ä½“ä½œç”¨" class="headerlink" title="2ã€å…·ä½“ä½œç”¨"></a>2ã€å…·ä½“ä½œç”¨</h2><hr>
<p><strong>è·¯ç”±</strong> Â  èµ·åˆ°è½¬å‘çš„ä½œç”¨ï¼Œæ¯”å¦‚æœ‰æ¥å£Aå’Œæ¥å£B,ç½‘å…³ä¼šè®°å½•è¿™äº›ä¿¡æ¯ï¼Œæ ¹æ®ç”¨æˆ·è®¿é—®çš„åœ°å€å’Œå‚æ•°ï¼Œè½¬å‘è¯·æ±‚åˆ°å¯¹åº”çš„æ¥å£ï¼ˆæœåŠ¡å™¨&#x2F;é›†ç¾¤ï¼‰ Â  ç”¨æˆ·aè°ƒç”¨æ¥å£A Â  &#x2F;a &#x3D;&gt; æ¥å£A &#x2F;b &#x3D;&gt; æ¥å£B Â  <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories</a> Â  <strong>è´Ÿè½½å‡è¡¡</strong> Â  åœ¨è·¯ç”±çš„åŸºç¡€ä¸Šå¯ä»¥è½¬å‘åˆ°æŸä¸€ä¸ªæœåŠ¡å™¨ Â  &#x2F;c &#x3D;&gt; æœåŠ¡A&#x2F; é›†ç¾¤Aï¼ˆéšæœºè½¬å‘åˆ°å…¶ä¸­çš„æŸä¸€ä¸ªæœºå™¨ï¼‰ Â  uriä»å›ºå®šåœ°å€æ”¹æˆb:xx Â  <strong>ç»Ÿä¸€é‰´æƒ</strong> Â  åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è¿›è¡Œæ“ä½œï¼Œæ— è®ºè®¿é—®ä»€ä¹ˆæ¥å£ï¼Œæˆ‘éƒ½ç»Ÿä¸€å»åˆ¤æ–­æƒé™ï¼Œä¸ç”¨é‡å¤å†™ Â  <strong>ç»Ÿä¸€å¤„ç†è·¨åŸŸ</strong> Â  ç½‘å…³ç»Ÿä¸€å¤„ç†è·¨åŸŸï¼Œä¸ç”¨åœ¨æ¯ä¸ªé¡¹ç›®å•ç‹¬å¤„ç† Â  <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#cors-configuration">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#cors-configuration</a> Â  <strong>ç»Ÿä¸€ä¸šåŠ¡å¤„ç†</strong> Â  æŠŠæ¯ä¸ªé¡¹ç›®ä¸­éƒ½è¦åšçš„é€šç”¨é€»è¾‘æ”¾åˆ°ä¸Šå±‚ï¼ˆç½‘å…³ï¼‰ï¼Œç»Ÿä¸€å¤„ç†ï¼Œæ¯”å¦‚æœ¬é¡¹ç›®çš„æ¬¡æ•°ç»Ÿè®¡ Â  <strong>è®¿é—®æ§åˆ¶</strong> Â  é»‘ç™½åå•ï¼Œæ¯”å¦‚é™åˆ¶DDOS IP Â  <strong>å‘å¸ƒæ§åˆ¶</strong> Â  ç°åº¦å‘å¸ƒï¼Œæ¯”å¦‚ä¸Šçº¿æ–°æ¥å£ï¼Œå…ˆç»™æ–°æ¥å£åˆ†é… 20%æµé‡ï¼Œè€æ¥å£80% ,å†æ…¢æ…¢è°ƒæ•´æ¯”ä¾‹ Â  <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-weight-route-predicate-factory">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-weight-route-predicate-factory</a> Â  <strong>æµé‡æŸ“è‰²</strong> Â  åŒºåˆ†ç”¨æˆ·æ¥æº Â  ç»™è¯·æ±‚ï¼ˆæµé‡ï¼‰æ·»åŠ ä¸€äº›æ ‡è¯†ï¼Œä¸€èˆ¬æ˜¯è®¾ç½®è¯·æ±‚å¤´ä¸­ï¼Œæ·»åŠ æ–°çš„è¯·æ±‚å¤´ <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-addrequestheader-gatewayfilter-factory">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-addrequestheader-gatewayfilter-factory</a> Â  <strong>å…¨å±€æŸ“è‰²</strong>ï¼š<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#default-filters">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#default-filters</a> Â  <strong>æ¥å£ä¿æŠ¤</strong> Â </p>
<ol>
<li><p>é™åˆ¶è¯·æ±‚ <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#requestheadersiz-gatewayfilter-factory">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#requestheadersiz-gatewayfilter-factory</a></p>
</li>
<li><p>ä¿¡æ¯è„±æ• <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-removerequestheader-gatewayfilter-factory">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-removerequestheader-gatewayfilter-factory</a></p>
</li>
<li><p>é™çº§ï¼ˆç†”æ–­ï¼‰ è¿›è¡Œå…œåº• <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#fallback-headers">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#fallback-headers</a></p>
</li>
<li><p>é™æµ <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-requestratelimiter-gatewayfilter-factory">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-requestratelimiter-gatewayfilter-factory</a></p>
</li>
<li><p>è¶…æ—¶æ—¶é—´ Â  Â è¶…æ—¶å°±ä¸­æ–­ <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#http-timeouts-configuration">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#http-timeouts-configuration</a></p>
</li>
<li><p>é‡è¯•ï¼ˆä¸šåŠ¡ä¿æŠ¤ï¼‰ï¼š <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-retry-gatewayfilter-factory">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-retry-gatewayfilter-factory</a></p>
</li>
</ol>
<p>Â  <strong>ç»Ÿä¸€æ—¥å¿—</strong> Â  ç»Ÿä¸€çš„è¯·æ±‚ï¼Œå“åº”ä¿¡æ¯è®°å½• Â  <strong>ç»Ÿä¸€æ–‡æ¡£</strong> Â  å°†ä¸‹æ¸¸é¡¹ç›®çš„æ–‡æ¡£è¿›è¡Œèšåˆï¼Œåœ¨ä¸€ä¸ªé¡µé¢ç»Ÿä¸€æŸ¥çœ‹ Â  å»ºè®®ç”¨ï¼š<a target="_blank" rel="noopener" href="https://doc.xiaominfo.com/docs/middleware-sources/aggregation-introduction">https://doc.xiaominfo.com/docs/middleware-sources/aggregation-introduction</a> Â  <strong>ç½‘å…³çš„åˆ†ç±»</strong> Â </p>
<ul>
<li><p><strong>å…¨å±€ç½‘å…³ï¼ˆæ¥å…¥å±‚ç½‘å…³ï¼‰</strong>ä½œç”¨æ˜¯è´Ÿè½½å‡è¡¡ã€è¯·æ±‚æ—¥å¿—ç­‰ï¼Œä¸å’Œä¸šåŠ¡é€»è¾‘ç»‘å®š</p>
</li>
<li><p><strong>ä¸šåŠ¡ç½‘å…³ï¼ˆå¾®æœåŠ¡ç½‘å…³ï¼‰</strong>ä¼šæœ‰ä¸€äº›ä¸šåŠ¡é€»è¾‘ï¼Œä½œç”¨æ˜¯å°†è¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„ä¸šåŠ¡&#x2F;é¡¹ç›®&#x2F;æ¥å£&#x2F;æœåŠ¡</p>
</li>
</ul>
<p>Â  å‚è€ƒæ–‡ç« ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_21040559/article/details/122961395">https://blog.csdn.net/qq_21040559&#x2F;article&#x2F;details&#x2F;122961395</a> Â  <strong>å®ç°</strong> Â </p>
<ol>
<li><p><strong>Nginx</strong>Â ï¼ˆå…¨å±€ç½‘å…³ï¼‰ï¼Œ<strong>Kongç½‘å…³</strong>ï¼ˆAPIç½‘å…³ï¼‰ï¼Œ Â <strong>ç¼–ç¨‹æˆæœ¬ç›¸å¯¹è¾ƒé«˜</strong></p>
</li>
<li><p><strong>Spring Cloud Gateway</strong>ï¼ˆå–ä»£äº†Zuulï¼‰æ€§èƒ½é«˜ å¯ä»¥ç”¨javaä»£ç æ¥å†™é€»è¾‘ Â é€‚äºå­¦ä¹ </p>
</li>
</ol>
<p>Â  ç½‘å…³æŠ€æœ¯é€‰å‹ï¼š<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/500587132">https://zhuanlan.zhihu.com/p/500587132</a> Â </p>
<h1 id="åä¸€ã€Spring-Cloud-Gateway"><a href="#åä¸€ã€Spring-Cloud-Gateway" class="headerlink" title="åä¸€ã€Spring Cloud Gateway"></a>åä¸€ã€Spring Cloud Gateway</h1><hr>
<p>å…¨éƒ¨å†…å®¹åŸºæœ¬æ¥è‡ªå®˜ç½‘ Â  å®˜ç½‘ï¼š<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-cloud-gateway">https://spring.io/projects/spring-cloud-gateway</a> Â  å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference//html/">https://docs.spring.io/spring-cloud-gateway/docs/current/reference//html/</a> Â  <strong>æ–°å»ºé¡¹ç›®</strong> Â  åœ¨IDEAä¸­æ–°å»ºé¡¹ç›® å‹¾é€‰Gatewayã€Lombok Â  å‚è€ƒå®˜ç½‘get startedä¸­çš„å®ä¾‹ä»£ç  Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">public class DemogatewayApplication &#123;</span><br><span class="line">@Bean</span><br><span class="line">public RouteLocator customRouteLocator(RouteLocatorBuilder builder) &#123;</span><br><span class="line">return builder.routes()</span><br><span class="line">.route(&quot;path_route&quot;, r -&gt; r.path(&quot;/get&quot;)</span><br><span class="line">.uri(&quot;http://httpbin.org&quot;))</span><br><span class="line">.route(&quot;host_route&quot;, r -&gt; r.host(&quot;*.myhost.org&quot;)</span><br><span class="line">.uri(&quot;http://httpbin.org&quot;))</span><br><span class="line">.route(&quot;rewrite_route&quot;, r -&gt; r.host(&quot;*.rewrite.org&quot;)</span><br><span class="line">.filters(f -&gt; f.rewritePath(&quot;/foo/(?&lt;segment&gt;.*)&quot;, &quot;/$&#123;segment&#125;&quot;))</span><br><span class="line">.uri(&quot;http://httpbin.org&quot;))</span><br><span class="line">.route(&quot;hystrix_route&quot;, r -&gt; r.host(&quot;*.hystrix.org&quot;)</span><br><span class="line">.filters(f -&gt; f.hystrix(c -&gt; c.setName(&quot;slowcmd&quot;)))</span><br><span class="line">.uri(&quot;http://httpbin.org&quot;))</span><br><span class="line">.route(&quot;hystrix_fallback_route&quot;, r -&gt; r.host(&quot;*.hystrixfallback.org&quot;)</span><br><span class="line">.filters(f -&gt; f.hystrix(c -&gt; c.setName(&quot;slowcmd&quot;).setFallbackUri(&quot;forward:/hystrixfallback&quot;)))</span><br><span class="line">.uri(&quot;http://httpbin.org&quot;))</span><br><span class="line">.route(&quot;limit_route&quot;, r -&gt; r</span><br><span class="line">.host(&quot;*.limited.org&quot;).and().path(&quot;/anything/**&quot;)</span><br><span class="line">.filters(f -&gt; f.requestRateLimiter(c -&gt; c.setRateLimiter(redisRateLimiter())))</span><br><span class="line">.uri(&quot;http://httpbin.org&quot;))</span><br><span class="line">.build();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  ç¼–å†™ä»£ç ï¼š Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">package com.xuan;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.cloud.gateway.route.RouteLocator;</span><br><span class="line">import org.springframework.cloud.gateway.route.builder.RouteLocatorBuilder;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class XuanapiGatewayApplication &#123;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">SpringApplication.run(XuanapiGatewayApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">public RouteLocator customRouteLocator(RouteLocatorBuilder builder) &#123;</span><br><span class="line">return builder.routes()</span><br><span class="line">.route(&quot;to_baidu&quot;, r -&gt; r.path(&quot;/baidu&quot;)</span><br><span class="line">.uri(&quot;http://www.baidu.com/&quot;))</span><br><span class="line">.build();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  æµ‹è¯•ç™¾åº¦æˆåŠŸ Â </p>
<h2 id="1ã€æ ¸å¿ƒæ¦‚å¿µ"><a href="#1ã€æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="1ã€æ ¸å¿ƒæ¦‚å¿µ"></a>1ã€æ ¸å¿ƒæ¦‚å¿µ</h2><hr>
<h3 id="1ã€Glossary"><a href="#1ã€Glossary" class="headerlink" title="1ã€Glossary"></a>1ã€<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#glossary">Glossary</a></h3><p>Â  å®˜æ–¹æ–‡æ¡£å¦‚ä¸‹ Â </p>
<ul>
<li><p><strong>Route</strong>: The basic building block of the gateway. It is defined by an ID, a destination URI, a collection of predicates, and a collection of filters. A route is matched if the aggregate predicate is true.</p>
</li>
<li><p><strong>Predicate</strong>: This is aÂ <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Predicate.html">Java 8 Function Predicate</a>. The input type is aÂ <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.0.x/javadoc-api/org/springframework/web/server/ServerWebExchange.html">Spring Framework</a> <code>ServerWebExchange</code>. This lets you match on anything from the HTTP request, such as headers or parameters.</p>
</li>
<li><p><strong>Filter</strong>: These are instances ofÂ <code>GatewayFilter</code>Â that have been constructed with a specific factory. Here, you can modify requests and responses before or after sending the downstream request.</p>
</li>
</ul>
<p>Â </p>
<ol>
<li><p>è·¯ç”±ï¼ˆæ ¹æ®ä»€ä¹ˆæ¡ä»¶ï¼Œè½¬å‘åˆ°å“ªé‡Œï¼‰</p>
</li>
<li><p>æ–­è¨€ï¼ˆä¸€ç»„è§„åˆ™ï¼Œæ¡ä»¶ï¼Œç”¨æ¥ç¡®å®šå¦‚ä½•è½¬å‘è·¯ç”±ï¼‰</p>
</li>
<li><p>è¿‡æ»¤å™¨ï¼šå¯¹è¯·æ±‚è¿›è¡Œä¸€ç³»åˆ—çš„å¤„ç†ï¼Œæ¯”å¦‚æ·»åŠ è¯·æ±‚å¤´ï¼Œæ·»åŠ è¯·æ±‚å‚æ•°</p>
</li>
</ol>
<p>Â </p>
<h3 id="2ã€è¯·æ±‚æµç¨‹"><a href="#2ã€è¯·æ±‚æµç¨‹" class="headerlink" title="2ã€è¯·æ±‚æµç¨‹"></a>2ã€è¯·æ±‚æµç¨‹</h3><p>Â </p>
<ol>
<li><p>å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚</p>
</li>
<li><p>Handler Mapping ï¼šæ ¹æ®æ–­è¨€ï¼Œå»å°†è¯·æ±‚è½¬å‘åˆ°å¯¹åº”çš„è·¯ç”±</p>
</li>
<li><p>Web Handlerï¼šå¤„ç†è¯·æ±‚ï¼ˆä¸€å±‚å±‚ç»è¿‡è¿‡æ»¤å™¨ï¼‰</p>
</li>
<li><p>å®é™…è°ƒç”¨æœåŠ¡</p>
</li>
</ol>
<p>Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230131144724778.png"> Â </p>
<h2 id="2ã€ä¸¤ç§é…ç½®æ–¹å¼"><a href="#2ã€ä¸¤ç§é…ç½®æ–¹å¼" class="headerlink" title="2ã€ä¸¤ç§é…ç½®æ–¹å¼"></a>2ã€ä¸¤ç§é…ç½®æ–¹å¼</h2><hr>
<ol>
<li><p>é…ç½®å¼ ï¼ˆæ–¹ä¾¿ï¼Œè§„èŒƒï¼‰èƒ½ç”¨å°±ç”¨</p>
</li>
<li><p>ç®€åŒ–ç‰ˆ</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: after_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        predicates:</span><br><span class="line">        - Cookie=mycookie,mycookievalue</span><br></pre></td></tr></table></figure>

<p>Â </p>
<ol>
<li>å…¨ç§°</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: after_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        predicates:</span><br><span class="line">        - name: Cookie</span><br><span class="line">          args:</span><br><span class="line">            name: mycookie</span><br><span class="line">            regexp: mycookievalue</span><br></pre></td></tr></table></figure>

<p>Â </p>
<ol start="2">
<li>ç¼–ç¨‹å¼ ï¼ˆçµæ´»ï¼Œç›¸å¯¹éº»çƒ¦ï¼‰</li>
</ol>
<p>Â </p>
<h2 id="3ã€è·¯ç”±çš„å„ç§æ–­è¨€"><a href="#3ã€è·¯ç”±çš„å„ç§æ–­è¨€" class="headerlink" title="3ã€è·¯ç”±çš„å„ç§æ–­è¨€"></a>3ã€è·¯ç”±çš„å„ç§æ–­è¨€</h2><hr>
<p>å®˜ç½‘åœ°å€:<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories</a> Â  <strong>ç›®å½•</strong> Â </p>
<ol>
<li><p>After Â  Â åœ¨xxæ—¶é—´ä¹‹å</p>
</li>
<li><p>Before Â  Â  åœ¨xxæ—¶é—´ä¹‹å‰</p>
</li>
<li><p>Between åœ¨xxæ—¶é—´ä¹‹é—´</p>
</li>
<li><p>è¯·æ±‚ç±»åˆ«</p>
</li>
<li><p>è¯·æ±‚å¤´ï¼ˆåŒ…å«Cookie)</p>
</li>
<li><p>æŸ¥æ¶§å‚æ•°</p>
</li>
<li><p>å®¢æˆ·ç«¯åœ°å€</p>
</li>
<li><p><strong>æƒé‡</strong></p>
</li>
</ol>
<p>Â  <strong>The After Route Predicate Factory</strong> Â  å½“å‰æ—¶é—´åœ¨è¿™ä¸ªæ—¶é—´<strong>ä¹‹å</strong>ï¼Œå°±ä¼šè®¿é—®å½“å‰è¿™ä¸ªè·¯ç”± Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: after_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        predicates:</span><br><span class="line">        - After=2017-01-20T17:42:47.789-07:00[America/Denver]</span><br></pre></td></tr></table></figure>

<p>Â  <strong>The Before Route Predicate Factory</strong> Â  å½“å‰æ—¶é—´åœ¨è¿™ä¸ªæ—¶é—´<strong>ä¹‹å‰</strong>ï¼Œå°±ä¼šè®¿é—®å½“å‰è¿™ä¸ªè·¯ç”± Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: before_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        predicates:</span><br><span class="line">        - Before=2017-01-20T17:42:47.789-07:00[America/Denver]</span><br></pre></td></tr></table></figure>

<p>Â  <strong>The Between Route Predicate Factory</strong> Â  å½“å‰æ—¶é—´åœ¨è¿™ä¸ªæ—¶é—´<strong>ä¹‹é—´</strong>ï¼Œå°±ä¼šè®¿é—®å½“å‰è¿™ä¸ªè·¯ç”± Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: between_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        predicates:</span><br><span class="line">        - Between=2017-01-20T17:42:47.789-07:00[America/Denver], 2017-01-21T17:42:47.789-07:00[America/Denver]</span><br></pre></td></tr></table></figure>

<p>Â  <strong>The Cookie Route Predicate Factory</strong> Â  å¦‚æœä½ çš„<strong>è¯·æ±‚å¤´cookie</strong>çš„æ˜¯<strong>chocolate</strong>ï¼Œå®ƒçš„å€¼æ˜¯<strong>ch.p</strong>ï¼Œå°±ä¼šè®¿é—®å½“å‰è¿™ä¸ªè·¯ç”± Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: cookie_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        predicates:</span><br><span class="line">        - Cookie=chocolate, ch.p</span><br></pre></td></tr></table></figure>

<p>Â  <strong>The Header Route Predicate Factory</strong> Â  å¦‚æœä½ çš„<strong>è¯·æ±‚å¤´</strong>åŒ…å«<strong>X-Request-Id</strong>è¿™æ ·ä¸€ä¸ªè¯·æ±‚å¤´ï¼Œå¹¶ä¸”ï¼Œå®ƒçš„å€¼ç¬¦åˆ<strong>æ­£åˆ™è¡¨è¾¾å¼çš„è§„åˆ™</strong>ï¼Œå°±ä¼šè®¿é—®å½“å‰è¿™ä¸ªè·¯ç”± Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: header_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        predicates:</span><br><span class="line">        - Header=X-Request-Id, \d+</span><br></pre></td></tr></table></figure>

<p>Â  <strong>The Host Route Predicate Factory</strong> Â  å¦‚æœä½ çš„<strong>è®¿é—®</strong>çš„æ˜¯è¿™ä¸ª**.somehost.org,<strong>.<strong>anotherhost.org</strong>ï¼Œ</strong>åŸŸå**ï¼Œå°±ä¼šè®¿é—®å½“å‰è¿™ä¸ªè·¯ç”± Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: host_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        predicates:</span><br><span class="line">        - Host=**.somehost.org,**.anotherhost.org</span><br></pre></td></tr></table></figure>

<p>Â  <strong>The Method Route Predicate Factory</strong> Â  å¦‚æœä½ çš„<strong>è¯·æ±‚ç±»åˆ«</strong>æ˜¯è¿™ä¸ª<strong>GET</strong>ã€<strong>POST</strong>ï¼Œå°±ä¼šè®¿é—®å½“å‰è¿™ä¸ªè·¯ç”± Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: method_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        predicates:</span><br><span class="line">        - Method=GET,POST</span><br></pre></td></tr></table></figure>

<p>Â  <strong>The Path Route Predicate Factory</strong> Â  å¦‚æœä½ çš„<strong>è®¿é—®çš„åœ°å€</strong>æ˜¯ä»¥è¿™äº›**&#x2F;red&#x2F;{segment},&#x2F;blue&#x2F;{segment}**è·¯å¾„ä½œä¸ºå‰ç¼€ï¼Œå°±ä¼šè®¿é—®å½“å‰è¿™ä¸ªè·¯ç”± Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: path_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        predicates:</span><br><span class="line">        - Path=/red/&#123;segment&#125;,/blue/&#123;segment&#125;</span><br></pre></td></tr></table></figure>

<p>Â  <strong>The Query Route Predicate Factory</strong> Â  æ ¹æ®<strong>æŸ¥è¯¢æ¡ä»¶</strong>ï¼Œæ¯”å¦‚red greet greenï¼Œå°±ä¼šè®¿é—®å½“å‰è¿™ä¸ªè·¯ç”± Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: query_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        predicates:</span><br><span class="line">        - Query=red, gree.</span><br></pre></td></tr></table></figure>

<p>Â  <strong>The RemoteAddr Route Predicate Factory</strong> Â  æ ¹æ®<strong>è¿œç¨‹åœ°å€</strong>ï¼Œæ¯”å¦‚ä½ çš„ç”¨æˆ·çš„ipåœ°å€æ˜¯192.168.1.1&#x2F;24ï¼Œå°±ä¼šè®¿é—®å½“å‰è¿™ä¸ªè·¯ç”± Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: remoteaddr_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        predicates:</span><br><span class="line">        - RemoteAddr=192.168.1.1/24</span><br></pre></td></tr></table></figure>

<p>Â  <strong>The Weight Route Predicate Factory</strong> Â  æ ¹æ®ä½ è®¾ç½®çš„<strong>æƒé‡</strong>ï¼Œç»™ä½ æŠŠåŒä¸€ä¸ªè®¿é—®çš„åœ°å€ï¼Œé‡å®šåˆ°ä¸åŒçš„æœåŠ¡ï¼Œè½»æ¾å®ç°å‘å¸ƒæ§åˆ¶ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: weight_high</span><br><span class="line">        uri: https://weighthigh.org</span><br><span class="line">        predicates:</span><br><span class="line">        - Weight=group1, 8</span><br><span class="line">      - id: weight_low</span><br><span class="line">        uri: https://weightlow.org</span><br><span class="line">        predicates:</span><br><span class="line">        - Weight=group1, 2</span><br></pre></td></tr></table></figure>

<p>Â  <strong>The XForwarded Remote Addr Route Predicate Factory</strong> Â  ä»è¯·æ±‚å¤´ä¸­å¦‚æœæ‹¿åˆ°XForwardedè¿™ä¸ª<strong>è¯·æ±‚å¤´çš„åœ°å€</strong>192.168.1.1&#x2F;24 å°±ä¼šè®¿é—®å½“å‰è¿™ä¸ªè·¯ç”± Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: xforwarded_remoteaddr_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        predicates:</span><br><span class="line">        - XForwardedRemoteAddr=192.168.1.1/24</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h2 id="4ã€è¿‡æ»¤å™¨"><a href="#4ã€è¿‡æ»¤å™¨" class="headerlink" title="4ã€è¿‡æ»¤å™¨"></a>4ã€è¿‡æ»¤å™¨</h2><hr>
<p><strong>å®˜ç½‘æ–‡æ¡£</strong>ï¼š<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gatewayfilter-factories">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gatewayfilter-factories</a> Â  <strong>åŸºæœ¬åŠŸèƒ½</strong>ï¼šå¯¹è¯·æ±‚å¤´ã€è¯·æ±‚å‚æ•°ã€å“åº”å¤´çš„å¢åˆ æ”¹æŸ¥ 1.æ·»åŠ æ¸…æ±‚å¤´ 2.æ·»åŠ è¯·æ±‚å‚æ•° 3.æ·»åŠ å“åº”å¤´ 4.é™çº§ 5.é™æµ 6.é‡è¯• Â  <strong>The</strong> <code>AddRequestHeader</code> <code>GatewayFilter</code> <strong>Factory</strong> Â  å¢åŠ è¯·æ±‚å¤´ ï¼ˆå¯ä»¥ç”¨ä½œæµé‡æŸ“è‰²ï¼‰ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: add_request_header_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        filters:</span><br><span class="line">        - AddRequestHeader=X-Request-red, blue</span><br></pre></td></tr></table></figure>

<p>Â  ä½¿ç”¨xuan-apiåšæµ‹è¯• Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8090</span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">        - id: name_api_route</span><br><span class="line">          uri: http://localhost:8123</span><br><span class="line">          predicates:</span><br><span class="line">            - Path=/api/**</span><br><span class="line">          filters:</span><br><span class="line">            - AddRequestHeader=color, blue</span><br><span class="line">            - AddRequestParameter=name, mars</span><br></pre></td></tr></table></figure>

<p>Â  åœ¨åœ°å€æ è®¿é—®ï¼š<a target="_blank" rel="noopener" href="http://localhost:8090/api/name/xuan">http://localhost:8090/api/name/xuan</a> Â  å¾—åˆ°ç»“æœå¦‚ä¸‹ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230131162105385.png"> Â  <strong>The</strong> <code>AddRequestParameter</code> <code>GatewayFilter</code> <strong>Factory</strong> Â  å¢åŠ è¯·æ±‚å‚æ•° Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: add_request_parameter_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        filters:</span><br><span class="line">        - AddRequestParameter=red, blue</span><br></pre></td></tr></table></figure>

<p>Â  <strong>The</strong> <code>AddResponseHeader</code> <code>GatewayFilter</code> <strong>Factory</strong> Â  æ·»åŠ å“åº”å¤´ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: add_response_header_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        filters:</span><br><span class="line">        - AddResponseHeader=X-Response-Red, Blue</span><br></pre></td></tr></table></figure>

<p>Â  <strong>The</strong> <code>DedupeResponseHeader</code> <code>GatewayFilter</code> <strong>Factory</strong> Â  å¦‚æœå“åº”å¤´ä¸­æœ‰é‡å¤çš„ï¼Œå»é‡ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: dedupe_response_header_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        filters:</span><br><span class="line">        - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin</span><br></pre></td></tr></table></figure>

<p>Â  ä¿ç•™ç­–ç•¥ï¼Œç¬¬ä¸€ï¼Œæœ€åï¼Œéšæœº Â  TheÂ <code>DedupeResponseHeader</code>Â filter also accepts an optionalÂ <code>strategy</code>Â parameter. The accepted values areÂ <code>RETAIN_FIRST</code>Â (default),Â <code>RETAIN_LAST</code>, andÂ <code>RETAIN_UNIQUE</code>. Â  <strong>Spring Cloud CircuitBreaker GatewayFilter Factory</strong> Â  é™çº§ Â  éœ€è¦å¼•å…¥<strong>spring-cloud-starter-circuitbreaker-reactor-resilience4j</strong>åŒ… Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-cloud-starter-circuitbreaker-reactor-resilience4j&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: circuitbreaker_route</span><br><span class="line">        uri: lb://backing-service:8088</span><br><span class="line">        predicates:</span><br><span class="line">        - Path=/consumingServiceEndpoint</span><br><span class="line">        filters:</span><br><span class="line">        - name: CircuitBreaker</span><br><span class="line">          args:</span><br><span class="line">            name: myCircuitBreaker</span><br><span class="line">            fallbackUri: forward:/inCaseOfFailureUseThis</span><br><span class="line">        - RewritePath=/consumingServiceEndpoint, /backingServiceEndpoint</span><br></pre></td></tr></table></figure>

<p>Â  <strong>The</strong> <code>FallbackHeaders</code> <code>GatewayFilter</code> <strong>Factory</strong> Â  é™çº§å¤„ç†å™¨ï¼Œå†™ä¸€ä¸‹é™çº§è§„åˆ™ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: ingredients</span><br><span class="line">        uri: lb://ingredients</span><br><span class="line">        predicates:</span><br><span class="line">        - Path=//ingredients/**</span><br><span class="line">        filters:</span><br><span class="line">        - name: CircuitBreaker</span><br><span class="line">          args:</span><br><span class="line">            name: fetchIngredients</span><br><span class="line">            fallbackUri: forward:/fallback</span><br><span class="line">      - id: ingredients-fallback</span><br><span class="line">        uri: http://localhost:9994</span><br><span class="line">        predicates:</span><br><span class="line">        - Path=/fallback</span><br><span class="line">        filters:</span><br><span class="line">        - name: FallbackHeaders</span><br><span class="line">          args:</span><br><span class="line">            executionExceptionTypeHeaderName: Test-Header</span><br></pre></td></tr></table></figure>

<p>Â  <strong>The</strong> <code>MapRequestHeader</code> <code>GatewayFilter</code> <strong>Factory</strong> Â  å¦‚æœä½ çš„<strong>è¯·æ±‚å¤´</strong>é‡Œé¢æœ‰<strong>Blue</strong>ï¼Œä¼šæŠŠ<strong>Blue</strong>çš„å€¼ç»™<strong>X-Request-Red</strong>ï¼Œç›¸å½“äºåšäº†æ˜ å°„ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: map_request_header_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        filters:</span><br><span class="line">        - MapRequestHeader=Blue, X-Request-Red</span><br></pre></td></tr></table></figure>

<p>Â  <strong>The</strong> <code>PrefixPath</code> <code>GatewayFilter</code> <strong>Factory</strong> Â  å‰ç¼€å¤„ç†å™¨ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: prefixpath_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        filters:</span><br><span class="line">        - PrefixPath=/mypath</span><br></pre></td></tr></table></figure>

<p>Â  è¿™ä¼šå°†&#x2F;mypathä½œä¸ºæ‰€æœ‰åŒ¹é…è¯·æ±‚çš„è·¯å¾„çš„å‰ç¼€ã€‚å› æ­¤ï¼Œå¯¹&#x2F;helloçš„è¯·æ±‚å°†å‘é€åˆ°&#x2F;mypath&#x2F;helloã€‚ Â  <strong>The</strong> <code>PreserveHostHeader</code> <code>GatewayFilter</code> <strong>Factoryatewayfilter-factory)</strong> Â  è¯·æ±‚å¤´è½¬å‘çš„æ—¶å€™ï¼Œæœ‰æ—¶å€™<strong>hostå€¼</strong>ä¼šå˜ï¼Œè¿™ä¸ªå¯ä»¥ä¿è¯ä¸å˜ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: preserve_host_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        filters:</span><br><span class="line">        - PreserveHostHeader</span><br></pre></td></tr></table></figure>

<p>Â  <strong>The</strong> <code>RequestRateLimiter</code> <code>GatewayFilter</code> <strong>Factory</strong> Â  é™æµ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230131175738299.png"> Â  ä¸€èˆ¬ä¼šä½¿ç”¨redis+ä»¤ç‰Œæ¡¶ç®—æ³• Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: requestratelimiter_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        filters:</span><br><span class="line">        - name: RequestRateLimiter</span><br><span class="line">          args:</span><br><span class="line">            redis-rate-limiter.replenishRate: 10</span><br><span class="line">            redis-rate-limiter.burstCapacity: 20</span><br><span class="line">            redis-rate-limiter.requestedTokens: 1</span><br></pre></td></tr></table></figure>

<p>Â  <code>RequestHeaderSize</code> <code>GatewayFilter</code> <strong>Factory</strong> Â  é™åˆ¶è¯·æ±‚å¤´å¤§å°Â <strong>è¯·æ±‚ä¿æŠ¤</strong> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: requestheadersize_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        filters:</span><br><span class="line">        - RequestHeaderSize=1000B</span><br></pre></td></tr></table></figure>

<p>Â  <strong>The RemoveRequestHeader Gateway Filter Factory</strong> Â  ç§»é™¤è¯·æ±‚å¤´ ï¼ˆè„±æ•ï¼‰ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: removerequestheader_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        filters:</span><br><span class="line">        - RemoveRequestHeader=X-Request-Foo</span><br></pre></td></tr></table></figure>

<p>Â  This removes theÂ <code>X-Request-Foo</code>Â header before it is sent downstream. Â  <strong>The</strong> <code>RewritePath</code> <code>GatewayFilter</code> <strong>Factory</strong> Â  æ”¹å†™ç‰¹æ®Šçš„è¯·æ±‚å‚æ•° Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: rewritepath_route</span><br><span class="line">        uri: https://example.org</span><br><span class="line">        predicates:</span><br><span class="line">        - Path=/red/**</span><br><span class="line">        filters:</span><br><span class="line">        - RewritePath=/red/?(?&lt;segment&gt;.*), /$\&#123;segment&#125;</span><br></pre></td></tr></table></figure>

<p>Â  <strong>The Retry</strong> <code>GatewayFilter</code> <strong>Factory</strong> Â  è‡ªåŠ¨å¸®ä½ é‡è¯•æ¥å£ï¼Œé™çº§é‡è¯• Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">      - id: retry_test</span><br><span class="line">        uri: http://localhost:8080/flakey</span><br><span class="line">        predicates:</span><br><span class="line">        - Host=*.retry.com</span><br><span class="line">        filters:</span><br><span class="line">        - name: Retry</span><br><span class="line">          args:</span><br><span class="line">            retries: 3</span><br><span class="line">            statuses: BAD_GATEWAY</span><br><span class="line">            methods: GET,POST</span><br><span class="line">            backoff:</span><br><span class="line">              firstBackoff: 10ms</span><br><span class="line">              maxBackoff: 50ms</span><br><span class="line">              factor: 2</span><br><span class="line">              basedOnPreviousValue: false</span><br></pre></td></tr></table></figure>

<p>Â  <strong>Default Filters</strong> Â  é»˜è®¤è¿‡æ»¤å™¨ å¯ä»¥ç”¨ä½œå…¨å±€æŸ“è‰² Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      default-filters:</span><br><span class="line">      - AddResponseHeader=X-Response-Default-Red, Default-Blue</span><br><span class="line">      - PrefixPath=/httpbin</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h2 id="5ã€å…¶ä»–é…ç½®"><a href="#5ã€å…¶ä»–é…ç½®" class="headerlink" title="5ã€å…¶ä»–é…ç½®"></a>5ã€å…¶ä»–é…ç½®</h2><hr>
<h3 id="1ã€å…¨å±€è¿‡æ»¤å™¨"><a href="#1ã€å…¨å±€è¿‡æ»¤å™¨" class="headerlink" title="1ã€å…¨å±€è¿‡æ»¤å™¨"></a>1ã€å…¨å±€è¿‡æ»¤å™¨</h3><p>Â  Global Filters Â  å®šä¹‰è¿‡æ»¤å™¨ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public GlobalFilter customFilter() &#123;</span><br><span class="line">    return new CustomGlobalFilter();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class CustomGlobalFilter implements GlobalFilter, Ordered &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123;</span><br><span class="line">        log.info(&quot;custom global filter&quot;);</span><br><span class="line">        return chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int getOrder() &#123;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h3 id="2ã€Http-timeouts-configuration"><a href="#2ã€Http-timeouts-configuration" class="headerlink" title="2ã€Http timeouts configuration"></a>2ã€Http timeouts configuration</h3><p>Â  Global Â timeouts Â  é…ç½®httpè¶…æ—¶ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      httpclient:</span><br><span class="line">        connect-timeout: 1000</span><br><span class="line">        response-timeout: 5s</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h3 id="3ã€CORS-Configuration"><a href="#3ã€CORS-Configuration" class="headerlink" title="3ã€CORS Configuration"></a>3ã€CORS Configuration</h3><p>Â  è·¨åŸŸé…ç½® Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      globalcors:</span><br><span class="line">        cors-configurations:</span><br><span class="line">          &#x27;[/**]&#x27;:</span><br><span class="line">            allowedOrigins: &quot;https://docs.spring.io&quot;</span><br><span class="line">            allowedMethods:</span><br><span class="line">            - GET</span><br></pre></td></tr></table></figure>

<p>Â  <strong>å°ä½œä¸šï¼š</strong> Â  é€šè¿‡é˜…è¯»æºç ï¼š<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-cloud-gateway/#samples">https://spring.io/projects/spring-cloud-gateway/#samples</a>Â æ¥äº†è§£gatewayç¼–ç¨‹å¼å¼€å‘ Â </p>
<h1 id="åäºŒã€é¡¹ç›®æ•´åˆç½‘å…³"><a href="#åäºŒã€é¡¹ç›®æ•´åˆç½‘å…³" class="headerlink" title="åäºŒã€é¡¹ç›®æ•´åˆç½‘å…³"></a>åäºŒã€é¡¹ç›®æ•´åˆç½‘å…³</h1><hr>
<ol>
<li><p>å®ç°ç»Ÿä¸€çš„ç”¨æˆ·é‰´æƒ ï¼Œç»Ÿä¸€çš„æ¥å£è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡ï¼ˆæŠŠAPIç½‘å…³ç”¨åˆ°é¡¹ç›®ä¸­ï¼‰</p>
</li>
<li><p>å®Œå–„åŠŸèƒ½</p>
</li>
</ol>
<p>Â  <strong>ä¼šç”¨åˆ°çš„ç‰¹æ€§</strong> Â </p>
<ol>
<li><p>è·¯ç”±ï¼ˆè½¬å‘è¯·æ±‚åˆ°æ¨¡æ‹Ÿæ¥å£é¡¹ç›®ï¼‰</p>
</li>
<li><p>è´Ÿè½½å‡è¡¡ï¼ˆéœ€è¦ç”¨åˆ°æ³¨å†Œä¸­å¿ƒï¼‰</p>
</li>
<li><p>ç»Ÿä¸€é‰´æƒ(accessKeyï¼ŒsecretKey)</p>
</li>
<li><p>ç»Ÿä¸€å¤„ç†è·¨åŸŸ</p>
</li>
<li><p>ç»Ÿä¸€ä¸šåŠ¡å¤„ç†ï¼ˆæ¯æ¬¡è¯·æ±‚æ¥å£åï¼Œæ¥å£è°ƒç”¨æ¬¡æ•°+1ï¼‰</p>
</li>
<li><p>è®¿é—®æ§åˆ¶ï¼ˆé»‘ç™½åå•ï¼‰</p>
</li>
<li><p>å‘å¸ƒæ§åˆ¶</p>
</li>
<li><p>æµé‡æŸ“è‰²(è®°å½•è¯·æ±‚æ˜¯å¦ä¸ºç½‘å…³æ¥çš„)</p>
</li>
<li><p>ç»Ÿä¸€æ¥å£ä¿æŠ¤</p>
</li>
<li><p>é™åˆ¶è¯·æ±‚</p>
</li>
<li><p>ä¿¡æ¯è„±æ•</p>
</li>
<li><p>é™çº§ï¼ˆç†”æ–­ï¼‰</p>
</li>
<li><p>é™æµ å­¦ä¹ ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œå­¦ä¹ éœ²æ¡¶ç®—æ³•ï¼Œå­¦ä¹ ä¸€ä¸‹RedislimitHandler</p>
</li>
<li><p>è¶…æ—¶æ—¶é—´</p>
</li>
<li><p>é‡è¯•ï¼ˆä¸šåŠ¡ä¿æŠ¤ï¼‰</p>
</li>
<li><p>ç»Ÿä¸€æ—¥å¿—(è®°å½•æ¯æ¬¡çš„è¯·æ±‚å’Œå“åº”)</p>
</li>
<li><p>ç»Ÿä¸€æ–‡æ¡£</p>
</li>
</ol>
<p>Â  <strong>ä¸šåŠ¡é€»è¾‘</strong> Â </p>
<ol>
<li><p>ç”¨æˆ·å‘é€è¯·æ±‚åˆ°APIç½‘å…³</p>
</li>
<li><p>è¯·æ±‚æ—¥å¿—</p>
</li>
<li><p>é»‘ç™½åå•</p>
</li>
<li><p>ç”¨æˆ·é‰´æƒï¼ˆåˆ¤æ–­akï¼Œskæ˜¯å¦åˆæ³•ï¼‰</p>
</li>
<li><p>è¯·æ±‚çš„æ¨¡æ‹Ÿæ¥å£æ˜¯å¦å­˜åœ¨ï¼Ÿ</p>
</li>
<li><p><strong>è¯·æ±‚è½¬å‘ï¼Œè°ƒç”¨æ¨¡æ‹Ÿæ¥å£</strong></p>
</li>
<li><p>å“åº”æ—¥å¿—</p>
</li>
<li><p>è°ƒç”¨æˆåŠŸï¼Œæ¥å£è°ƒç”¨æ¬¡æ•°+1</p>
</li>
<li><p>è°ƒç”¨å¤±è´¥ï¼Œè¿”å›è§„èŒƒé”™è¯¯ç </p>
</li>
</ol>
<hr>
<h2 id="1ã€è¯·æ±‚è½¬å‘"><a href="#1ã€è¯·æ±‚è½¬å‘" class="headerlink" title="1ã€è¯·æ±‚è½¬å‘"></a>1ã€è¯·æ±‚è½¬å‘</h2><hr>
<p>ä½¿ç”¨PathåŒ¹é…æ–­è¨€ Â  æ‰€æœ‰å‰ç¼€ä¸ºï¼š&#x2F;api&#x2F;Â çš„è¯·æ±‚è¿›è¡Œè½¬å‘ï¼Œè½¬å‘åˆ°<a target="_blank" rel="noopener" href="http://localhost:8123/api">http://localhost:8123/api</a> Â  æ¯”å¦‚è¯·æ±‚ç½‘å…³ï¼š<a target="_blank" rel="noopener" href="http://localhost:8090/api/name/?name=archer%E8%BD%AC%E5%8F%91%E5%88%B0">http://localhost:8090/api/name/?name=archerè½¬å‘åˆ°</a>Â <a target="_blank" rel="noopener" href="http://localhost:8123/api/name/?name=archer">http://localhost:8123/api/name/?name=archer</a> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server:  </span><br><span class="line">  port: 8090  </span><br><span class="line">  </span><br><span class="line">spring:  </span><br><span class="line">  cloud:  </span><br><span class="line">    gateway:  </span><br><span class="line">      routes:  </span><br><span class="line">        - id: api_route  </span><br><span class="line">          uri: http://localhost:8123  </span><br><span class="line">          predicates:  </span><br><span class="line">            - Path=/api/**</span><br></pre></td></tr></table></figure>

<p>Â  æµ‹è¯•æ²¡æœ‰é—®é¢˜ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230201201022011.png"> Â </p>
<h2 id="2ã€Global-Filter"><a href="#2ã€Global-Filter" class="headerlink" title="2ã€Global Filter"></a>2ã€Global Filter</h2><p>Â  ä½¿ç”¨äº†Global Filtersï¼Œå…¨å±€è¯·æ±‚æ‹¦æˆªå¤„ç†ï¼ˆç±»ä¼¼aopï¼‰ Â  æŸ¥çœ‹<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#global-filters">å®˜ç½‘</a>ï¼Œä½¿ç”¨æ¨¡æ¿ä»£ç ä¸ºåŸºç¡€è¿›è¡Œç¼–å†™ç¨‹åº Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package com.xuan.filter;</span><br><span class="line">/**</span><br><span class="line"> * å…¨å±€è¿‡æ»¤å™¨</span><br><span class="line"> *</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @author: ç„</span><br><span class="line"> * @date: 2023/2/1</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">public class CustomGlobalFilter implements GlobalFilter, Ordered &#123;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123;</span><br><span class="line">log.info(&quot;custom global filter&quot;);</span><br><span class="line">return chain.filter(exchange);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public int getOrder() &#123;</span><br><span class="line">return -1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h3 id="1ã€è¯·æ±‚æ—¥å¿—"><a href="#1ã€è¯·æ±‚æ—¥å¿—" class="headerlink" title="1ã€è¯·æ±‚æ—¥å¿—"></a>1ã€è¯·æ±‚æ—¥å¿—</h3><p>Â  æˆ‘ä»¬å‚è€ƒä¹‹å‰çš„AOPçš„å†™æ³•ï¼Œä»exchangeè¿™ä¸ªè·¯ç”±äº¤æ¢æœºé‡Œé¢æ‹¿åˆ°æˆ‘ä»¬æ‰€æœ‰çš„è¯·æ±‚çš„ä¿¡æ¯ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123;</span><br><span class="line">// 1. è¯·æ±‚æ—¥å¿—</span><br><span class="line">ServerHttpRequest request = exchange.getRequest();</span><br><span class="line">log.info(&quot;è¯·æ±‚id: &#123;&#125;&quot;, request.getId());</span><br><span class="line">log.info(&quot;è¯·æ±‚è·¯å¾„: &#123;&#125;&quot;, request.getPath());</span><br><span class="line">log.info(&quot;è¯·æ±‚æ–¹æ³•: &#123;&#125;&quot;, request.getMethod());</span><br><span class="line">log.info(&quot;è¯·æ±‚å‚æ•°: &#123;&#125;&quot;, request.getQueryParams());</span><br><span class="line">log.info(&quot;è¯·æ±‚å¤´: &#123;&#125;&quot;, request.getHeaders());</span><br><span class="line">log.info(&quot;è¯·æ±‚åœ°å€: &#123;&#125;&quot;, request.getRemoteAddress());</span><br><span class="line">return chain.filter(exchange);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230201204627949.png"> Â </p>
<h3 id="2ã€æ·»åŠ é»‘ç™½åå•"><a href="#2ã€æ·»åŠ é»‘ç™½åå•" class="headerlink" title="2ã€æ·»åŠ é»‘ç™½åå•"></a>2ã€æ·»åŠ é»‘ç™½åå•</h3><p>Â  å»ºè®®ç”¨ç™½åå•ï¼Œæ›´å®‰å…¨äº› Â  å¦‚æœè¿™ä¸ªæ¥æºåœ°å€ä¸æ˜¯ç™½åå•é‡Œé¢çš„ï¼Œæˆ‘ä»¬å°±ç›´æ¥è®¾ä¸ªçŠ¶æ€ç ï¼ˆè¿™é‡Œè®¾ç½®403ï¼‰ï¼Œç„¶åæ‹¦æˆªæ‰Â <strong>response.setComplete()</strong>Â å¯ä»¥ç†è§£ä¸ºè®¾ç½®å“åº”å®Œæˆ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">private static final List&lt;String&gt; IP_WHITE_LIST = Arrays.asList(&quot;127.0.0.1&quot;, &quot;127.0.0.2&quot;);</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123;</span><br><span class="line">// 1. è¯·æ±‚æ—¥å¿—</span><br><span class="line">ServerHttpRequest request = exchange.getRequest();</span><br><span class="line">String remoteAddress = request.getRemoteAddress().getHostString();</span><br><span class="line">log.info(&quot;è¯·æ±‚åœ°å€: &#123;&#125;&quot;, remoteAddress);</span><br><span class="line">// 2. è®¿é—®æ§åˆ¶ - é»‘ç™½åå•</span><br><span class="line">if (!IP_WHITE_LIST.contains(remoteAddress))&#123;</span><br><span class="line">ServerHttpResponse response = exchange.getResponse();</span><br><span class="line">response.setStatusCode(HttpStatus.FORBIDDEN);</span><br><span class="line">return response.setComplete();</span><br><span class="line">&#125;</span><br><span class="line">return chain.filter(exchange);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  å°†IP_WHITE_LISTè®¾ç½®ä¸ºé»‘åå• æµ‹è¯•è¢«æ‹’ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230201205411510.png"> Â </p>
<h3 id="3ã€ç”¨æˆ·é‰´æƒ"><a href="#3ã€ç”¨æˆ·é‰´æƒ" class="headerlink" title="3ã€ç”¨æˆ·é‰´æƒ"></a>3ã€ç”¨æˆ·é‰´æƒ</h3><p>Â  æ‰¾åˆ°ä¹‹å‰ç”¨æˆ·é‰´æƒçš„ä»£ç  å¤åˆ¶è¿‡æ¥Â ä¿®æ”¹ä¸€ä¸‹Â éœ€è¦å€’å…¥æˆ‘ä¹‹å‰åšçš„starter Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.xuan&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;xuanapi-client-sdk&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.0.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123;</span><br><span class="line">// 1. è¯·æ±‚æ—¥å¿—</span><br><span class="line">ServerHttpRequest request = exchange.getRequest();</span><br><span class="line">log.info(&quot;è¯·æ±‚id: &#123;&#125;&quot;, request.getId());</span><br><span class="line">log.info(&quot;è¯·æ±‚è·¯å¾„: &#123;&#125;&quot;, request.getPath());</span><br><span class="line">log.info(&quot;è¯·æ±‚æ–¹æ³•: &#123;&#125;&quot;, request.getMethod());</span><br><span class="line">log.info(&quot;è¯·æ±‚å‚æ•°: &#123;&#125;&quot;, request.getQueryParams());</span><br><span class="line">log.info(&quot;è¯·æ±‚å¤´: &#123;&#125;&quot;, request.getHeaders());</span><br><span class="line">String remoteAddress = request.getRemoteAddress().getHostString();</span><br><span class="line">log.info(&quot;è¯·æ±‚åœ°å€: &#123;&#125;&quot;, remoteAddress);</span><br><span class="line"></span><br><span class="line">// 2. è®¿é—®æ§åˆ¶ - é»‘ç™½åå•</span><br><span class="line">if (!IP_WHITE_LIST.contains(remoteAddress)) &#123;</span><br><span class="line">return handleNoAuth(exchange.getResponse());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 3. ç”¨æˆ·é‰´æƒ</span><br><span class="line">HttpHeaders headers = request.getHeaders();</span><br><span class="line">String accessKey = headers.getFirst(&quot;accessKey&quot;);</span><br><span class="line">// é˜²æ­¢ä¸­æ–‡ä¹±ç </span><br><span class="line">String body = null;</span><br><span class="line">try &#123;</span><br><span class="line">body = URLDecoder.decode(headers.getFirst(&quot;body&quot;), StandardCharsets.UTF_8.name());</span><br><span class="line">&#125; catch (UnsupportedEncodingException e) &#123;</span><br><span class="line">throw new RuntimeException(e);</span><br><span class="line">&#125;</span><br><span class="line">String sign = headers.getFirst(&quot;sign&quot;);</span><br><span class="line">String nonce = headers.getFirst(&quot;nonce&quot;);</span><br><span class="line">String timestamp = headers.getFirst(&quot;timestamp&quot;);</span><br><span class="line">boolean hasBlank = StrUtil.hasBlank(accessKey, body, sign, nonce, timestamp);</span><br><span class="line">// åˆ¤æ–­æ˜¯å¦æœ‰ç©º</span><br><span class="line">if (hasBlank) &#123;</span><br><span class="line">return handleInvokeError(exchange.getResponse());</span><br><span class="line">&#125;</span><br><span class="line">// TODO ä½¿ç”¨accessKeyå»æ•°æ®åº“æŸ¥è¯¢secretKey</span><br><span class="line">// å‡è®¾æŸ¥åˆ°çš„secretæ˜¯abc è¿›è¡ŒåŠ å¯†å¾—åˆ°sign</span><br><span class="line">String secretKey = &quot;abc&quot;;</span><br><span class="line">String sign1 = SignUtil.getSign(body, secretKey);</span><br><span class="line">if (!StrUtil.equals(sign, sign1)) &#123;</span><br><span class="line">return handleInvokeError(exchange.getResponse());</span><br><span class="line">&#125;</span><br><span class="line">// TODO åˆ¤æ–­éšæœºæ•°nonce</span><br><span class="line">// æ—¶é—´æˆ³æ˜¯å¦ä¸ºæ•°å­—</span><br><span class="line">if (!NumberUtil.isNumber(timestamp)) &#123;</span><br><span class="line">return handleInvokeError(exchange.getResponse());</span><br><span class="line">&#125;</span><br><span class="line">// äº”åˆ†é’Ÿå†…çš„è¯·æ±‚æœ‰æ•ˆ</span><br><span class="line">if (System.currentTimeMillis() - Long.parseLong(timestamp) &gt; FIVE_MINUTES) &#123;</span><br><span class="line">return handleInvokeError(exchange.getResponse());</span><br><span class="line">&#125;</span><br><span class="line">// 4. è¯·æ±‚çš„æ¨¡æ‹Ÿæ¥å£æ˜¯å¦å­˜åœ¨ï¼Ÿ</span><br><span class="line">// 5. è¯·æ±‚è½¬å‘ï¼Œè°ƒç”¨æ¨¡æ‹Ÿæ¥å£</span><br><span class="line">// 6. å“åº”æ—¥å¿—</span><br><span class="line">// 7. è°ƒç”¨æˆåŠŸï¼Œæ¥å£è°ƒç”¨æ¬¡æ•°+1</span><br><span class="line">// 8. è°ƒç”¨å¤±è´¥ï¼Œè¿”å›è§„èŒƒé”™è¯¯ç </span><br><span class="line">return chain.filter(exchange);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private Mono&lt;Void&gt; handleNoAuth(ServerHttpResponse response) &#123;</span><br><span class="line">response.setStatusCode(HttpStatus.FORBIDDEN);</span><br><span class="line">return response.setComplete();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private Mono&lt;Void&gt; handleInvokeError(ServerHttpResponse response) &#123;</span><br><span class="line">response.setStatusCode(HttpStatus.INTERNAL_SERVER_ERROR);</span><br><span class="line">return response.setComplete();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h3 id="4ã€åˆ¤è¯»è¯·æ±‚çš„æ¥å£æ˜¯å¦å­˜åœ¨"><a href="#4ã€åˆ¤è¯»è¯·æ±‚çš„æ¥å£æ˜¯å¦å­˜åœ¨" class="headerlink" title="4ã€åˆ¤è¯»è¯·æ±‚çš„æ¥å£æ˜¯å¦å­˜åœ¨"></a>4ã€åˆ¤è¯»è¯·æ±‚çš„æ¥å£æ˜¯å¦å­˜åœ¨</h3><p>Â  æˆ‘ä»¬å¯ä»¥ä»<strong>æ•°æ®åº“</strong>ä¸­æŸ¥è¯¢æ¨¡æ‹Ÿæ¥å£æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠè¯·æ±‚æ–¹æ³•æ˜¯å¦åŒ¹é…ï¼ˆè¿˜å¯ä»¥æ ¡éªŒè¯·æ±‚å‚æ•°ï¼‰ å› ä¸ºç½‘å…³é¡¹ç›®æ²¡å¼•å…¥MyBatisç­‰æ“ä½œæ•°æ®åº“çš„ç±»åº“ï¼Œå¦‚æœè¯¥å­©æ“ä½œè¾ƒä¸ºå¤æ‚ï¼Œå¯ä»¥ç”±backendå¢åˆ æ”¹æŸ¥é¡¹ç›®æä¾›æ¥å£ï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨ï¼Œä¸ç”¨å†é‡å¤å†™é€»è¾‘äº†ã€‚ Â </p>
<ul>
<li><p>HTTPè¯·æ±‚ï¼ˆç”¨HTTPClientã€.ç”¨RestTemplateã€Feign)</p>
</li>
<li><p>RPC(Dubbo)</p>
</li>
</ul>
<p>Â </p>
<h3 id="5ã€è¯·æ±‚è½¬å‘-è°ƒç”¨æ¨¡æ‹Ÿæ¥å£"><a href="#5ã€è¯·æ±‚è½¬å‘-è°ƒç”¨æ¨¡æ‹Ÿæ¥å£" class="headerlink" title="5ã€è¯·æ±‚è½¬å‘ è°ƒç”¨æ¨¡æ‹Ÿæ¥å£"></a>5ã€è¯·æ±‚è½¬å‘ è°ƒç”¨æ¨¡æ‹Ÿæ¥å£</h3><p>Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 5. è¯·æ±‚è½¬å‘ï¼Œè°ƒç”¨æ¨¡æ‹Ÿæ¥å£</span><br><span class="line">Mono&lt;Void&gt; filter = chain.filter(exchange);</span><br><span class="line">// 6. å“åº”æ—¥å¿—</span><br><span class="line">log.info(&quot;å“åº”çŠ¶æ€ç ï¼š&#123;&#125;&quot;, response.getStatusCode());</span><br><span class="line">if (response.getStatusCode() == HttpStatus.OK) &#123;</span><br><span class="line">// 7. è°ƒç”¨æˆåŠŸï¼Œæ¥å£è°ƒç”¨æ¬¡æ•°+1</span><br><span class="line">&#125; else &#123;</span><br><span class="line">// 8. è°ƒç”¨å¤±è´¥ï¼Œè¿”å›è§„èŒƒé”™è¯¯ç </span><br><span class="line">return handleInvokeError(response);</span><br><span class="line">&#125;</span><br><span class="line">return filter;</span><br></pre></td></tr></table></figure>

<p>Â  æ¥ä¸‹æ¥éœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯çš„åœ°å€ï¼Œè®©å®ƒç»è¿‡ç½‘å…³ Â  æ‰¾åˆ°SDKä¿®æ”¹åœ°å€ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230202162858649.png"> Â </p>
<h3 id="6ã€å¼‚æ­¥è¿”å›é—®é¢˜"><a href="#6ã€å¼‚æ­¥è¿”å›é—®é¢˜" class="headerlink" title="6ã€å¼‚æ­¥è¿”å›é—®é¢˜"></a>6ã€å¼‚æ­¥è¿”å›é—®é¢˜</h3><p>Â  åˆå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çš„æ¥å£è°ƒç”¨ï¼Œæ˜¯åœ¨è¿‡æ»¤å™¨å®Œæˆä¹‹åè¿›è¡Œçš„ï¼Œæ˜¯ä¸ª<strong>å¼‚æ­¥æ“ä½œ</strong> Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230202163045626.png"> Â  é¢„æœŸæ˜¯ç­‰æ¨¡æ‹Ÿæ¥å£è°ƒç”¨å®Œæˆï¼Œæ‰è®°å½•å“åº”æ—¥å¿—ã€ç»Ÿè®¡è°ƒç”¨æ¬¡æ•°ã€‚ ä½†ç°å®æ˜¯ chain.fitter æ–¹æ³•ç«‹åˆ»è¿”å›äº†ï¼Œç›´åˆ° filter è¿‡æ»¤å™¨ return åæ‰è°ƒç”¨äº†æ¨¡æ‹Ÿæ¥å£ã€‚ åŸå› æ˜¯ï¼šchain.filter æ˜¯ä¸ªå¼‚æ­¥æ“ä½œï¼Œç†è§£ä¸ºå‰ç«¯çš„ promise Â  è§£æ±ºæ–¹æ¡ˆï¼šåˆ©ç”¨response è£…é¥°è€…ï¼Œå¢å¼ºåŸæœ‰ response çš„å¤„ç†èƒ½åŠ› å‚è€ƒåšå®¢ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq/_19636353/article/details/126759522%EF%BC%88%E4%BB%A5%E8%BF%99%E4%B8%AA%E4%B8%BA%E4%B8%BB%EF%BC%89">https://blog.csdn.net/qq\_19636353/article/details/126759522ï¼ˆä»¥è¿™ä¸ªä¸ºä¸»ï¼‰</a> å…¶ä»–å‚è€ƒï¼š â€¢Â <a target="_blank" rel="noopener" href="https://blog.csdn.net/mo_67595943/article/details/124667975">https://blog.csdn.net/mo_67595943&#x2F;article&#x2F;details&#x2F;124667975</a> â€¢Â <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43933728/article/details/121359727">https://blog.csdn.net/weixin_43933728&#x2F;article&#x2F;details&#x2F;121359727</a> â€¢Â <a target="_blank" rel="noopener" href="https://blog.csdn.net/zx156955/article/details/121670681">https://blog.csdn.net/zx156955/article/details/121670681</a> â€¢Â <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39529562/article/details/108911983">https://blog.csdn.net/qq_39529562&#x2F;article&#x2F;details&#x2F;108911983</a> Â  è¿™äº›ä»£ç ä¸ç”¨è®°å¿† æœã€ŒSpring Cloud Gateway å“åº”æ—¥å¿—ã€å°±æœ‰äº† Â  å¤åˆ¶<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq/_19636353/article/details/126759522">https://blog.csdn.net/qq\_19636353/article/details/126759522</a> Â ä¸­çš„Response logä»£ç ã€‚å¹¶æ”¹å†™ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * å¤„ç†å“åº”</span><br><span class="line"> *</span><br><span class="line"> * @param exchange</span><br><span class="line"> * @param chain</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">private Mono&lt;Void&gt; handleResponse(ServerWebExchange exchange, GatewayFilterChain chain) &#123;</span><br><span class="line">try &#123;</span><br><span class="line">// ä»äº¤æ¢æœºæ‹¿åˆ°åŸå§‹response</span><br><span class="line">ServerHttpResponse originalResponse = exchange.getResponse();</span><br><span class="line">// ç¼“å†²åŒºå·¥å‚ æ‹¿åˆ°ç¼“å­˜æ•°æ®</span><br><span class="line">DataBufferFactory bufferFactory = originalResponse.bufferFactory();</span><br><span class="line">// æ‹¿åˆ°çŠ¶æ€ç </span><br><span class="line">HttpStatus statusCode = originalResponse.getStatusCode();</span><br><span class="line"></span><br><span class="line">if (statusCode == HttpStatus.OK) &#123;</span><br><span class="line">// è£…é¥°ï¼Œå¢å¼ºèƒ½åŠ›</span><br><span class="line">ServerHttpResponseDecorator decoratedResponse = new ServerHttpResponseDecorator(originalResponse) &#123;</span><br><span class="line">// ç­‰è°ƒç”¨å®Œè½¬å‘çš„æ¥å£åæ‰ä¼šæ‰§è¡Œ</span><br><span class="line">@Override</span><br><span class="line">public Mono&lt;Void&gt; writeWith(Publisher&lt;? extends DataBuffer&gt; body) &#123;</span><br><span class="line">log.info(&quot;body instanceof Flux: &#123;&#125;&quot;, (body instanceof Flux));</span><br><span class="line">// å¯¹è±¡æ˜¯å“åº”å¼çš„</span><br><span class="line">if (body instanceof Flux) &#123;</span><br><span class="line">// æˆ‘ä»¬æ‹¿åˆ°çœŸæ­£çš„body</span><br><span class="line">Flux&lt;? extends DataBuffer&gt; fluxBody = Flux.from(body);</span><br><span class="line">// å¾€è¿”å›å€¼é‡Œé¢å†™æ•°æ®</span><br><span class="line">// æ‹¼æ¥å­—ç¬¦ä¸²</span><br><span class="line">return super.writeWith(fluxBody.map(dataBuffer -&gt; &#123;</span><br><span class="line">// TODO 7. è°ƒç”¨æˆåŠŸï¼Œæ¥å£è°ƒç”¨æ¬¡æ•°+1</span><br><span class="line">// dataä»è¿™ä¸ªcontentä¸­è¯»å–</span><br><span class="line">byte[] content = new byte[dataBuffer.readableByteCount()];</span><br><span class="line">dataBuffer.read(content);</span><br><span class="line">DataBufferUtils.release(dataBuffer);// é‡Šæ”¾æ‰å†…å­˜</span><br><span class="line">// 6.æ„å»ºæ—¥å¿—</span><br><span class="line">List&lt;Object&gt; rspArgs = new ArrayList&lt;&gt;();</span><br><span class="line">rspArgs.add(originalResponse.getStatusCode());</span><br><span class="line">String data = new String(content, StandardCharsets.UTF_8);// data</span><br><span class="line">rspArgs.add(data);</span><br><span class="line">log.info(&quot;&lt;--- status:&#123;&#125; data:&#123;&#125;&quot;// data</span><br><span class="line">, rspArgs.toArray());// log.info(&quot;&lt;-- &#123;&#125; &#123;&#125;&quot;, originalResponse.getStatusCode(), data);</span><br><span class="line">return bufferFactory.wrap(content);</span><br><span class="line">&#125;));</span><br><span class="line">&#125; else &#123;</span><br><span class="line">// 8.è°ƒç”¨å¤±è´¥è¿”å›é”™è¯¯çŠ¶æ€ç </span><br><span class="line">log.error(&quot;&lt;--- &#123;&#125; å“åº”codeå¼‚å¸¸&quot;, getStatusCode());</span><br><span class="line">&#125;</span><br><span class="line">return super.writeWith(body);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">// è®¾ç½® response å¯¹è±¡ä¸ºè£…é¥°è¿‡çš„</span><br><span class="line">return chain.filter(exchange.mutate().response(decoratedResponse).build());</span><br><span class="line">&#125;</span><br><span class="line">return chain.filter(exchange);// é™çº§å¤„ç†è¿”å›æ•°æ®</span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line">log.error(&quot;gateway log exception.\n&quot; + e);</span><br><span class="line">return chain.filter(exchange);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h1 id="åäºŒã€RPC"><a href="#åäºŒã€RPC" class="headerlink" title="åäºŒã€RPC"></a>åäºŒã€RPC</h1><hr>
<p>RPCï¼ˆRemote Procedure Callï¼‰è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ Â  <strong>ç½‘å…³ä¸šåŠ¡é€»è¾‘</strong> Â  é—®é¢˜ï¼š ç½‘å…³é¡¹ç›®æ¯”è¾ƒå­˜ç²¹ï¼Œæ²¡æœ‰æ“ä½œæ•°æ®åº“çš„åŒ…ï¼Œå¹¶ä¸”è¿˜è¦è°ƒç”¨æˆ‘ä»¬ä¹‹å‰å†™è¿‡çš„ä»£ç ï¼Ÿå¤åˆ¶ç²˜è´´ç»´æŠ¤éº»çƒ¦ ç†æƒ³ï¼šç›´æ¥è¯·æ±‚åˆ°å…¶ä»–é¡¹ç›®çš„æ–¹æ³• Â  <strong>æ€ä¹ˆè°ƒç”¨å…¶ä»–é¡¹ç›®çš„æ–¹æ³•ï¼Ÿ</strong> Â </p>
<ol>
<li><p>å¤åˆ¶ä»£ç å’Œä¾èµ–ï¼Œç¯å¢ƒ</p>
</li>
<li><p>HTTPè¯·æ±‚ï¼ˆæä¾›æ¥å£ï¼Œä¾›å…¶ä»–é¡¹ç›®è°ƒç”¨ï¼‰</p>
</li>
<li><p>RPC</p>
</li>
<li><p>æŠŠå…¬å…±çš„ä»£ç æ‰“ä¸ªjaråŒ…ï¼Œå…¶ä»–é¡¹ç›®å»å¼•ç”¨</p>
</li>
</ol>
<p>Â  <strong>HTTPè¯·æ±‚æ€ä¹ˆè°ƒç”¨</strong> Â </p>
<ol>
<li><p>æä¾›æ–¹æä¾›ä¸€ä¸ªæ¥å£ï¼ˆåœ°å€ï¼Œè¯·æ±‚æ–¹æ³•ï¼Œå‚æ•°ï¼Œè¿”å›å€¼ï¼‰</p>
</li>
<li><p>è°ƒç”¨æ–¹ä½¿ç”¨HTTP Clientä¹‹ç±»çš„ä»£ç åŒ…å»å‘é€HTTPè¯·æ±‚</p>
</li>
</ol>
<p>Â  <strong>RPCä½œç”¨</strong> Â  åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·å»è°ƒç”¨è¿œç¨‹æ–¹æ³• Â  <strong>RPCä¼˜ç‚¹</strong> Â </p>
<ol>
<li><p>å¯¹å¼€å‘è€…æ›´é€æ˜,å‡å°‘å¾ˆå¤šçš„æ²Ÿé€šæˆæœ¬</p>
</li>
<li><p>RPCå‘è¿œç¨‹æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œæœªå¿…ä½¿ç”¨HTTPåè®®ï¼Œæ¯”å¦‚è¿˜å¯ä»¥ä½¿ç”¨TCP&#x2F;IPï¼Œæ€§èƒ½æ›´é«˜ã€‚ï¼ˆå†…éƒ¨æœåŠ¡æ›´å®é€‚ç”¨ï¼‰</p>
</li>
</ol>
<p>Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230203144005014.png"> Â  æ³¨æ„ï¼š è¿™é‡Œæ³¨å†Œä¸­å¿ƒåªæä¾›ä¿¡æ¯ï¼Œå¹¶ä¸ä¼šå¸®åŠ©è°ƒç”¨ Â </p>
<h2 id="1ã€Dubboæ¡†æ¶ï¼ˆRPCå®ç°ï¼‰"><a href="#1ã€Dubboæ¡†æ¶ï¼ˆRPCå®ç°ï¼‰" class="headerlink" title="1ã€Dubboæ¡†æ¶ï¼ˆRPCå®ç°ï¼‰"></a>1ã€Dubboæ¡†æ¶ï¼ˆRPCå®ç°ï¼‰</h2><hr>
<p>å®˜ç½‘ï¼š<a target="_blank" rel="noopener" href="https://cn.dubbo.apache.org/zh/">https://cn.dubbo.apache.org/zh/</a> Â  å¸¸è§æ¡†æ¶è¿˜æœ‰GRPCã€TRPC Â  æœ€å¥½çš„å­¦ä¹ æ–¹å¼ï¼š<a target="_blank" rel="noopener" href="https://dubbo.incubator.apache.org/zh/docs3-v2/java-sdk/quick-start/spring-boot/">é˜…è¯»å®˜æ–¹æ–‡æ¡£</a> Â </p>
<h3 id="1ã€ä¸¤ç§ä½¿ç”¨æ–¹å¼"><a href="#1ã€ä¸¤ç§ä½¿ç”¨æ–¹å¼" class="headerlink" title="1ã€ä¸¤ç§ä½¿ç”¨æ–¹å¼"></a>1ã€ä¸¤ç§ä½¿ç”¨æ–¹å¼</h3><p>Â </p>
<ol>
<li><p>Spring Bootä»£ç ï¼ˆæ³¨è§£+ç¼–ç¨‹å¼ï¼‰ï¼šå†™Javaæ¥å£ï¼ŒæœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…éƒ½å»å¼•ç”¨è¿™ä¸ªæ¥å£ åç¨‹å¯¼</p>
</li>
<li><p>DL(æ¥å£è°ƒç”¨è¯­è¨€)ï¼šåˆ›å»ºä¸€ä¸ªå…¬å…±çš„æ¥å£å®šä¹‰æ–‡ä»¶ï¼ŒæœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…è¯»å–è¿™ä¸ªæ–‡ä»¶ã€‚ä¼˜ç‚¹æ˜¯è·¨è¯­è¨€ï¼Œæ‰€æœ‰çš„æ¡†æ¶éƒ½è®¤è¯†</p>
</li>
</ol>
<p>Â  åº•å±‚æ˜¯Tripleåè®®ï¼š <a target="_blank" rel="noopener" href="https://dubbo.incubator.apache.org/zh/docs3-v2/java-sdk/concepts-and-architecture/triple/">https://dubbo.incubator.apache.org/zh/docs3-v2/java-sdk/concepts-and-architecture/triple/</a> Â </p>
<h3 id="2ã€å¿«é€Ÿä½¿ç”¨-ï¼ˆSpring-Bootï¼‰"><a href="#2ã€å¿«é€Ÿä½¿ç”¨-ï¼ˆSpring-Bootï¼‰" class="headerlink" title="2ã€å¿«é€Ÿä½¿ç”¨ ï¼ˆSpring Bootï¼‰"></a>2ã€å¿«é€Ÿä½¿ç”¨ ï¼ˆSpring Bootï¼‰</h3><p>Â  æŒ‰ç…§å®˜ç½‘æ­¥éª¤æ¥ Â  <strong>ä¸‹è½½æºç </strong> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone -b master https://github.com/apache/dubbo-samples.git</span><br></pre></td></tr></table></figure>

<p>Â  <strong>åœ¨IDEAä¸­æ‰“å¼€</strong> Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230203160423574.png"> Â  çœ‹ä¸€ä¸‹ç»“æ„ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230203165252141.png"> Â  consumerå’Œproviderçš„é…ç½®éƒ½å¦‚ä¸‹ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dubbo:</span><br><span class="line">  application:</span><br><span class="line">    name: dubbo-springboot-demo-provider</span><br><span class="line">  protocol:</span><br><span class="line">    name: dubbo</span><br><span class="line">    port: -1</span><br><span class="line">  registry: # æ³¨å†Œä¸­å¿ƒ</span><br><span class="line">    id: zk-registry</span><br><span class="line">    address: zookeeper://127.0.0.1:2181</span><br><span class="line">  config-center:</span><br><span class="line">    address: zookeeper://127.0.0.1:2181</span><br><span class="line">  metadata-report:</span><br><span class="line">    address: zookeeper://127.0.0.1:2181</span><br></pre></td></tr></table></figure>

<p>Â  EmbeddedZooKeeper æä¸ªä¸€ä¸ªå†…ç½®çš„ZooKeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒ Â  <strong>å¯åŠ¨é¡¹ç›®</strong> Â  å…ˆåå¯åŠ¨ æ³¨å†Œä¸­å¿ƒ(providerå†…ç½®)ã€providerã€consumer æµ‹è¯•è·‘é€šã€‚ Â </p>
<h1 id="åä¸‰ã€é¡¹ç›®æ•´åˆDubboã€Nacos"><a href="#åä¸‰ã€é¡¹ç›®æ•´åˆDubboã€Nacos" class="headerlink" title="åä¸‰ã€é¡¹ç›®æ•´åˆDubboã€Nacos"></a>åä¸‰ã€é¡¹ç›®æ•´åˆDubboã€Nacos</h1><hr>
<ol>
<li><p>backendé¡¹ç›®ä½œä¸º<strong>æœåŠ¡æä¾›è€…</strong>ï¼Œæä¾›3ä¸ªæ–¹æ³•ï¼š</p>
</li>
<li><p>å®é™…æƒ…å†µåº”è¯¥æ˜¯å»æ•°æ®åº“ä¸­æŸ¥æ˜¯å¦å·²åˆ†é…ç»™ç”¨æˆ·</p>
</li>
<li><p>ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ¨¡æ‹Ÿæ¥å£æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠè¯·æ±‚æ–¹æ³•æ˜¯å¦åŒ¹é…ï¼ˆè¿˜å¯ä»¥æ ¡éªŒè¯·æ±‚å‚æ•°ï¼‰</p>
</li>
<li><p>è°ƒç”¨æˆåŠŸï¼Œæ¥å£è°ƒç”¨æ¬¡æ•°+1 invokeCount</p>
</li>
<li><p>gatewayé¡¹æ—¥ä½œä¸º<strong>æœåŠ¡è°ƒç”¨è€…</strong>ï¼Œè°ƒç”¨è¿™3ä¸ªæ–¹æ³•</p>
</li>
</ol>
<p>Â </p>
<h2 id="1ã€å®‰è£…å¯åŠ¨Nacos"><a href="#1ã€å®‰è£…å¯åŠ¨Nacos" class="headerlink" title="1ã€å®‰è£…å¯åŠ¨Nacos"></a>1ã€å®‰è£…å¯åŠ¨Nacos</h2><p>Â  æ•´åˆNacosæ³¨å†Œä¸­ï¼š<a target="_blank" rel="noopener" href="https://cn.dubbo.apache.org/zh/docs3-v2/java-sdk/reference-manual/registry/nacos/">Nacos Apache Dubbo</a> Nacosä¸‹è½½åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://nacos.io/zh-cn/docs/v2/quickstart/quick-start.html">Nacos å¿«é€Ÿå¼€å§‹</a> Â  å¯åŠ¨å‘½ä»¤(standaloneä»£è¡¨ç€å•æœºæ¨¡å¼è¿è¡Œï¼Œéé›†ç¾¤æ¨¡å¼) Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh startup.sh -m standalone</span><br></pre></td></tr></table></figure>

<p>Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230206110644915.png"> Â  ç”¨æˆ·åã€å¯†ç éƒ½æ˜¯nacos Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230206110747933.png"> Â </p>
<h2 id="2ã€é¡¹ç›®è·‘é€š"><a href="#2ã€é¡¹ç›®è·‘é€š" class="headerlink" title="2ã€é¡¹ç›®è·‘é€š"></a>2ã€é¡¹ç›®è·‘é€š</h2><hr>
<p><strong>æ·»åŠ ä¾èµ–</strong> Â  åœ¨api-platform-backendã€api-platform-gatewayä¸­æ·»åŠ å¦‚ä¸‹ä¾èµ– Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;dubbo&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.1.5&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.2.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>Â  è¿™é‡Œçš„nacosæ˜¯æˆ‘ä¸‹è½½çš„ç‰ˆæœ¬ Â  <strong>æ·»åŠ é…ç½®</strong> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dubbo:</span><br><span class="line">  application:</span><br><span class="line">    name: dubbo-api-platform-backend-provider</span><br><span class="line">  protocol:</span><br><span class="line">    name: dubbo</span><br><span class="line">    port: -1</span><br><span class="line">  registry:</span><br><span class="line">    id: nacos-registry</span><br><span class="line">    address: nacos://localhost:8848</span><br></pre></td></tr></table></figure>

<p>Â  <strong>æ³¨æ„ï¼š</strong> Â </p>
<ol>
<li><p>æœåŠ¡æ¥å£ç±»å¿…é¡»è¦åœ¨åŒä¸€ä¸ªåŒ…ä¸‹ï¼Œå»ºè®®æ˜¯æŠ½è±¡å‡ºä¸€ä¸ªå…¬å…±é¡¹æ—¥ï¼ˆæ”¾æ¥å£ã€å®ä½“ç±»ç­‰ï¼‰</p>
</li>
<li><p>ç½®æ³¨è§£ï¼ˆæ¯”å¦‚å¯åŠ¨ç±»çš„EnableDubboã€æ¥å£å®ç°ç±»å’ŒBeanå¼•ç”¨çš„æ³¨è§£ï¼š@DubboServiceã€@DubboReferenceï¼‰</p>
</li>
<li><p>æ·»åŠ é…ç½®</p>
</li>
<li><p>æœåŠ¡è°ƒç”¨é¡¹ç›®å’Œæä¾›è€…é¡¹ç›®å°½é‡å¼•å…¥ç›¸åŒçš„ä¾èµ–å’Œé…ç½®</p>
</li>
</ol>
<p>Â </p>
<h3 id="1ã€api-platform-backend"><a href="#1ã€api-platform-backend" class="headerlink" title="1ã€api-platform-backend"></a>1ã€api-platform-backend</h3><p>Â  åœ¨ä¸»åŒ…ä¸‹æ·»åŠ rpcåŒ…ï¼ˆcom.xuan.project.rpcï¼‰ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230206120727992.png"> Â  RpcDemoServer.java Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface RpcDemoService &#123;</span><br><span class="line">String sayHello(String name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  RpcDemoServerImpl.java Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@DubboService</span><br><span class="line">public class RpcDemoServiceImpl implements RpcDemoService &#123;</span><br><span class="line">@Override</span><br><span class="line">public String sayHello(String name) &#123;</span><br><span class="line">System.out.println(&quot;Hello &quot; + name + &quot;, request from consumer: &quot; + RpcContext.getContext().getRemoteAddress());</span><br><span class="line">return &quot;Hello &quot; + name;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  Applicationä¸»ç±»æ–°å¢@EnableDubboæ³¨è§£ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">@EnableDubbo</span><br><span class="line">@MapperScan(&quot;com.xuan.project.mapper&quot;)</span><br><span class="line">public class MyApplication &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">       SpringApplication.run(MyApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  å¯åŠ¨ä¸»ç±»æŸ¥çœ‹Nacos æ³¨å†ŒæˆåŠŸ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230206121543673.png"> Â </p>
<h3 id="2ã€api-platform-gateway"><a href="#2ã€api-platform-gateway" class="headerlink" title="2ã€api-platform-gateway"></a>2ã€api-platform-gateway</h3><p>Â  åœ¨å’Œbackendä¸€æ ·çš„è·¯å¾„ä¸‹æ–°å»ºrpcåŒ… ï¼ˆcom.xuan.project.rpcï¼‰ æ–°å¢æ¥å£ç±» ä»£ç å¤åˆ¶è¿‡æ¥å³å¯ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230206121742038.png"> Â  å‰å¾€æµ‹è¯•ç±»åšæµ‹è¯• Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootTest</span><br><span class="line">class ApiPlatformGatewayApplicationTests &#123;</span><br><span class="line"></span><br><span class="line">@DubboReference</span><br><span class="line">private RpcDemoService rpcDemoService;</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">void testRpc() &#123;</span><br><span class="line">System.out.println(rpcDemoService.sayHello(&quot;world&quot;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  æµ‹è¯•æˆåŠŸ~ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230206121833955.png"> Â </p>
<h2 id="3ã€æŠ½è±¡å…¬å…±æœåŠ¡"><a href="#3ã€æŠ½è±¡å…¬å…±æœåŠ¡" class="headerlink" title="3ã€æŠ½è±¡å…¬å…±æœåŠ¡"></a>3ã€æŠ½è±¡å…¬å…±æœåŠ¡</h2><hr>
<p>é¡¹ç›®åï¼šapi-platform-common ç›®çš„æ˜¯è®©æ–¹æ³•ã€å®ä½“ç±»åœ¨å¤šä¸ªé¡¹ç›®é—´å¤ç”¨ï¼Œå‡å°‘é‡å¤ç¼–å†™ Â </p>
<h3 id="1ã€æŠ½å–çš„æœåŠ¡"><a href="#1ã€æŠ½å–çš„æœåŠ¡" class="headerlink" title="1ã€æŠ½å–çš„æœåŠ¡"></a>1ã€æŠ½å–çš„æœåŠ¡</h3><p>Â </p>
<ol>
<li><p>æ•°æ®åº“ä¸­æŸ¥æ˜¯å¦å·²åˆ†é…ç»™ç”¨æˆ·ç§˜é’¥(æ ¹æ® accessKey æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œè¿”å›ç”¨æˆ·ä¿¡æ¯ï¼Œä¸ºç©ºè¡¨ç¤ºä¸å­˜åœ¨ï¼‰</p>
</li>
<li><p>ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ¨¡æ‹Ÿæ¥å£æ˜¯å¦å­˜åœ¨ï¼ˆè¯·æ±‚è·¯å¾„ã€è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚å‚æ•°ï¼Œè¿”å›æ¥å£ä¿¡æ¯ï¼Œä¸ºç©ºè¡¨ç¤ºä¸å­˜åœ¨ï¼‰</p>
</li>
<li><p>æ¥å£è°ƒç”¨æ¬¡æ•°+ 1 invokeCount (accessKeyã€secretKey(æ ‡è¯†ç”¨æˆ·ï¼‰ï¼Œè¯·æ±‚æ¥å£è·¯å¾„)</p>
</li>
</ol>
<p>Â </p>
<h3 id="2ã€å…·ä½“æ“ä½œ"><a href="#2ã€å…·ä½“æ“ä½œ" class="headerlink" title="2ã€å…·ä½“æ“ä½œ"></a>2ã€å…·ä½“æ“ä½œ</h3><p>Â </p>
<ol>
<li>æ–°å»ºmavené¡¹ç›® å–åä¸ºapi-platform-common ä¾èµ–æ‰api-platform-backendé‡Œå¤åˆ¶åæ‘˜å‡ºæˆ‘éœ€è¦çš„</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.7.0&lt;/version&gt;</span><br><span class="line">        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.xuan&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;api-platform-common&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.0.1&lt;/version&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.2.2&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.5.1&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- https://mvnrepository.com/artifact/com.google.code.gson/gson --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.google.code.gson&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;gson&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.9.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!-- https://mvnrepository.com/artifact/org.apache.commons/commons-lang3 --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.12.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!-- https://mvnrepository.com/artifact/junit/junit --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.13.2&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<ol start="2">
<li><p>å¤åˆ¶ä¹‹å‰çš„modelåŒ…ä¸‹çš„å®ä½“ç±»</p>
</li>
<li><p>åœ¨commonåŒ…ä¸‹æ–°å»ºserviceå±‚ <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230207113847350.png"></p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">public interface InnerInterfaceInfoService &#123;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æ ¹æ®pathã€methodæŸ¥è¯¢æ¥å£ä¿¡æ¯</span><br><span class="line"> *</span><br><span class="line"> * @param path   è¯·æ±‚è·¯å¾„</span><br><span class="line"> * @param method è¯·æ±‚æ–¹æ³•</span><br><span class="line"> * @return InterfaceInfo</span><br><span class="line"> */</span><br><span class="line">InterfaceInfo getInvokeInterfaceInfo(String path, String method);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public interface InnerUserService &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * æ ¹æ®accessKeyæŸ¥è¯¢ç”¨æˆ·</span><br><span class="line">     *</span><br><span class="line">     * @param accessKey accessKey</span><br><span class="line">     * @return User</span><br><span class="line">     */</span><br><span class="line">    User getInvokeUser(String accessKey);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public interface InnerUserInterfaceInfoService &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line"> * æ˜¯å¦è¿˜æœ‰è°ƒç”¨æ¬¡æ•°</span><br><span class="line"> *</span><br><span class="line"> * @param userId          ç”¨æˆ·id</span><br><span class="line"> * @param interfaceInfoId æ¥å£id</span><br><span class="line"> * @return boolean</span><br><span class="line"> */</span><br><span class="line">boolean hasInvokeNum(long userId, long interfaceInfoId);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æ ¹æ®userIdã€interfaceInfoIdè®¡æ•°</span><br><span class="line"> *</span><br><span class="line"> * @param userId          ç”¨æˆ·id</span><br><span class="line"> * @param interfaceInfoId æ¥å£id</span><br><span class="line"> * @return boolean</span><br><span class="line"> */</span><br><span class="line">boolean invokeInterfaceCount(long userId, long interfaceInfoId);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<ol start="4">
<li>æ‰“åŒ… ä½¿ç”¨maven installæ‰“åŒ… api-platform-backendå¼•å…¥ä¾èµ–</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.xuan&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;api-platform-common&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.0.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<ol start="5">
<li>ç¼–å†™implè¿›è¡Œæµ‹è¯•</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @author: ç„</span><br><span class="line"> * @date: 2023/2/6</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">@DubboService</span><br><span class="line">public class InnerUserInterfaceInfoServiceImpl implements InnerUserInterfaceInfoService &#123;</span><br><span class="line"></span><br><span class="line">@Resource</span><br><span class="line">private UserInterfaceInfoMapper userInterfaceInfoMapper;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public boolean hasInvokeNum(long userId, long interfaceInfoId) &#123;</span><br><span class="line">if (userId &lt;= 0  interfaceInfoId &lt;= 0) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.NOT_FOUND_ERROR);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LambdaQueryWrapper&lt;UserInterfaceInfo&gt; queryWrapper = new LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">queryWrapper.eq(UserInterfaceInfo::getUserId, userId)</span><br><span class="line">.eq(UserInterfaceInfo::getInterfaceInfoId, interfaceInfoId)</span><br><span class="line">.gt(UserInterfaceInfo::getLeftNum, 0);</span><br><span class="line"></span><br><span class="line">UserInterfaceInfo userInterfaceInfo = userInterfaceInfoMapper.selectOne(queryWrapper);</span><br><span class="line">return userInterfaceInfo != null;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public boolean invokeInterfaceCount(long userId, long interfaceInfoId) &#123;</span><br><span class="line">if (userId &lt;= 0  interfaceInfoId &lt;= 0) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.NOT_FOUND_ERROR);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LambdaUpdateWrapper&lt;UserInterfaceInfo&gt; updateWrapper = new LambdaUpdateWrapper&lt;&gt;();</span><br><span class="line">updateWrapper.eq(UserInterfaceInfo::getUserId, userId)</span><br><span class="line">.eq(UserInterfaceInfo::getInterfaceInfoId, interfaceInfoId)</span><br><span class="line">.gt(UserInterfaceInfo::getLeftNum, 0)</span><br><span class="line">.setSql(&quot;left_num = left_num -1, total_num = total_num + 1&quot;);</span><br><span class="line"></span><br><span class="line">int updateCount = userInterfaceInfoMapper.update(null, updateWrapper);</span><br><span class="line">return updateCount &gt; 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<ol start="6">
<li>gatewayå¯åŠ¨æŠ¥é”™</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Description:</span><br><span class="line"></span><br><span class="line">Failed to configure a DataSource: &#x27;url&#x27; attribute is not specified and no embedded datasource could be configured.</span><br><span class="line"></span><br><span class="line">Reason: Failed to determine a suitable driver class</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Action:</span><br><span class="line"></span><br><span class="line">Consider the following:</span><br><span class="line">If you want an embedded database (H2, HSQL or Derby), please put it on the classpath.</span><br><span class="line">If you have database settings to be loaded from a particular profile you may need to activate it (no profiles are currently active).</span><br></pre></td></tr></table></figure>

<p><img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230207151142622.png"> ç»åˆ†ææˆ‘ä»¬éœ€è¦åœ¨ä¸»ç±»ä¸Šæ’é™¤æ•°æ®åº“çš„ç±»åŠ è½½ï¼ˆgoogle springbootå¿½ç•¥æ•°æ®åº“å¯åŠ¨å¾—åˆ°ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package com.xuan.project;</span><br><span class="line"></span><br><span class="line">import org.apache.dubbo.config.spring.context.annotation.EnableDubbo;</span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;</span><br><span class="line">import org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration;</span><br><span class="line">import org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration;</span><br><span class="line"></span><br><span class="line">@EnableDubbo</span><br><span class="line">@SpringBootApplication(exclude = &#123;DataSourceAutoConfiguration.class,</span><br><span class="line">DataSourceTransactionManagerAutoConfiguration.class,</span><br><span class="line">HibernateJpaAutoConfiguration.class&#125;)</span><br><span class="line">public class ApiPlatformGatewayApplication &#123;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">SpringApplication.run(ApiPlatformGatewayApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†æ¬¡å¯åŠ¨ç½‘å…³æˆåŠŸ~</p>
<ol start="7">
<li>æµ‹è¯•è·‘é€š <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230206180958642.png"></li>
</ol>
<p>Â </p>
<h3 id="3ã€implå…·ä½“å®ç°"><a href="#3ã€implå…·ä½“å®ç°" class="headerlink" title="3ã€implå…·ä½“å®ç°"></a>3ã€implå…·ä½“å®ç°</h3><p>Â  åœ¨backendæ–°å»º service&#x2F;impl&#x2F;inneråŒ… Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230207114407493.png"> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @author: ç„</span><br><span class="line"> * @date: 2023/2/6</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">@DubboService</span><br><span class="line">public class InnerInterfaceInfoServiceImpl implements InnerInterfaceInfoService &#123;</span><br><span class="line"></span><br><span class="line">@Resource</span><br><span class="line">private InterfaceInfoMapper interfaceInfoMapper;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public InterfaceInfo getInvokeInterfaceInfo(String url, String method) &#123;</span><br><span class="line">if (StrUtil.hasBlank(url, method)) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.PARAMS_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">LambdaQueryWrapper&lt;InterfaceInfo&gt; lambdaQueryWrapper = new LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">lambdaQueryWrapper.eq(InterfaceInfo::getUrl, url).eq(InterfaceInfo::getMethod, method);</span><br><span class="line">return interfaceInfoMapper.selectOne(lambdaQueryWrapper);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @author: ç„</span><br><span class="line"> * @date: 2023/2/6</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">@DubboService</span><br><span class="line">public class InnerUserServiceImpl implements InnerUserService &#123;</span><br><span class="line"></span><br><span class="line">@Resource</span><br><span class="line">private UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public User getInvokeUser(String accessKey) &#123;</span><br><span class="line">if (StrUtil.isBlank(accessKey)) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.PARAMS_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">LambdaQueryWrapper&lt;User&gt; lambdaQueryWrapper = new LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">lambdaQueryWrapper.eq(User::getAccessKey, accessKey);</span><br><span class="line">return userMapper.selectOne(lambdaQueryWrapper);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h2 id="4ã€ä¼˜åŒ–ç½‘å…³Global-Filter"><a href="#4ã€ä¼˜åŒ–ç½‘å…³Global-Filter" class="headerlink" title="4ã€ä¼˜åŒ–ç½‘å…³Global Filter"></a>4ã€ä¼˜åŒ–ç½‘å…³Global Filter</h2><p>Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * å…¨å±€è¿‡æ»¤å™¨</span><br><span class="line"> *</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @author: ç„</span><br><span class="line"> * @date: 2023/2/1</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">public class CustomGlobalFilter implements GlobalFilter, Ordered &#123;</span><br><span class="line"></span><br><span class="line">@DubboReference</span><br><span class="line">private InnerUserService innerUserService;</span><br><span class="line"></span><br><span class="line">@DubboReference</span><br><span class="line">private InnerInterfaceInfoService innerInterfaceInfoService;</span><br><span class="line"></span><br><span class="line">@DubboReference</span><br><span class="line">private InnerUserInterfaceInfoService innerUserInterfaceInfoService;</span><br><span class="line"></span><br><span class="line">private static final List&lt;String&gt; IP_WHITE_LIST = Arrays.asList(&quot;127.0.0.1&quot;, &quot;127.0.0.2&quot;);</span><br><span class="line"></span><br><span class="line">private static final long FIVE_MINUTES = 5 * 60 * 1000L;</span><br><span class="line"></span><br><span class="line">private static final String INTERFACE_HOST = &quot;http://localhost:8090&quot;;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123;</span><br><span class="line">// 1. è¯·æ±‚æ—¥å¿—</span><br><span class="line">ServerHttpRequest request = exchange.getRequest();</span><br><span class="line">String path = INTERFACE_HOST + request.getPath().value();</span><br><span class="line">String method = Objects.requireNonNull(request.getMethod()).toString();</span><br><span class="line">log.info(&quot;è¯·æ±‚id: &#123;&#125;&quot;, request.getId());</span><br><span class="line">log.info(&quot;è¯·æ±‚è·¯å¾„: &#123;&#125;&quot;, path);</span><br><span class="line">log.info(&quot;è¯·æ±‚æ–¹æ³•: &#123;&#125;&quot;, method);</span><br><span class="line">log.info(&quot;è¯·æ±‚å‚æ•°: &#123;&#125;&quot;, request.getQueryParams());</span><br><span class="line">log.info(&quot;è¯·æ±‚å¤´: &#123;&#125;&quot;, request.getHeaders());</span><br><span class="line">String remoteAddress = Objects.requireNonNull(request.getRemoteAddress()).getHostString();</span><br><span class="line">log.info(&quot;è¯·æ±‚åœ°å€: &#123;&#125;&quot;, remoteAddress);</span><br><span class="line"></span><br><span class="line">// 2. è®¿é—®æ§åˆ¶ - é»‘ç™½åå•</span><br><span class="line">ServerHttpResponse response = exchange.getResponse();</span><br><span class="line">if (!IP_WHITE_LIST.contains(remoteAddress)) &#123;</span><br><span class="line">return handleNoAuth(response);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 3. ç”¨æˆ·é‰´æƒ</span><br><span class="line">HttpHeaders headers = request.getHeaders();</span><br><span class="line">String accessKey = headers.getFirst(&quot;accessKey&quot;);</span><br><span class="line">// é˜²æ­¢ä¸­æ–‡ä¹±ç </span><br><span class="line">String body = null;</span><br><span class="line">try &#123;</span><br><span class="line">body = URLDecoder.decode(headers.getFirst(&quot;body&quot;), StandardCharsets.UTF_8.name());</span><br><span class="line">&#125; catch (UnsupportedEncodingException e) &#123;</span><br><span class="line">throw new RuntimeException(e);</span><br><span class="line">&#125;</span><br><span class="line">String sign = headers.getFirst(&quot;sign&quot;);</span><br><span class="line">String nonce = headers.getFirst(&quot;nonce&quot;);</span><br><span class="line">String timestamp = headers.getFirst(&quot;timestamp&quot;);</span><br><span class="line">boolean hasBlank = StrUtil.hasBlank(accessKey, body, sign, nonce, timestamp);</span><br><span class="line">// åˆ¤æ–­æ˜¯å¦æœ‰ç©º</span><br><span class="line">if (hasBlank) &#123;</span><br><span class="line">return handleInvokeError(response);</span><br><span class="line">&#125;</span><br><span class="line">// ä½¿ç”¨accessKeyå»æ•°æ®åº“æŸ¥è¯¢secretKey</span><br><span class="line">User invokeUser = null;</span><br><span class="line">try &#123;</span><br><span class="line">invokeUser = innerUserService.getInvokeUser(accessKey);</span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line">log.error(&quot;getInvokeUser error&quot;, e);</span><br><span class="line">&#125;</span><br><span class="line">if (invokeUser == null) &#123;</span><br><span class="line">return handleInvokeError(response);</span><br><span class="line">&#125;</span><br><span class="line">String secretKey = invokeUser.getSecretKey();</span><br><span class="line">String sign1 = SignUtil.getSign(body, secretKey);</span><br><span class="line">if (!StrUtil.equals(sign, sign1)) &#123;</span><br><span class="line">return handleInvokeError(response);</span><br><span class="line">&#125;</span><br><span class="line">// TODO åˆ¤æ–­éšæœºæ•°nonce</span><br><span class="line">// æ—¶é—´æˆ³æ˜¯å¦ä¸ºæ•°å­—</span><br><span class="line">if (!NumberUtil.isNumber(timestamp)) &#123;</span><br><span class="line">return handleInvokeError(response);</span><br><span class="line">&#125;</span><br><span class="line">// äº”åˆ†é’Ÿå†…çš„è¯·æ±‚æœ‰æ•ˆ</span><br><span class="line">if (System.currentTimeMillis() - Long.parseLong(timestamp) &gt; FIVE_MINUTES) &#123;</span><br><span class="line">return handleInvokeError(response);</span><br><span class="line">&#125;</span><br><span class="line">// 4. è¯·æ±‚çš„æ¨¡æ‹Ÿæ¥å£æ˜¯å¦å­˜åœ¨</span><br><span class="line">InterfaceInfo invokeInterfaceInfo = null;</span><br><span class="line">try &#123;</span><br><span class="line">invokeInterfaceInfo = innerInterfaceInfoService.getInvokeInterfaceInfo(path, method);</span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line">log.error(&quot;getInvokeInterfaceInfo error&quot;, e);</span><br><span class="line">&#125;</span><br><span class="line">if (invokeInterfaceInfo == null) &#123;</span><br><span class="line">return handleInvokeError(response);</span><br><span class="line">&#125;</span><br><span class="line">//  æ˜¯å¦æœ‰è°ƒç”¨æ¬¡æ•°</span><br><span class="line">if (!innerUserInterfaceInfoService.hasInvokeNum(invokeUser.getId(), invokeInterfaceInfo.getId())) &#123;</span><br><span class="line">return handleInvokeError(response);</span><br><span class="line">&#125;</span><br><span class="line">// 5. è¯·æ±‚è½¬å‘ï¼Œè°ƒç”¨æ¨¡æ‹Ÿæ¥å£</span><br><span class="line">return handleResponse(exchange, chain, invokeUser.getId(), invokeInterfaceInfo.getId());</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public int getOrder() &#123;</span><br><span class="line">return -1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * å¤„ç†å“åº”</span><br><span class="line"> *</span><br><span class="line"> * @param exchange</span><br><span class="line"> * @param chain</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">private Mono&lt;Void&gt; handleResponse(ServerWebExchange exchange, GatewayFilterChain chain, long userId, long interfaceInfoId) &#123;</span><br><span class="line">try &#123;</span><br><span class="line">// ä»äº¤æ¢æœºæ‹¿åˆ°åŸå§‹response</span><br><span class="line">ServerHttpResponse originalResponse = exchange.getResponse();</span><br><span class="line">// ç¼“å†²åŒºå·¥å‚ æ‹¿åˆ°ç¼“å­˜æ•°æ®</span><br><span class="line">DataBufferFactory bufferFactory = originalResponse.bufferFactory();</span><br><span class="line">// æ‹¿åˆ°çŠ¶æ€ç </span><br><span class="line">HttpStatus statusCode = originalResponse.getStatusCode();</span><br><span class="line"></span><br><span class="line">if (statusCode == HttpStatus.OK) &#123;</span><br><span class="line">// è£…é¥°ï¼Œå¢å¼ºèƒ½åŠ›</span><br><span class="line">ServerHttpResponseDecorator decoratedResponse = new ServerHttpResponseDecorator(originalResponse) &#123;</span><br><span class="line">// ç­‰è°ƒç”¨å®Œè½¬å‘çš„æ¥å£åæ‰ä¼šæ‰§è¡Œ</span><br><span class="line">@Override</span><br><span class="line">public Mono&lt;Void&gt; writeWith(Publisher&lt;? extends DataBuffer&gt; body) &#123;</span><br><span class="line">log.info(&quot;body instanceof Flux: &#123;&#125;&quot;, (body instanceof Flux));</span><br><span class="line">// å¯¹è±¡æ˜¯å“åº”å¼çš„</span><br><span class="line">if (body instanceof Flux) &#123;</span><br><span class="line">// æˆ‘ä»¬æ‹¿åˆ°çœŸæ­£çš„body</span><br><span class="line">Flux&lt;? extends DataBuffer&gt; fluxBody = Flux.from(body);</span><br><span class="line">// å¾€è¿”å›å€¼é‡Œé¢å†™æ•°æ®</span><br><span class="line">// æ‹¼æ¥å­—ç¬¦ä¸²</span><br><span class="line">return super.writeWith(fluxBody.map(dataBuffer -&gt; &#123;</span><br><span class="line">// 7. è°ƒç”¨æˆåŠŸï¼Œæ¥å£è°ƒç”¨æ¬¡æ•°+1</span><br><span class="line">try &#123;</span><br><span class="line">innerUserInterfaceInfoService.invokeInterfaceCount(userId, interfaceInfoId);</span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line">log.error(&quot;invokeInterfaceCount error&quot;, e);</span><br><span class="line">&#125;</span><br><span class="line">// dataä»è¿™ä¸ªcontentä¸­è¯»å–</span><br><span class="line">byte[] content = new byte[dataBuffer.readableByteCount()];</span><br><span class="line">dataBuffer.read(content);</span><br><span class="line">DataBufferUtils.release(dataBuffer);// é‡Šæ”¾æ‰å†…å­˜</span><br><span class="line">// 6.æ„å»ºæ—¥å¿—</span><br><span class="line">List&lt;Object&gt; rspArgs = new ArrayList&lt;&gt;();</span><br><span class="line">rspArgs.add(originalResponse.getStatusCode());</span><br><span class="line">String data = new String(content, StandardCharsets.UTF_8);// data</span><br><span class="line">rspArgs.add(data);</span><br><span class="line">log.info(&quot;&lt;--- status:&#123;&#125; data:&#123;&#125;&quot;// data</span><br><span class="line">, rspArgs.toArray());// log.info(&quot;&lt;-- &#123;&#125; &#123;&#125;&quot;, originalResponse.getStatusCode(), data);</span><br><span class="line">return bufferFactory.wrap(content);</span><br><span class="line">&#125;));</span><br><span class="line">&#125; else &#123;</span><br><span class="line">// 8.è°ƒç”¨å¤±è´¥è¿”å›é”™è¯¯çŠ¶æ€ç </span><br><span class="line">log.error(&quot;&lt;--- &#123;&#125; å“åº”codeå¼‚å¸¸&quot;, getStatusCode());</span><br><span class="line">&#125;</span><br><span class="line">return super.writeWith(body);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">// è®¾ç½® response å¯¹è±¡ä¸ºè£…é¥°è¿‡çš„</span><br><span class="line">return chain.filter(exchange.mutate().response(decoratedResponse).build());</span><br><span class="line">&#125;</span><br><span class="line">return chain.filter(exchange);// é™çº§å¤„ç†è¿”å›æ•°æ®</span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line">log.error(&quot;gateway log exception.\n&quot; + e);</span><br><span class="line">return chain.filter(exchange);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private Mono&lt;Void&gt; handleNoAuth(ServerHttpResponse response) &#123;</span><br><span class="line">response.setStatusCode(HttpStatus.FORBIDDEN);</span><br><span class="line">return response.setComplete();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private Mono&lt;Void&gt; handleInvokeError(ServerHttpResponse response) &#123;</span><br><span class="line">response.setStatusCode(HttpStatus.INTERNAL_SERVER_ERROR);</span><br><span class="line">return response.setComplete();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h1 id="åå››ã€ç»Ÿè®¡åˆ†æ"><a href="#åå››ã€ç»Ÿè®¡åˆ†æ" class="headerlink" title="åå››ã€ç»Ÿè®¡åˆ†æ"></a>åå››ã€ç»Ÿè®¡åˆ†æ</h1><hr>
<p><strong>éœ€æ±‚</strong> Â  å„æ¥å£çš„æ€»è°ƒç”¨æ¬¡æ•°å æ¯”ï¼ˆé¥¼å›¾ï¼‰å–è°ƒç”¨æœ€å¤šçš„å‰ 3ä¸ªæ¥å£ï¼Œä»è€Œåˆ†æå‡ºå“ªäº›æ¥å£æ²¡æœ‰äººç”¨ï¼ˆé™ä½èµ„æºã€æˆ–è€…ä¸‹çº¿ï¼‰ï¼Œé«˜é¢‘æ¥å£ï¼ˆå¢åŠ èµ„æºã€æé«˜æ”¶è´¹ï¼‰ã€‚ç”¨é¥¼å›¾å±•ç¤ºã€‚ Â </p>
<h2 id="1ã€åç«¯-1"><a href="#1ã€åç«¯-1" class="headerlink" title="1ã€åç«¯"></a>1ã€åç«¯</h2><hr>
<h3 id="1ã€ç¼–å†™SQL"><a href="#1ã€ç¼–å†™SQL" class="headerlink" title="1ã€ç¼–å†™SQL"></a>1ã€ç¼–å†™SQL</h3><p>Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">interface_info_id,</span><br><span class="line">SUM( total_num ) AS invoke_num </span><br><span class="line">FROM</span><br><span class="line">user_interface_info </span><br><span class="line">GROUP BY</span><br><span class="line">interface_info_id </span><br><span class="line">ORDER BY</span><br><span class="line">invoke_num DESC </span><br><span class="line">LIMIT 3</span><br></pre></td></tr></table></figure>

<p>Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230207154946647.png"> Â  SQLè¯­å¥ç¡®è®¤æ²¡é—®é¢˜å å†åœ¨ä»£ç é‡Œç¼–å†™ Â </p>
<h3 id="2ã€ç¼–å†™æ¥å£"><a href="#2ã€ç¼–å†™æ¥å£" class="headerlink" title="2ã€ç¼–å†™æ¥å£"></a>2ã€ç¼–å†™æ¥å£</h3><p>Â  æ–°å¢VOã€Mapperã€Serviceã€Controller Â  <strong>VO</strong> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@EqualsAndHashCode(callSuper = true)</span><br><span class="line">@Data</span><br><span class="line">public class InvokeInterfaceInfoVO extends InterfaceInfo &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * æ¥å£è°ƒç”¨æ¬¡æ•°</span><br><span class="line">     */</span><br><span class="line">    private Integer invokeNum;</span><br><span class="line"></span><br><span class="line">    private static final long serialVersionUID = 1L;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  <strong>Mapper</strong> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public interface UserInterfaceInfoMapper extends BaseMapper&lt;UserInterfaceInfo&gt; &#123;</span><br><span class="line">    </span><br><span class="line">List&lt;InvokeInterfaceInfoVO&gt; listTopInvokeInterfaceInfo(int limit);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace=&quot;com.xuan.project.mapper.UserInterfaceInfoMapper&quot;&gt;</span><br><span class="line">   </span><br><span class="line">    &lt;select id=&quot;listTopInvokeInterfaceInfo&quot; resultType=&quot;com.xuan.project.model.vo.InvokeInterfaceInfoVO&quot;&gt;</span><br><span class="line">        SELECT interface_info_id AS id,</span><br><span class="line">               SUM(total_num)    AS invoke_num</span><br><span class="line">        FROM user_interface_info</span><br><span class="line">        GROUP BY interface_info_id</span><br><span class="line">        ORDER BY invoke_num DESC LIMIT #&#123;limit&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<p>Â  æ³¨æ„ ï¼šSELECT interface_info_id AS id, è¿™é‡Œä¸€å®šè¦AS id å› ä¸ºVOç±»ç»§æ‰¿çš„InterfaceInfoç±»ã€‚è¿™é‡Œé¢åªæœ‰idå­—æ®µ Â  <strong>Service</strong> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @author: ç„</span><br><span class="line"> * @date: 2023/2/7</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class ChartServiceImpl implements ChartService &#123;</span><br><span class="line"></span><br><span class="line">@Resource</span><br><span class="line">private UserInterfaceInfoMapper userInterfaceInfoMapper;</span><br><span class="line"></span><br><span class="line">@Resource</span><br><span class="line">private InterfaceInfoService interfaceInfoService;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public List&lt;InvokeInterfaceInfoVO&gt; listTopInvokeInterfaceInfo(int limit) &#123;</span><br><span class="line">List&lt;InvokeInterfaceInfoVO&gt; vos = userInterfaceInfoMapper.listTopInvokeInterfaceInfo(limit);</span><br><span class="line">if (vos == null  vos.size() == 0) &#123;</span><br><span class="line">throw new BusinessException(ErrorCode.SYSTEM_ERROR);</span><br><span class="line">&#125;</span><br><span class="line">// æ ¹æ®idæŸ¥è¯¢æ¥å£åç§°</span><br><span class="line">LinkedHashMap&lt;Long, InvokeInterfaceInfoVO&gt; voHashMap = new LinkedHashMap&lt;&gt;(vos.size());</span><br><span class="line">for (InvokeInterfaceInfoVO vo : vos) &#123;</span><br><span class="line">voHashMap.put(vo.getId(), vo);</span><br><span class="line">&#125;</span><br><span class="line">LambdaQueryWrapper&lt;InterfaceInfo&gt; queryWrapper = new LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">queryWrapper.in(InterfaceInfo::getId, voHashMap.keySet());</span><br><span class="line">List&lt;InterfaceInfo&gt; infoList = interfaceInfoService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">for (InterfaceInfo interfaceInfo : infoList) &#123;</span><br><span class="line">voHashMap.get(interfaceInfo.getId()).setName(interfaceInfo.getName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">return new ArrayList&lt;&gt;(voHashMap.values());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â  ä¹Ÿå¯ä»¥ä½¿ç”¨streamæµæ¥å®ç° Â  <strong>Controller</strong> Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * å›¾è¡¨</span><br><span class="line"> *</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @author: ç„</span><br><span class="line"> * @date: 2023/2/7</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">@Slf4j</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/chart&quot;)</span><br><span class="line">public class ChartController &#123;</span><br><span class="line"></span><br><span class="line">@Resource</span><br><span class="line">private ChartService chartService;</span><br><span class="line"></span><br><span class="line">@GetMapping(&quot;/top/interface/invoke&quot;)</span><br><span class="line">BaseResponse&lt;List&lt;InvokeInterfaceInfoVO&gt;&gt; listTopInvokeInterfaceInfo () &#123;</span><br><span class="line">List&lt;InvokeInterfaceInfoVO&gt; listTopInvokeInterfaceInfo = chartService.listTopInvokeInterfaceInfo(3);</span><br><span class="line">return ResultUtils.success(listTopInvokeInterfaceInfo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Â </p>
<h2 id="2ã€å‰ç«¯-1"><a href="#2ã€å‰ç«¯-1" class="headerlink" title="2ã€å‰ç«¯"></a>2ã€å‰ç«¯</h2><hr>
<p>å›¾è¡¨å¼ºçƒˆæ¨èç”¨ç°æˆçš„åº“ï¼ï¼ï¼ æ¯”å¦‚ï¼š Â </p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://echarts.apache.org/zh/index.html">ECharts</a>ï¼ˆæ¨èï¼‰</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://antv.vision/zh">AntV</a>ï¼ˆæ¨èï¼‰</p>
</li>
<li><p>BizCharts</p>
</li>
</ul>
<p>Â  ä½¿ç”¨æ­¥éª¤éƒ½å¤§åŒå°å¼‚ Â </p>
<ol>
<li><p>çœ‹å®˜ç½‘</p>
</li>
<li><p>æ‰¾åˆ°å¿«é€Ÿå…¥é—¨ã€æŒ‰æ–‡æ¡£å»å¼•å…¥åº“</p>
</li>
<li><p>è¿›å…¥ç¤ºä¾‹é¡µé¢</p>
</li>
<li><p>æ‰¾åˆ°ä½ è¦çš„å›¾</p>
</li>
<li><p>åœ¨çº¿è°ƒè¯•</p>
</li>
<li><p>å¤åˆ¶ä»£ç </p>
</li>
<li><p>æ”¹ä¸ºçœŸå®æ•°æ®</p>
</li>
</ol>
<p>Â  è¿™é‡Œé€‰æ‹©ä½¿ç”¨äº†Echarså†åŠ ä¸Šä½¿ç”¨çš„æ˜¯react æ‰€ä»¥ç”¨è¿™ä¸ªåº“ï¼š<a target="_blank" rel="noopener" href="https://github.com/hustcc/echarts-for-react">https://github.com/hustcc/echarts-for-react</a> Â  config&#x2F;routes.tsä¸‹æ–°å¢è·¯ç”± Â  src&#x2F;pages&#x2F;Adminä¸­ä½¿ç”¨ä¸Šé¢æ­¥éª¤å†™äº†ä¸€ä¸ªç®€å•é¡µé¢ Â </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">import &#123; PageContainer &#125; from &#x27;@ant-design/pro-components&#x27;;</span><br><span class="line">import ReactECharts from &#x27;echarts-for-react&#x27;;</span><br><span class="line">import React, &#123; useEffect, useState &#125; from &#x27;react&#x27;;</span><br><span class="line">import &#123; listTopInvokeInterfaceInfoUsingGET &#125; from &#x27;@/services/api-platform-backend/chartController&#x27;;</span><br><span class="line"></span><br><span class="line">const InterfaceChart: React.FC = () =&gt; &#123;</span><br><span class="line">  </span><br><span class="line">  const [data, setData] = useState&lt;API.InvokeInterfaceInfoVO[]&gt;([]);</span><br><span class="line"></span><br><span class="line">  const [loading, setLoading] = useState(true);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    listTopInvokeInterfaceInfoUsingGET().then((res) =&gt; &#123;</span><br><span class="line">      if (res.data) &#123;</span><br><span class="line">        setData(res.data);</span><br><span class="line">        setLoading(false);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  const chartInterface = data.map((item) =&gt; &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      value: item.invokeNum,</span><br><span class="line">      name: item.name,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  const option = &#123;</span><br><span class="line">    tooltip: &#123;</span><br><span class="line">      trigger: &#x27;item&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">    legend: &#123;</span><br><span class="line">      top: &#x27;5%&#x27;,</span><br><span class="line">      left: &#x27;center&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">    series: [</span><br><span class="line">      &#123;</span><br><span class="line">        name: &#x27;Access From&#x27;,</span><br><span class="line">        type: &#x27;pie&#x27;,</span><br><span class="line">        radius: [&#x27;40%&#x27;, &#x27;70%&#x27;],</span><br><span class="line">        avoidLabelOverlap: false,</span><br><span class="line">        itemStyle: &#123;</span><br><span class="line">          borderRadius: 10,</span><br><span class="line">          borderColor: &#x27;#fff&#x27;,</span><br><span class="line">          borderWidth: 2,</span><br><span class="line">        &#125;,</span><br><span class="line">        label: &#123;</span><br><span class="line">          show: false,</span><br><span class="line">          position: &#x27;center&#x27;,</span><br><span class="line">        &#125;,</span><br><span class="line">        emphasis: &#123;</span><br><span class="line">          label: &#123;</span><br><span class="line">            show: true,</span><br><span class="line">            fontSize: 20,</span><br><span class="line">            fontWeight: &#x27;bold&#x27;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        labelLine: &#123;</span><br><span class="line">          show: false,</span><br><span class="line">        &#125;,</span><br><span class="line">        data: chartInterface,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;PageContainer title=&#123;&#x27;æ¥å£è°ƒç”¨æƒ…å†µ&#x27;&#125;&gt;</span><br><span class="line">      &lt;ReactECharts showLoading=&#123;loading&#125; option=&#123;option&#125; /&gt;</span><br><span class="line">    &lt;/PageContainer&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default InterfaceChart;</span><br></pre></td></tr></table></figure>

<p>Â  æ•ˆæœå¦‚ä¸‹ Â  <img src="http://halo-ctc.qiniu.ctcnb.cn/markdown/api/image-20230207184004186.png"> Â </p>
<h1 id="åäº”ã€æ‹“å±•ç‚¹"><a href="#åäº”ã€æ‹“å±•ç‚¹" class="headerlink" title="åäº”ã€æ‹“å±•ç‚¹"></a>åäº”ã€æ‹“å±•ç‚¹</h1><p>Â </p>
<ol>
<li><p>ç”¨æˆ·å¯ä»¥ç”³è¯·æ›´æ¢ç­¾å</p>
</li>
<li><p>æ€ä¹ˆè®©å…¶ä»–ç”¨æˆ·ä¹Ÿä¸Šä¼ æ¥å£ï¼Ÿ éœ€è¦æä¾›ä¸€ä¸ªæœºåˆ¶ (ç•Œé¢ï¼‰ï¼Œè®©ç”¨æˆ·è¾“å…¥è‡ªå·±çš„æ¥å£host ï¼ˆæœåŠ¡å™¨åœ°å€ï¼‰ã€æ¥å£ä¿¡æ¯ï¼Œå°†æ¥å£ä¿¡æ¯å†™å…¥æ•°æ®åº“ã€‚ å¯ä»¥åœ¨ interfacelnto è¡¨é‡ŒåŠ ä¸ª host å­—æ®µï¼ŒåŒºåˆ†æœåŠ¡å™¨åœ°å€ï¼Œè®©æ¥å£æä¾›è€…æ›´çµæ´»åœ°æ¥å…¥ç³»ç»Ÿã€‚ å°†æ¥å£ä¿¡æ¯å†™å…¥æ•°æ®åº“ä¹‹å‰ï¼Œè¦å¯¹æ¥å£è¿›è¡Œæ ¡éªŒï¼ˆæ¯”å¦‚æ£€æŸ¥ä»–çš„åœ°å€æ˜¯å¦éµå¾ªè§„åˆ™ï¼Œæµ‹è¯•è°ƒç”¨ï¼‰ï¼Œä¿è¯ä»–æ˜¯æ­£å¸¸çš„ã€‚ å°†æ¥å£ä¿¡æ¯å†™å…¥æ•°æ®åº“ä¹‹å‰éµå¾ªå’±ä»¬çš„è¦æ±‚ï¼ˆäº•ä¸”ä½¿ç”¨å’±ä»¬çš„ sdkï¼‰ï¼Œåœ¨æ¥å…¥æ—¶ï¼Œå¹³å°éœ€è¦æµ‹è¯•è°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œä¿è¯ä»–æ˜¯æ­£å¸¸çš„ã€‚</p>
</li>
<li><p>ç½‘å…³æ ¡éªŒæ˜¯å¦è¿˜æœ‰è°ƒç”¨æ¬¡æ•° éœ€è¦è€ƒè™‘äº•å‘é—®é¢˜ï¼Œé˜²æ­¢ç¬é—´è°ƒç”¨è¶…é¢ã€‚</p>
</li>
<li><p>ç½‘å…³ä¼˜åŒ– æ¯”å¦‚å¢åŠ é™æµ &#x2F;é™çº§ä¿æŠ¤ï¼Œæé«˜æ€§èƒ½ç­‰ã€‚è¿˜å¯ä»¥è€ƒè™‘æ­é… Nginx ç½‘å…³ä½¿ç”¨ã€‚</p>
</li>
<li><p>åŠŸèƒ½å¢å¼º å¯ä»¥é’ˆå¯¹ä¸åŒçš„è¯·æ±‚å¤´æˆ–è€…æ¥å£ç±»å‹æ¥è®¾è®¡å‰ç«¯ç•Œé¢å’Œè¡¨å•ï¼Œä¾¿äºç”¨æˆ·è°ƒç”¨ï¼Œè·å¾—æ›´å¥½çš„ä½“éªŒã€‚ å¯ä»¥å‚è€ƒ swaggerã€postmanã€knife4j çš„é¡µé¢ã€‚</p>
</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://example.com">é˜¿åº“å¨…</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://example.com/2024/07/2d630400ad43.html">http://example.com/2024/07/2d630400ad43.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a><a class="post-meta__tags" href="/tags/api%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0/">apiå¼€å‘å¹³å°</a><a class="post-meta__tags" href="/tags/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/">é¡¹ç›®å®æˆ˜</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/07/50fa77229b05.html" title="docker-javaä½¿ç”¨winç³»ç»Ÿä¸‹docker"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">docker-javaä½¿ç”¨winç³»ç»Ÿä¸‹docker</div></div></a></div><div class="next-post pull-right"><a href="/2024/07/e0edd63ff2be.html" title="pythonç¨‹åºæ‰“åŒ…ä¸ºwin/linuxå¯æ‰§è¡Œæ–‡ä»¶"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Next</div><div class="next_info">pythonç¨‹åºæ‰“åŒ…ä¸ºwin/linuxå¯æ‰§è¡Œæ–‡ä»¶</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2022/11/001538ef2a61.html" title="javaçŸ¥è¯†ç‚¹-åŸºç¡€ç¯‡"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-15</div><div class="title">javaçŸ¥è¯†ç‚¹-åŸºç¡€ç¯‡</div></div></a></div><div><a href="/2022/11/e536c17cc40b.html" title="javaçŸ¥è¯†ç‚¹-å¹¶å‘ç¯‡"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-25</div><div class="title">javaçŸ¥è¯†ç‚¹-å¹¶å‘ç¯‡</div></div></a></div><div><a href="/2023/03/16d381441693.html" title="javaçŸ¥è¯†ç‚¹â€”â€”è™šæ‹Ÿæœºç¯‡"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-08</div><div class="title">javaçŸ¥è¯†ç‚¹â€”â€”è™šæ‹Ÿæœºç¯‡</div></div></a></div><div><a href="/2023/01/7bc9b569e5a0.html" title="sentinelå®ç°ç†”æ–­+é™çº§+é™æµ"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-14</div><div class="title">sentinelå®ç°ç†”æ–­+é™çº§+é™æµ</div></div></a></div><div><a href="/2023/02/631b03fcdc2f.html" title="å‹åŠ›æµ‹è¯•å’ŒJMeterçš„ä½¿ç”¨"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-12</div><div class="title">å‹åŠ›æµ‹è¯•å’ŒJMeterçš„ä½¿ç”¨</div></div></a></div><div><a href="/2023/03/991533426f94.html" title="javaçŸ¥è¯†ç‚¹â€”â€”æ¡†æ¶ç¯‡"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-08</div><div class="title">javaçŸ¥è¯†ç‚¹â€”â€”æ¡†æ¶ç¯‡</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">é˜¿åº“å¨…</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">31</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">41</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">10</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ctcnb"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">2.</span> <span class="toc-text">ä¸€ã€é¡¹ç›®åˆå§‹åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81Ant-Design-Pro"><span class="toc-number">2.1.</span> <span class="toc-text">1ã€Ant Design Pro</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%90%8E%E7%AB%AF"><span class="toc-number">2.2.</span> <span class="toc-text">2ã€åç«¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">2.2.1.</span> <span class="toc-text">1ã€åˆå§‹åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.2.2.</span> <span class="toc-text">2ã€æ•°æ®åº“è®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%BD%BF%E7%94%A8MabatisX%E6%8F%92%E4%BB%B6"><span class="toc-number">2.2.3.</span> <span class="toc-text">3ã€ä½¿ç”¨MabatisXæ’ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81Controller"><span class="toc-number">2.2.4.</span> <span class="toc-text">4ã€Controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81DTO"><span class="toc-number">2.2.5.</span> <span class="toc-text">5ã€DTO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81Service"><span class="toc-number">2.2.6.</span> <span class="toc-text">6ã€Service</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E5%89%8D%E7%AB%AF"><span class="toc-number">2.3.</span> <span class="toc-text">3ã€å‰ç«¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E9%85%8D%E7%BD%AE%E6%8F%92%E4%BB%B6"><span class="toc-number">2.3.1.</span> <span class="toc-text">1ã€é…ç½®æ’ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8"><span class="toc-number">2.3.2.</span> <span class="toc-text">2ã€æ¥å£è°ƒç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%BF%AE%E6%94%B9%E7%99%BB%E5%BD%95%E7%9A%84%E6%8E%A5%E5%8F%A3"><span class="toc-number">2.3.3.</span> <span class="toc-text">3ã€ä¿®æ”¹ç™»å½•çš„æ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%B3%A8%E9%94%80"><span class="toc-number">2.3.4.</span> <span class="toc-text">4ã€æ³¨é”€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E7%AE%A1%E7%90%86%E6%9D%83%E9%99%90"><span class="toc-number">2.3.5.</span> <span class="toc-text">5ã€ç®¡ç†æƒé™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E8%A1%A8%E6%A0%BC%E9%A1%B5%E9%9D%A2"><span class="toc-number">2.3.6.</span> <span class="toc-text">6ã€è¡¨æ ¼é¡µé¢</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%9F%BA%E7%A1%80%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="toc-number">3.</span> <span class="toc-text">äºŒã€åŸºç¡€å¢åˆ æ”¹æŸ¥</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E4%BF%AE%E6%94%B9%E8%B7%AF%E7%94%B1"><span class="toc-number">3.1.</span> <span class="toc-text">1ã€ä¿®æ”¹è·¯ç”±</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E6%96%B0%E5%A2%9E%E6%8E%A5%E5%8F%A3%E4%BF%A1%E6%81%AF"><span class="toc-number">3.2.</span> <span class="toc-text">2ã€æ–°å¢æ¥å£ä¿¡æ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E8%A1%A8%E5%8D%95%E6%A8%A1%E5%9D%97"><span class="toc-number">3.2.1.</span> <span class="toc-text">1ï¼‰è¡¨å•æ¨¡å—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E8%AF%B7%E6%B1%82%E5%90%8E%E7%AB%AF"><span class="toc-number">3.2.2.</span> <span class="toc-text">2ï¼‰è¯·æ±‚åç«¯</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E7%BC%96%E8%BE%91%E6%8E%A5%E5%8F%A3%E4%BF%A1%E6%81%AF"><span class="toc-number">3.3.</span> <span class="toc-text">3ã€ç¼–è¾‘æ¥å£ä¿¡æ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E8%A1%A8%E5%8D%95%E6%A8%A1%E5%9D%97-1"><span class="toc-number">3.3.1.</span> <span class="toc-text">1ï¼‰è¡¨å•æ¨¡å—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E8%AF%B7%E6%B1%82%E5%90%8E%E7%AB%AF-1"><span class="toc-number">3.3.2.</span> <span class="toc-text">2ï¼‰è¯·æ±‚åç«¯</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E5%88%A0%E9%99%A4%E6%8E%A5%E5%8F%A3%E4%BF%A1%E6%81%AF"><span class="toc-number">3.4.</span> <span class="toc-text">4ã€åˆ é™¤æ¥å£ä¿¡æ¯</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81API%E5%BC%80%E5%8F%91"><span class="toc-number">4.</span> <span class="toc-text">ä¸‰ã€APIå¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%A8%A1%E6%8B%9F%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.1.</span> <span class="toc-text">1ã€æ¨¡æ‹Ÿæ¥å£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E8%B0%83%E7%94%A8%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.2.</span> <span class="toc-text">2ã€è°ƒç”¨æ¥å£</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81API%E7%AD%BE%E5%90%8D%E8%AE%A4%E8%AF%81"><span class="toc-number">5.</span> <span class="toc-text">å››ã€APIç­¾åè®¤è¯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.1.</span> <span class="toc-text">1ã€ä¿®æ”¹æ•°æ®åº“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%8A%A0%E5%AF%86"><span class="toc-number">5.2.</span> <span class="toc-text">2ã€åŠ å¯†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%8A%A0%E5%AF%86%E6%96%B9%E5%BC%8F"><span class="toc-number">5.2.1.</span> <span class="toc-text">1ã€åŠ å¯†æ–¹å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%8A%A0%E5%AF%86%E4%BB%A3%E7%A0%81"><span class="toc-number">5.2.2.</span> <span class="toc-text">2ã€åŠ å¯†ä»£ç </span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AASDK%EF%BC%88starter%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">äº”ã€å¼€å‘ä¸€ä¸ªSDKï¼ˆstarterï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">6.1.</span> <span class="toc-text">1ã€æ–°å»ºé¡¹ç›®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E7%BC%96%E5%86%99%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-number">6.2.</span> <span class="toc-text">2ã€ç¼–å†™é…ç½®ç±»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%8C%87%E5%AE%9A%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-number">6.3.</span> <span class="toc-text">3ã€æŒ‡å®šé…ç½®ç±»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E5%8F%91%E5%B8%83starter"><span class="toc-number">6.4.</span> <span class="toc-text">4ã€å‘å¸ƒstarter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-number">6.5.</span> <span class="toc-text">5ã€æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%8E%A5%E5%8F%A3%E5%8F%91%E5%B8%83-%E4%B8%8B%E7%BA%BF"><span class="toc-number">7.</span> <span class="toc-text">å…­ã€æ¥å£å‘å¸ƒ&#x2F;ä¸‹çº¿</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%90%8E%E7%AB%AF"><span class="toc-number">7.1.</span> <span class="toc-text">1ã€åç«¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%89%8D%E7%AB%AF"><span class="toc-number">7.2.</span> <span class="toc-text">2ã€å‰ç«¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%B7%BB%E5%8A%A0%E5%8F%91%E5%B8%83%E6%8C%89%E9%92%AE%E5%92%8C%E4%B8%8B%E7%BA%BF%E6%8C%89%E9%92%AE"><span class="toc-number">7.2.1.</span> <span class="toc-text">1ã€æ·»åŠ å‘å¸ƒæŒ‰é’®å’Œä¸‹çº¿æŒ‰é’®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%BC%96%E5%86%99%E5%8F%91%E5%B8%83-%E4%B8%8B%E7%BA%BF%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">7.2.2.</span> <span class="toc-text">2ã€ç¼–å†™å‘å¸ƒ&#x2F;ä¸‹çº¿çš„æ–¹æ³•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E7%94%A8%E6%88%B7%E4%B8%BB%E9%A1%B5"><span class="toc-number">8.</span> <span class="toc-text">ä¸ƒã€ç”¨æˆ·ä¸»é¡µ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%B5%8F%E8%A7%88%E6%8E%A5%E5%8F%A3"><span class="toc-number">8.0.1.</span> <span class="toc-text">1ã€æµè§ˆæ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%9F%A5%E7%9C%8B%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3"><span class="toc-number">8.0.2.</span> <span class="toc-text">2ã€æŸ¥çœ‹æ¥å£æ–‡æ¡£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E7%94%B3%E8%AF%B7%E7%AD%BE%E5%90%8D"><span class="toc-number">8.0.3.</span> <span class="toc-text">3ã€ç”³è¯·ç­¾å</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E5%9C%A8%E7%BA%BF%E8%B0%83%E7%94%A8"><span class="toc-number">9.</span> <span class="toc-text">å…«ã€åœ¨çº¿è°ƒç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%89%8D%E7%AB%AF%E7%AE%80%E5%8D%95%E6%A0%B7%E5%BC%8F"><span class="toc-number">9.1.</span> <span class="toc-text">1ã€å‰ç«¯ç®€å•æ ·å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E4%BF%AE%E6%94%B9%E5%90%8E%E7%AB%AF"><span class="toc-number">9.2.</span> <span class="toc-text">2ã€ä¿®æ”¹åç«¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E4%BF%AE%E6%94%B9%E5%89%8D%E7%AB%AF"><span class="toc-number">9.3.</span> <span class="toc-text">3ã€ä¿®æ”¹å‰ç«¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81TODO"><span class="toc-number">9.4.</span> <span class="toc-text">4ã€TODO</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8%E6%AC%A1%E6%95%B0%E7%BB%9F%E8%AE%A1"><span class="toc-number">10.</span> <span class="toc-text">ä¹ã€æ¥å£è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E8%AE%BE%E8%AE%A1%E5%BA%93%E8%A1%A8"><span class="toc-number">10.1.</span> <span class="toc-text">1ã€è®¾è®¡åº“è¡¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%9F%BA%E7%A1%80%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="toc-number">10.2.</span> <span class="toc-text">2ã€åŸºç¡€å¢åˆ æ”¹æŸ¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E8%B0%83%E7%94%A8%E6%AC%A1%E6%95%B0%E7%BB%9F%E8%AE%A1"><span class="toc-number">10.3.</span> <span class="toc-text">3ã€è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E9%97%AE%E9%A2%98"><span class="toc-number">10.4.</span> <span class="toc-text">4ã€é—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E7%BD%91%E5%85%B3"><span class="toc-number">11.</span> <span class="toc-text">åã€ç½‘å…³</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E7%BD%91%E5%85%B3%E4%BD%9C%E7%94%A8"><span class="toc-number">11.1.</span> <span class="toc-text">1ã€ç½‘å…³ä½œç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%85%B7%E4%BD%93%E4%BD%9C%E7%94%A8"><span class="toc-number">11.2.</span> <span class="toc-text">2ã€å…·ä½“ä½œç”¨</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81Spring-Cloud-Gateway"><span class="toc-number">12.</span> <span class="toc-text">åä¸€ã€Spring Cloud Gateway</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">12.1.</span> <span class="toc-text">1ã€æ ¸å¿ƒæ¦‚å¿µ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81Glossary"><span class="toc-number">12.1.1.</span> <span class="toc-text">1ã€Glossary</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E8%AF%B7%E6%B1%82%E6%B5%81%E7%A8%8B"><span class="toc-number">12.1.2.</span> <span class="toc-text">2ã€è¯·æ±‚æµç¨‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E4%B8%A4%E7%A7%8D%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="toc-number">12.2.</span> <span class="toc-text">2ã€ä¸¤ç§é…ç½®æ–¹å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E8%B7%AF%E7%94%B1%E7%9A%84%E5%90%84%E7%A7%8D%E6%96%AD%E8%A8%80"><span class="toc-number">12.3.</span> <span class="toc-text">3ã€è·¯ç”±çš„å„ç§æ–­è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">12.4.</span> <span class="toc-text">4ã€è¿‡æ»¤å™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE"><span class="toc-number">12.5.</span> <span class="toc-text">5ã€å…¶ä»–é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%85%A8%E5%B1%80%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">12.5.1.</span> <span class="toc-text">1ã€å…¨å±€è¿‡æ»¤å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81Http-timeouts-configuration"><span class="toc-number">12.5.2.</span> <span class="toc-text">2ã€Http timeouts configuration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81CORS-Configuration"><span class="toc-number">12.5.3.</span> <span class="toc-text">3ã€CORS Configuration</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81%E9%A1%B9%E7%9B%AE%E6%95%B4%E5%90%88%E7%BD%91%E5%85%B3"><span class="toc-number">13.</span> <span class="toc-text">åäºŒã€é¡¹ç›®æ•´åˆç½‘å…³</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E8%AF%B7%E6%B1%82%E8%BD%AC%E5%8F%91"><span class="toc-number">13.1.</span> <span class="toc-text">1ã€è¯·æ±‚è½¬å‘</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81Global-Filter"><span class="toc-number">13.2.</span> <span class="toc-text">2ã€Global Filter</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E8%AF%B7%E6%B1%82%E6%97%A5%E5%BF%97"><span class="toc-number">13.2.1.</span> <span class="toc-text">1ã€è¯·æ±‚æ—¥å¿—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%B7%BB%E5%8A%A0%E9%BB%91%E7%99%BD%E5%90%8D%E5%8D%95"><span class="toc-number">13.2.2.</span> <span class="toc-text">2ã€æ·»åŠ é»‘ç™½åå•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E7%94%A8%E6%88%B7%E9%89%B4%E6%9D%83"><span class="toc-number">13.2.3.</span> <span class="toc-text">3ã€ç”¨æˆ·é‰´æƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%88%A4%E8%AF%BB%E8%AF%B7%E6%B1%82%E7%9A%84%E6%8E%A5%E5%8F%A3%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8"><span class="toc-number">13.2.4.</span> <span class="toc-text">4ã€åˆ¤è¯»è¯·æ±‚çš„æ¥å£æ˜¯å¦å­˜åœ¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E8%AF%B7%E6%B1%82%E8%BD%AC%E5%8F%91-%E8%B0%83%E7%94%A8%E6%A8%A1%E6%8B%9F%E6%8E%A5%E5%8F%A3"><span class="toc-number">13.2.5.</span> <span class="toc-text">5ã€è¯·æ±‚è½¬å‘ è°ƒç”¨æ¨¡æ‹Ÿæ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E5%BC%82%E6%AD%A5%E8%BF%94%E5%9B%9E%E9%97%AE%E9%A2%98"><span class="toc-number">13.2.6.</span> <span class="toc-text">6ã€å¼‚æ­¥è¿”å›é—®é¢˜</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81RPC"><span class="toc-number">14.</span> <span class="toc-text">åäºŒã€RPC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81Dubbo%E6%A1%86%E6%9E%B6%EF%BC%88RPC%E5%AE%9E%E7%8E%B0%EF%BC%89"><span class="toc-number">14.1.</span> <span class="toc-text">1ã€Dubboæ¡†æ¶ï¼ˆRPCå®ç°ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%B8%A4%E7%A7%8D%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">14.1.1.</span> <span class="toc-text">1ã€ä¸¤ç§ä½¿ç”¨æ–¹å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%BF%AB%E9%80%9F%E4%BD%BF%E7%94%A8-%EF%BC%88Spring-Boot%EF%BC%89"><span class="toc-number">14.1.2.</span> <span class="toc-text">2ã€å¿«é€Ÿä½¿ç”¨ ï¼ˆSpring Bootï¼‰</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%B8%89%E3%80%81%E9%A1%B9%E7%9B%AE%E6%95%B4%E5%90%88Dubbo%E3%80%81Nacos"><span class="toc-number">15.</span> <span class="toc-text">åä¸‰ã€é¡¹ç›®æ•´åˆDubboã€Nacos</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%AE%89%E8%A3%85%E5%90%AF%E5%8A%A8Nacos"><span class="toc-number">15.1.</span> <span class="toc-text">1ã€å®‰è£…å¯åŠ¨Nacos</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E9%A1%B9%E7%9B%AE%E8%B7%91%E9%80%9A"><span class="toc-number">15.2.</span> <span class="toc-text">2ã€é¡¹ç›®è·‘é€š</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81api-platform-backend"><span class="toc-number">15.2.1.</span> <span class="toc-text">1ã€api-platform-backend</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81api-platform-gateway"><span class="toc-number">15.2.2.</span> <span class="toc-text">2ã€api-platform-gateway</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%8A%BD%E8%B1%A1%E5%85%AC%E5%85%B1%E6%9C%8D%E5%8A%A1"><span class="toc-number">15.3.</span> <span class="toc-text">3ã€æŠ½è±¡å…¬å…±æœåŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%8A%BD%E5%8F%96%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="toc-number">15.3.1.</span> <span class="toc-text">1ã€æŠ½å–çš„æœåŠ¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%85%B7%E4%BD%93%E6%93%8D%E4%BD%9C"><span class="toc-number">15.3.2.</span> <span class="toc-text">2ã€å…·ä½“æ“ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81impl%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="toc-number">15.3.3.</span> <span class="toc-text">3ã€implå…·ä½“å®ç°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E4%BC%98%E5%8C%96%E7%BD%91%E5%85%B3Global-Filter"><span class="toc-number">15.4.</span> <span class="toc-text">4ã€ä¼˜åŒ–ç½‘å…³Global Filter</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E5%9B%9B%E3%80%81%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90"><span class="toc-number">16.</span> <span class="toc-text">åå››ã€ç»Ÿè®¡åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%90%8E%E7%AB%AF-1"><span class="toc-number">16.1.</span> <span class="toc-text">1ã€åç«¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%BC%96%E5%86%99SQL"><span class="toc-number">16.1.1.</span> <span class="toc-text">1ã€ç¼–å†™SQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%BC%96%E5%86%99%E6%8E%A5%E5%8F%A3"><span class="toc-number">16.1.2.</span> <span class="toc-text">2ã€ç¼–å†™æ¥å£</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%89%8D%E7%AB%AF-1"><span class="toc-number">16.2.</span> <span class="toc-text">2ã€å‰ç«¯</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%BA%94%E3%80%81%E6%8B%93%E5%B1%95%E7%82%B9"><span class="toc-number">17.</span> <span class="toc-text">åäº”ã€æ‹“å±•ç‚¹</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/860d24e4422f.html" title="åœ¨ç»¿è”ä¸Šå®‰è£…clouddrive2">åœ¨ç»¿è”ä¸Šå®‰è£…clouddrive2</a><time datetime="2024-07-07T02:22:00.000Z" title="Created 2024-07-07 10:22:00">2024-07-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/90f860897346.html" title="ä½¿ç”¨githubå’Œcloudflareå®ç°è‡ªå»ºdockeråŠ é€Ÿå™¨ï¼Œè§£å†³dockeré•œåƒæ— æ³•æ‹‰å–çš„é—®é¢˜">ä½¿ç”¨githubå’Œcloudflareå®ç°è‡ªå»ºdockeråŠ é€Ÿå™¨ï¼Œè§£å†³dockeré•œåƒæ— æ³•æ‹‰å–çš„é—®é¢˜</a><time datetime="2024-07-07T02:20:36.000Z" title="Created 2024-07-07 10:20:36">2024-07-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/50fa77229b05.html" title="docker-javaä½¿ç”¨winç³»ç»Ÿä¸‹docker">docker-javaä½¿ç”¨winç³»ç»Ÿä¸‹docker</a><time datetime="2024-07-07T02:18:45.000Z" title="Created 2024-07-07 10:18:45">2024-07-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/2d630400ad43.html" title="apiå¼€å‘å¹³å°">apiå¼€å‘å¹³å°</a><time datetime="2024-07-07T02:16:44.000Z" title="Created 2024-07-07 10:16:44">2024-07-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/e0edd63ff2be.html" title="pythonç¨‹åºæ‰“åŒ…ä¸ºwin/linuxå¯æ‰§è¡Œæ–‡ä»¶">pythonç¨‹åºæ‰“åŒ…ä¸ºwin/linuxå¯æ‰§è¡Œæ–‡ä»¶</a><time datetime="2024-07-07T01:47:49.000Z" title="Created 2024-07-07 09:47:49">2024-07-07</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By é˜¿åº“å¨…</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>